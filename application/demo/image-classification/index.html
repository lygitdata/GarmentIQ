<!doctype html>
<html class="h-100" lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, shrink-to-fit=no">
        <link rel="icon" type="image/x-icon" href="https://static.gd.edu.kg/images/logo.svg">
        <title>GarmentIQ - Demo | Garment image classification</title>
        <meta name="description" content="GarmentIQ - Application">
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-ELSZ3SFQ2D"></script>
        <script>
            function gtag() {
                dataLayer.push(arguments)
            }
            window.dataLayer = window.dataLayer || [], gtag("js", new Date), gtag("config", "G-ELSZ3SFQ2D")
        </script>
        <!-- Google / Search Engine Tags -->
        <meta itemprop="name" content="GarmentIQ - Demo | Garment image classification">
        <meta itemprop="description" content="GarmentIQ - Demo | Garment image classification">
        <meta itemprop="image" content="https://garmentiq.ly.gd.edu.kg/asset/img/bg.jpg">
        <!-- Facebook Meta Tags -->
        <meta property="og:url" content="https://garmentiq.ly.gd.edu.kg/application/demo/image-classification/">
        <meta property="og:type" content="website">
        <meta property="og:title" content="GarmentIQ - Demo | Garment image classification">
        <meta property="og:description" content="GarmentIQ - Demo | Garment image classification">
        <meta property="og:image" content="https://garmentiq.ly.gd.edu.kg/asset/img/bg.jpg">
        <!-- Twitter Meta Tags -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="GarmentIQ - Demo | Garment image classification">
        <meta name="twitter:description" content="GarmentIQ - Demo | Garment image classification">
        <meta name="twitter:image" content="https://garmentiq.ly.gd.edu.kg/asset/img/bg.jpg">
        <link rel="stylesheet" href="/asset/css/theme.min.css">
        <style>
            /* inter-300 - latin */
            @font-face {
                font-family: 'Inter';
                font-style: normal;
                font-weight: 300;
                font-display: swap;
                src: local(''),
                    url('/asset/fonts/inter-v12-latin-300.woff2') format('woff2'),
                    /* Chrome 26+, Opera 23+, Firefox 39+ */
                    url('/asset/fonts/inter-v12-latin-300.woff') format('woff');
                /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
            }

            @font-face {
                font-family: 'Inter';
                font-style: normal;
                font-weight: 500;
                font-display: swap;
                src: local(''),
                    url('/asset/fonts/inter-v12-latin-500.woff2') format('woff2'),
                    /* Chrome 26+, Opera 23+, Firefox 39+ */
                    url('/asset/fonts/inter-v12-latin-500.woff') format('woff');
                /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
            }

            @font-face {
                font-family: 'Inter';
                font-style: normal;
                font-weight: 700;
                font-display: swap;
                src: local(''),
                    url('/asset/fonts/inter-v12-latin-700.woff2') format('woff2'),
                    /* Chrome 26+, Opera 23+, Firefox 39+ */
                    url('/asset/fonts/inter-v12-latin-700.woff') format('woff');
                /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */
            }

            .spinner {
                width: 30px;
                height: 30px;
                border: 4px solid rgba(0, 0, 0, 0.3);
                border-top-color: black;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin: 1rem 0;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .preview-container {
                display: flex;
                gap: 1rem;
                flex-wrap: wrap;
                justify-content: center;
                margin: 1rem 0;
            }

            .preview-item {
                position: relative;
                max-width: 100px;
                overflow: hidden;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            }

            .preview-item img {
                width: 100%;
                height: auto;
            }

            #result {
                font-size: 2.5rem;
                color: #007bff;
                margin: 1rem 0;
                font-weight: bold;
            }

            .main-content {
                background: white;
                padding: 2rem;
                border-radius: 16px;
                box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
                width: 100%;
                margin: 2rem;
                display: none;
            }

            .upload-area {
                width: 100%;
                border: 2px dashed #007bff;
                border-radius: 12px;
                padding: 2.5rem;
                margin: 1rem 0;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .upload-area:hover {
                background: rgba(0, 123, 255, 0.05);
                border-color: #0056b3;
            }

            #preview {
                max-width: 200px;
                margin: 1rem auto;
                border-radius: 8px;
                box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
                display: none;
            }
        </style>
    </head>
    <body data-bs-spy="scroll" data-bs-target="#navScroll">
        <nav id="navScroll" class="navbar navbar-expand-lg navbar-light" tabindex="0">
            <div class="container">
                <a class="navbar-brand pe-4 fs-4" href="/">
                    <img src="https://static.gd.edu.kg/images/logo.svg" width="32px" height="32px" alt="Logo" />
                    <span class="ms-1 fw-bolder">GarmentIQ</span>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent"></div>
            </div>
        </nav>
        <main>
            <div class="container py-vh-4">
                <div class="row d-flex justify-content-center">
                    <div class="col-12 col-lg-10">
                        <div class="row">
                            <div class="col-12 py-vh-4">
                                <h1 class="display-huge fw-bold lh-1" data-aos="fade-down">Demo 1: Garment image classification</h1>
                                <span class="h6 badge text-bg-light" data-aos="fade-down">Last update of this page: 04/07/2025</span>
                                <div class="mt-4 d-flex justify-content-center" data-aos="fade-down" data-aos-delay="200">
                                    <svg viewbox="0 0 29 107" xmlns="http://www.w3.org/2000/svg" style="width:10px;" data-aos="fade-down">
                                        <path d="M15.425 106.639l13.116-12.42c.55-.446.615-1.23.144-1.751a1.363 1.363 0 0 0-1.993 0l-10.887 10.296V1.242C15.805.556 15.218 0 14.493 0c-.724 0-1.311.556-1.311 1.242v101.522L2.308 92.468a1.363 1.363 0 0 0-1.85-.136 1.197 1.197 0 0 0 0 1.887l13.117 12.42a1.364 1.364 0 0 0 1.85 0z" fill="#000" fill-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </div>
                        <div class="row d-flex align-items-start mt-5 border-top pt-5" data-aos="fade">
                            <div class="col-12">
                                <div id="runtime-overlay">
                                    <div style="display: flex; align-items: center; gap: 10px;">
                                        <h2>Connecting to Runtime</h2>
                                        <div class="spinner"></div>
                                    </div>
                                    <p id="status-text">Initializing connection...</p>
                                    <p> Demonstration Setup Instruction:
                                    <ol style="text-align: left;">
                                        <li>
                                            <a href="demo1.zip" target="_blank" class="link-fancy"> Click here to download Docker configuration files. </a> Then unzip it.
                                        </li>
                                        <li> Run command " <code>cd apparel-classifier</code>" in your Docker terminal. Change the path if needed. </li>
                                        <li> Run command " <code>docker build -t apparel-classifier .</code>" in your Docker terminal. This may take 10 - 20 minutes. </li>
                                        <li> Run command " <code>docker run -p 5000:5000 --gpus all --rm apparel-classifier</code>" in your Docker terminal. </li>
                                        <li>
                                            <a href="demo1_test_set.zip" target="_blank" class="link-fancy"> Click here to download test images. </a>
                                        </li>
                                        <li> Click on the following button to start. You can drag or select test images to see the effect of the model. </li>
                                    </ol>
                                    <iframe src="https://garmentiq.ly.gd.edu.kg/application/demo/image-classification/setup-guide.mp4" width="50%"></iframe>
                                    </p>
                                    <button id="refresh-btn" class="btn btn-dark btn-xl shadow me-3 rounded-0 my-5">Retry Connection</button>
                                </div>
                                <div class="main-content">
                                    <label style="width: 100%;">
                                        <div class="upload-area">
                                            <!-- Add multiple attribute -->
                                            <input type="file" id="imageUpload" accept="image/*" hidden multiple>
                                            <div style="color: #007bff;"> 📁 Click to upload images </div>
                                            <div style="margin-top: 0.5rem;"> Supported formats: PNG, JPG, JPEG (multiple selection enabled) </div>
                                        </div>
                                    </label>
                                    <!-- Change to preview container -->
                                    <div class="preview-container" id="previewContainer"></div>
                                    <button onclick="uploadImage()" class="btn btn-dark btn-xl shadow me-3 rounded-0 my-5">Analyze Images</button>
                                    <div style="margin-top: 2rem;">
                                        <div>Prediction Results</div>
                                        <div id="result">NA</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
        <footer id="footer"></footer>
        <script src="/asset/js/headerMenu.js"></script>
        <script src="/asset/js/footer.js"></script>
        <script src="/asset/js/bootstrap.bundle.min.js"></script>
        <script src="/asset/js/aos.js"></script>
        <script>
            AOS.init({
                duration: 800, // values from 0 to 3000, with step 50ms
            });
        </script>
        <script>
            let scrollpos = window.scrollY
            const header = document.querySelector(".navbar")
            const header_height = header.offsetHeight
            const add_class_on_scroll = () => header.classList.add("scrolled", "shadow-sm")
            const remove_class_on_scroll = () => header.classList.remove("scrolled", "shadow-sm")
            window.addEventListener('scroll', function() {
                scrollpos = window.scrollY;
                if (scrollpos >= header_height) {
                    add_class_on_scroll()
                } else {
                    remove_class_on_scroll()
                }
                console.log(scrollpos)
            })
        </script>
        <script>
            const API_URL = 'http://127.0.0.1:5000/predict';
            const HEALTH_URL = 'http://127.0.0.1:5000/health';
            const EXPECTED_TOKEN = 'fe9def684914b305540615b3bba461fbf8ea58f460c72b1fe128d3cef93fe4f8';
            let isServerReady = false;
            const overlay = document.getElementById('runtime-overlay');
            const statusText = document.getElementById('status-text');
            const refreshBtn = document.getElementById('refresh-btn');
            // Initial check
            checkServerStatus();
            document.getElementById('imageUpload').addEventListener('change', function(e) {
                const container = document.getElementById('previewContainer');
                container.innerHTML = ''; // Clear previous previews
                // Create array of promises that resolve in order
                const files = Array.from(e.target.files);
                const readers = files.map(file => {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = () => resolve({
                            content: reader.result,
                            index: files.indexOf(file)
                        });
                        reader.readAsDataURL(file);
                    });
                });
                // Create placeholder elements first
                const placeholders = files.map((_, index) => {
                    const div = document.createElement('div');
                    div.className = 'preview-item';
                    div.innerHTML = `
                                                            <div class="loading-spinner"></div>`;
                    container.appendChild(div);
                    return {
                        div,
                        index
                    };
                });
                // Process in parallel but maintain order
                Promise.all(readers).then(results => {
                    results.forEach(({
                        content,
                        index
                    }) => {
                        const img = document.createElement('img');
                        img.src = content;
                        placeholders[index].div.innerHTML = '';
                        placeholders[index].div.appendChild(img);
                    });
                });
            });
            // Server status check
            async function checkServerStatus() {
                try {
                    statusText.textContent = "Checking server status...";
                    refreshBtn.style.display = 'none';
                    const response = await fetch(HEALTH_URL);
                    if (!response.ok) throw new Error('Server not responding');
                    const data = await response.json();
                    if (data.token !== EXPECTED_TOKEN) throw new Error('Security verification failed');
                    // Success
                    isServerReady = true;
                    overlay.style.display = 'none';
                    document.querySelector('.main-content').style.display = 'block';
                } catch (error) {
                    statusText.textContent = `Error: ${error.message}`;
                    refreshBtn.style.display = 'block';
                    isServerReady = false;
                }
            }
            // Image analysis
            async function uploadImage() {
                if (!isServerReady) {
                    alert('Service connection not established');
                    return;
                }
                const files = document.getElementById('imageUpload').files;
                if (!files.length) {
                    alert("Please select images first!");
                    return;
                }
                try {
                    document.getElementById('result').textContent = '⏳ Analyzing...';
                    const predictions = [];
                    // Process files sequentially
                    for (const file of files) {
                        const formData = new FormData();
                        formData.append("file", file);
                        const response = await fetch(API_URL, {
                            method: "POST",
                            body: formData
                        });
                        if (!response.ok) throw new Error('Analysis failed');
                        const data = await response.json();
                        predictions.push(data.prediction);
                    }
                    document.getElementById('result').textContent = predictions.join(', ');
                } catch (error) {
                    console.error("Error:", error);
                    document.getElementById('result').textContent = '❌ Error processing some images';
                }
            }
            // Event listeners
            refreshBtn.addEventListener('click', checkServerStatus);
        </script>
    </body>
</html>
