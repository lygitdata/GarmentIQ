{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Garment Measurement Schema",
  "description": "One or more garments, each with landmarks (all required) and measurements (all required)",
  "type": "object",
  "patternProperties": {
    "^.+$": {
      "$ref": "#/definitions/garment"
    }
  },
  "additionalProperties": false,
  "definitions": {
    "garment": {
      "type": "object",
      "required": [
        "landmarks",
        "measurements"
      ],
      "properties": {
        "landmarks": {
          "$ref": "#/definitions/landmarks"
        },
        "measurements": {
          "$ref": "#/definitions/measurements"
        }
      },
      "additionalProperties": false
    },
    "landmarks": {
      "type": "object",
      "description": "Map of point-ID → landmark",
      "minProperties": 1,
      "patternProperties": {
        "^[0-9]+$": {
          "$ref": "#/definitions/landmark"
        }
      },
      "additionalProperties": false
    },
    "landmark": {
      "type": "object",
      "description": "A single landmark on the garment",
      "required": [
        "predefined",
        "description",
        "x",
        "y"
      ],
      "properties": {
        "predefined": {
          "type": "boolean",
          "description": "true = model-detected; false = customized"
        },
        "description": {
          "type": "string",
          "description": "Semantic label for this point"
        },
        "x": {
          "type": "number",
          "description": "X-coordinate in image space"
        },
        "y": {
          "type": "number",
          "description": "Y-coordinate in image space"
        },
        "neighbors": {
          "type": "object",
          "description": "Exactly two nearby landmarks, keyed by their IDs",
          "minProperties": 2,
          "maxProperties": 2,
          "patternProperties": {
            "^[0-9]+$": {
              "$ref": "#/definitions/neighborLandmark"
            }
          },
          "additionalProperties": false
        },
        "derivation": {
          "$ref": "#/definitions/derivation",
          "description": "How this custom point was derived"
        }
      },
      "additionalProperties": false
    },
    "neighborLandmark": {
      "type": "object",
      "required": [
        "predefined",
        "description",
        "x",
        "y"
      ],
      "properties": {
        "predefined": {
          "type": "boolean"
        },
        "description": {
          "type": "string"
        },
        "x": {
          "type": "number"
        },
        "y": {
          "type": "number"
        }
      },
      "additionalProperties": false
    },
    "derivation": {
      "type": "object",
      "required": [
        "function"
      ],
      "minProperties": 2,
      "properties": {
        "function": {
          "type": "string",
          "description": "Name of the derivation function"
        }
      },
      "patternProperties": {
        "^(?!function$)[a-zA-Z_][a-zA-Z0-9_]*$": {
          "type": "string",
          "description": "Named argument for the derivation function"
        }
      },
      "additionalProperties": false
    },
    "measurements": {
      "type": "object",
      "description": "Map of measurement-name → measurement definition",
      "minProperties": 1,
      "patternProperties": {
        "^[a-z0-9_ ]+$": {
          "$ref": "#/definitions/measurement"
        }
      },
      "additionalProperties": false
    },
    "measurement": {
      "type": "object",
      "required": [
        "landmarks",
        "description"
      ],
      "properties": {
        "landmarks": {
          "type": "object",
          "required": [
            "start",
            "end"
          ],
          "properties": {
            "start": {
              "type": "string",
              "pattern": "^[0-9]+$"
            },
            "end": {
              "type": "string",
              "pattern": "^[0-9]+$"
            }
          },
          "additionalProperties": false
        },
        "description": {
          "type": "string"
        }
      },
      "additionalProperties": false
    }
  }
}
