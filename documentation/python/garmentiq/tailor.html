<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.4"/>
    <title>garmentiq.tailor API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../garmentiq.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;garmentiq</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#tailor">tailor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#tailor.__init__">tailor</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.input_dir">input_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.model_dir">model_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.output_dir">output_dir</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.class_dict">class_dict</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.classes">classes</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.do_derive">do_derive</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.do_refine">do_refine</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.classification_model_path">classification_model_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.classification_model_args">classification_model_args</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.classification_model_class">classification_model_class</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.classification_model">classification_model</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.segmentation_model_name">segmentation_model_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.segmentation_model_args">segmentation_model_args</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.segmentation_has_bg_color">segmentation_has_bg_color</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.segmentation_model">segmentation_model</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.landmark_detection_model_path">landmark_detection_model_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.landmark_detection_model_class">landmark_detection_model_class</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.landmark_detection_model_args">landmark_detection_model_args</a>
                        </li>
                        <li>
                                <a class="variable" href="#tailor.landmark_detection_model">landmark_detection_model</a>
                        </li>
                        <li>
                                <a class="function" href="#tailor.summary">summary</a>
                        </li>
                        <li>
                                <a class="function" href="#tailor.classify">classify</a>
                        </li>
                        <li>
                                <a class="function" href="#tailor.segment">segment</a>
                        </li>
                        <li>
                                <a class="function" href="#tailor.detect">detect</a>
                        </li>
                        <li>
                                <a class="function" href="#tailor.derive">derive</a>
                        </li>
                        <li>
                                <a class="function" href="#tailor.refine">refine</a>
                        </li>
                        <li>
                                <a class="function" href="#tailor.measure">measure</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../garmentiq.html">garmentiq</a><wbr>.tailor    </h1>

                
                        <input id="mod-tailor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-tailor-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">torch.nn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">nn</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm.auto</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageFont</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">classification</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">segmentation</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">landmark</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">utils</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="k">class</span><span class="w"> </span><span class="nc">tailor</span><span class="p">:</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">    The `tailor` class acts as a central agent for the GarmentIQ pipeline,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a><span class="sd">    orchestrating garment measurement from classification to landmark derivation.</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a><span class="sd">    It integrates functionalities from other modules (classification, segmentation, landmark)</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">    to provide a smooth end-to-end process for automated garment measurement from images.</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">    Attributes:</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="sd">        input_dir (str): Directory containing input images.</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">        model_dir (str): Directory where models are stored.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a><span class="sd">        output_dir (str): Directory to save processed outputs.</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">        class_dict (dict): Dictionary defining garment classes and their properties.</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="sd">        do_derive (bool): Flag to enable landmark derivation.</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">        do_refine (bool): Flag to enable landmark refinement.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="sd">        classification_model_path (str): Path to the classification model.</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">        classification_model_class (Type[nn.Module]): Class definition for the classification model.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="sd">        classification_model_args (Dict): Arguments for the classification model.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">        segmentation_model_name (str): Name or path for the segmentation model.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="sd">        segmentation_model_args (Dict): Arguments for the segmentation model.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">        landmark_detection_model_path (str): Path to the landmark detection model.</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">        landmark_detection_model_class (Type[nn.Module]): Class definition for the landmark detection model.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">        landmark_detection_model_args (Dict): Arguments for the landmark detection model.</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a><span class="sd">        refinement_args (Optional[Dict]): Arguments for landmark refinement.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="sd">        derivation_dict (Optional[Dict]): Dictionary for landmark derivation rules.</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="n">input_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="n">model_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="n">class_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>        <span class="n">do_derive</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>        <span class="n">do_refine</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>        <span class="n">classification_model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        <span class="n">classification_model_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">],</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="n">classification_model_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="n">segmentation_model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="n">segmentation_model_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="n">landmark_detection_model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="n">landmark_detection_model_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">],</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>        <span class="n">landmark_detection_model_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>        <span class="n">refinement_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>        <span class="n">derivation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="p">):</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="sd">        Initializes the `tailor` agent with paths, model configurations, and processing flags.</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a><span class="sd">        Args:</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a><span class="sd">            input_dir (str): Path to the directory containing input images.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="sd">            model_dir (str): Path to the directory where all required models are stored.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="sd">            output_dir (str): Path to the directory where all processed outputs will be saved.</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="sd">            class_dict (dict): A dictionary defining the garment classes, their predefined points,</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="sd">                                index ranges, and instruction JSON file paths.</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">            do_derive (bool): If True, enables the landmark derivation step.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a><span class="sd">            do_refine (bool): If True, enables the landmark refinement step.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">            classification_model_path (str): The filename or relative path to the classification model.</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">            classification_model_class (Type[nn.Module]): The Python class of the classification model.</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">            classification_model_args (Dict): A dictionary of arguments to initialize the classification model.</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">            segmentation_model_name (str): The name or path of the pretrained segmentation model.</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a><span class="sd">            segmentation_model_args (Dict): A dictionary of arguments for the segmentation model.</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">            landmark_detection_model_path (str): The filename or relative path to the landmark detection model.</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">            landmark_detection_model_class (Type[nn.Module]): The Python class of the landmark detection model.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a><span class="sd">            landmark_detection_model_args (Dict): A dictionary of arguments for the landmark detection model.</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">            refinement_args (Optional[Dict]): Optional arguments for the refinement process,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">                                              e.g., `window_size`, `ksize`, `sigmaX`. Defaults to None.</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">            derivation_dict (Optional[Dict]): A dictionary defining derivation rules for non-predefined landmarks.</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">                                               Required if `do_derive` is True.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">        Raises:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">            ValueError: If `do_derive` is True but `derivation_dict` is None.</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        <span class="c1"># Directories</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span> <span class="o">=</span> <span class="n">input_dir</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">=</span> <span class="n">model_dir</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a>        <span class="c1"># Classes</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_dict</span> <span class="o">=</span> <span class="n">class_dict</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">class_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="c1"># Derivation</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="o">=</span> <span class="n">do_derive</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="p">:</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>            <span class="k">if</span> <span class="n">derivation_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>                    <span class="s2">&quot;`derivation_dict` must be provided if `do_derive=True`.&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>                <span class="p">)</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">derivation_dict</span> <span class="o">=</span> <span class="n">derivation_dict</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">derivation_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="c1"># Refinement setup</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span> <span class="o">=</span> <span class="n">do_refine</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span> <span class="o">=</span> <span class="n">do_refine</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>            <span class="k">if</span> <span class="n">refinement_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span> <span class="o">=</span> <span class="n">refinement_args</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="c1"># Classification model setup</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_path</span> <span class="o">=</span> <span class="n">classification_model_path</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span> <span class="o">=</span> <span class="n">classification_model_args</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_class</span> <span class="o">=</span> <span class="n">classification_model_class</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>        <span class="n">filtered_model_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">,</span> <span class="s2">&quot;normalize_mean&quot;</span><span class="p">,</span> <span class="s2">&quot;normalize_std&quot;</span><span class="p">)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>        <span class="p">}</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="c1"># Load the model using the filtered arguments</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model</span> <span class="o">=</span> <span class="n">classification</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>            <span class="n">model_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_class</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>            <span class="n">model_args</span><span class="o">=</span><span class="n">filtered_model_args</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="p">)</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="c1"># Segmentation model setup</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_name</span> <span class="o">=</span> <span class="n">segmentation_model_name</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span> <span class="o">=</span> <span class="n">segmentation_model_args</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_has_bg_color</span> <span class="o">=</span> <span class="s2">&quot;background_color&quot;</span> <span class="ow">in</span> <span class="n">segmentation_model_args</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>            <span class="n">pretrained_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_name</span><span class="p">,</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>            <span class="n">pretrained_model_args</span><span class="o">=</span><span class="p">{</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>                <span class="s2">&quot;trust_remote_code&quot;</span><span class="p">:</span> <span class="n">segmentation_model_args</span><span class="p">[</span><span class="s2">&quot;trust_remote_code&quot;</span><span class="p">]</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>            <span class="p">},</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>            <span class="n">high_precision</span><span class="o">=</span><span class="n">segmentation_model_args</span><span class="p">[</span><span class="s2">&quot;high_precision&quot;</span><span class="p">],</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>        <span class="c1"># Landmark detection model setup</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_path</span> <span class="o">=</span> <span class="n">landmark_detection_model_path</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_class</span> <span class="o">=</span> <span class="n">landmark_detection_model_class</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span> <span class="o">=</span> <span class="n">landmark_detection_model_args</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>            <span class="n">model_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_class</span><span class="p">,</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="p">)</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">        Prints a summary of the `tailor` agent&#39;s configuration, including directory paths,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        defined classes, processing options (refine, derive), and loaded models.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="n">width</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TAILOR AGENT SUMMARY&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="c1"># Directories</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DIRECTORY PATHS&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Input directory:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Model directory:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Output directory:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="c1"># Classes</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CLASSES&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Class Index&#39;</span><span class="si">:</span><span class="s2">&lt;11</span><span class="si">}</span><span class="s2"> | Class Name&quot;</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">11</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">66</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">&lt;11</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="bp">cls</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>        <span class="c1"># Flags</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OPTIONS&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Do refine?:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Do derive?:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="c1"># Models</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MODELS&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Classification Model:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Segmentation Model:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;   Change BG color?:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_has_bg_color</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Landmark Detection Model:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_class</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a><span class="sd">        Classifies a single garment image using the configured classification model.</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a><span class="sd">        Args:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a><span class="sd">            image (str): The filename of the image to classify, located in `self.input_dir`.</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a><span class="sd">            verbose (bool): If True, prints detailed classification output. Defaults to False.</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a><span class="sd">        Returns:</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a><span class="sd">            tuple:</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a><span class="sd">                - label (str): The predicted class label of the garment.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="sd">                - probabilities (List[float]): A list of probabilities for each class.</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="n">label</span><span class="p">,</span> <span class="n">probablities</span> <span class="o">=</span> <span class="n">classification</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model</span><span class="p">,</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>            <span class="n">image_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="n">classes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>            <span class="n">resize_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">),</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="n">normalize_mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_mean&quot;</span><span class="p">),</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="n">normalize_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_std&quot;</span><span class="p">),</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>        <span class="p">)</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>        <span class="k">return</span> <span class="n">label</span><span class="p">,</span> <span class="n">probablities</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">        Segments a single garment image to extract its mask and optionally modifies the background color.</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">        Args:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">            image (str): The filename of the image to segment, located in `self.input_dir`.</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">        Returns:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">            tuple:</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a><span class="sd">                - original_img (np.ndarray): The original image with the mask overlaid.</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">                - mask (np.ndarray): The binary segmentation mask.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">                - bg_modified_img (np.ndarray, optional): The image with the background color changed,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">                                                         returned only if `background_color` is specified</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">                                                         in `segmentation_model_args`.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>        <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="n">image_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>            <span class="n">resize_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">),</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>            <span class="n">normalize_mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_mean&quot;</span><span class="p">),</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="n">normalize_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_std&quot;</span><span class="p">),</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="n">high_precision</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;high_precision&quot;</span><span class="p">),</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="p">)</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="n">background_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">)</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="k">if</span> <span class="n">background_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>            <span class="k">return</span> <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>            <span class="n">bg_modified_img</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">change_background_color</span><span class="p">(</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>                <span class="n">image_np</span><span class="o">=</span><span class="n">original_img</span><span class="p">,</span> <span class="n">mask_np</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">background_color</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>            <span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>            <span class="k">return</span> <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bg_modified_img</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a><span class="sd">        Detects predefined landmarks on a garment image based on its classified class.</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a><span class="sd">        Args:</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a><span class="sd">            class_name (str): The classified name of the garment.</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a><span class="sd">            image (Union[str, np.ndarray]): The path to the image file or a NumPy array of the image.</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a><span class="sd">        Returns:</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a><span class="sd">            tuple:</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a><span class="sd">                - coords (np.array): Detected landmark coordinates.</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a><span class="sd">                - maxval (np.array): Confidence scores for detected landmarks.</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a><span class="sd">                - detection_dict (dict): A dictionary containing detailed landmark detection data.</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">coords</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">detection_dict</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>            <span class="n">class_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_dict</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>            <span class="n">image_path</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model</span><span class="p">,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>            <span class="n">scale_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scale_std&quot;</span><span class="p">),</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>            <span class="n">resize_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">),</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>            <span class="n">normalize_mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_mean&quot;</span><span class="p">),</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>            <span class="n">normalize_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_std&quot;</span><span class="p">),</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="p">)</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">detection_dict</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">derive</span><span class="p">(</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>        <span class="n">detection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="n">derivation_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>        <span class="n">landmark_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="n">np_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>    <span class="p">):</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">        Derives non-predefined landmark coordinates based on predefined landmarks and a mask.</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a><span class="sd">        Args:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">            class_name (str): The name of the garment class.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a><span class="sd">            detection_dict (dict): The dictionary containing detected landmarks.</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">            derivation_dict (dict): The dictionary defining derivation rules.</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">            landmark_coords (np.array): NumPy array of initial landmark coordinates.</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">            np_mask (np.array): NumPy array of the segmentation mask.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">        Returns:</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">            tuple:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">                - derived_coords (dict): A dictionary of the newly derived landmark coordinates.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">                - updated_detection_dict (dict): The detection dictionary updated with derived landmarks.</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>        <span class="n">derived_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a>            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a>            <span class="n">detection_dict</span><span class="o">=</span><span class="n">detection_dict</span><span class="p">,</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a>            <span class="n">derivation_dict</span><span class="o">=</span><span class="n">derivation_dict</span><span class="p">,</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a>            <span class="n">landmark_coords</span><span class="o">=</span><span class="n">landmark_coords</span><span class="p">,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>            <span class="n">np_mask</span><span class="o">=</span><span class="n">np_mask</span><span class="p">,</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a>        <span class="p">)</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a>        <span class="k">return</span> <span class="n">derived_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refine</span><span class="p">(</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>        <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a>        <span class="n">detection_np</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a>        <span class="n">detection_conf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>        <span class="n">detection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a>        <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>        <span class="n">ksize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a>        <span class="n">sigmaX</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a>    <span class="p">):</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">        Refines detected landmark coordinates using a blurred segmentation mask.</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">        Args:</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a><span class="sd">            class_name (str): The name of the garment class.</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a><span class="sd">            detection_np (np.array): NumPy array of initial landmark predictions.</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a><span class="sd">            detection_conf (np.array): NumPy array of confidence scores for each predicted landmark.</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a><span class="sd">            detection_dict (dict): Dictionary containing landmark data for each class.</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a><span class="sd">            mask (np.array): Grayscale mask image used to guide refinement.</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a><span class="sd">            window_size (int, optional): Size of the window used in the refinement algorithm. Defaults to 5.</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a><span class="sd">            ksize (tuple, optional): Kernel size for Gaussian blur. Must be odd integers. Defaults to (11, 11).</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a><span class="sd">            sigmaX (float, optional): Gaussian kernel standard deviation in the X direction. Defaults to 0.0.</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a><span class="sd">        Returns:</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a><span class="sd">            tuple:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a><span class="sd">                - refined_detection_np (np.array): Array of the same shape as `detection_np` with refined coordinates.</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a><span class="sd">                - detection_dict (dict): Updated detection dictionary with refined landmark coordinates.</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">:</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;window_size&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>                <span class="n">window_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">]</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ksize&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>                <span class="n">ksize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">[</span><span class="s2">&quot;ksize&quot;</span><span class="p">]</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sigmaX&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>                <span class="n">sigmaX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">[</span><span class="s2">&quot;sigmaX&quot;</span><span class="p">]</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>        <span class="n">refined_detection_np</span><span class="p">,</span> <span class="n">refined_detection_dict</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="n">detection_np</span><span class="o">=</span><span class="n">detection_np</span><span class="p">,</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>            <span class="n">detection_conf</span><span class="o">=</span><span class="n">detection_conf</span><span class="p">,</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>            <span class="n">detection_dict</span><span class="o">=</span><span class="n">detection_dict</span><span class="p">,</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>            <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="n">ksize</span><span class="o">=</span><span class="n">ksize</span><span class="p">,</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>            <span class="n">sigmaX</span><span class="o">=</span><span class="n">sigmaX</span><span class="p">,</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>        <span class="k">return</span> <span class="n">refined_detection_np</span><span class="p">,</span> <span class="n">refined_detection_dict</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">measure</span><span class="p">(</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">save_segmentation_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>        <span class="n">save_measurement_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>    <span class="p">):</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">        Executes the full garment measurement pipeline for all images in the input directory.</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">    </span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">        This method processes each image through a multi-stage pipeline that includes garment classification, </span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a><span class="sd">        segmentation, landmark detection, optional refinement, and measurement derivation. During classification, </span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a><span class="sd">        the system identifies the type of garment (e.g., shirt, dress, pants). Segmentation follows, producing </span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a><span class="sd">        binary or instance masks that separate the garment from the background. Landmark detection is then </span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a><span class="sd">        performed to locate anatomical or garment-specific keypoints such as shoulders or waist positions. If </span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a><span class="sd">        enabled, an optional refinement step applies post-processing or model-based corrections to improve the </span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a><span class="sd">        accuracy of detected keypoints. Finally, the system calculates key garment dimensions - such as chest width, </span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a><span class="sd">        waist width, and full length - based on the detected landmarks. In addition to this processing pipeline, </span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a><span class="sd">        the method also manages data and visual output exports. For each input image, a cleaned JSON file is </span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a><span class="sd">        generated containing the predicted garment class, landmark coordinates, and the resulting measurements. </span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a><span class="sd">        Optionally, visual outputs such as segmentation masks and images annotated with landmarks and measurements </span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a><span class="sd">        can be saved to assist in inspection or debugging.</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a><span class="sd">    </span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a><span class="sd">        Args:</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a><span class="sd">            save_segmentation_image (bool): If True, saves segmentation masks and background-modified images.</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a><span class="sd">                                            Defaults to False.</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a><span class="sd">            save_measurement_image (bool): If True, saves images overlaid with detected landmarks and measurements.</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a><span class="sd">                                           Defaults to False.</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a><span class="sd">    </span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a><span class="sd">        Returns:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a><span class="sd">            tuple:</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a><span class="sd">                - metadata (pd.DataFrame): A DataFrame containing metadata for each processed image, such as:</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a><span class="sd">                    - Original image path</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a><span class="sd">                    - Paths to any saved segmentation or annotated images</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="sd">                    - Class and measurement results</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="sd">                - outputs (dict): A dictionary mapping image filenames to their detailed processing results, including:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="sd">                    - Predicted class</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">                    - Detected landmarks with coordinates and confidence scores</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a><span class="sd">                    - Calculated measurements</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">                    - File paths to any saved images (if applicable)</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">    </span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a><span class="sd">        Example of exported JSON:</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">            ```</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">            {</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a><span class="sd">                &quot;cloth_3.jpg&quot;: {</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">                    &quot;class&quot;: &quot;vest dress&quot;,</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">                    &quot;landmarks&quot;: {</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a><span class="sd">                        &quot;10&quot;: {</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">                            &quot;conf&quot;: 0.7269417643547058,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">                            &quot;x&quot;: 611.0,</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">                            &quot;y&quot;: 861.0</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">                        },</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">                        &quot;16&quot;: {</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">                            &quot;conf&quot;: 0.6769524812698364,</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">                            &quot;x&quot;: 1226.0,</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a><span class="sd">                            &quot;y&quot;: 838.0</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a><span class="sd">                        },</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a><span class="sd">                        &quot;17&quot;: {</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a><span class="sd">                            &quot;conf&quot;: 0.7472652196884155,</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a><span class="sd">                            &quot;x&quot;: 1213.0,</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a><span class="sd">                            &quot;y&quot;: 726.0</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a><span class="sd">                        },</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a><span class="sd">                        &quot;18&quot;: {</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a><span class="sd">                            &quot;conf&quot;: 0.7360446453094482,</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a><span class="sd">                            &quot;x&quot;: 1238.0,</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a><span class="sd">                            &quot;y&quot;: 613.0</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a><span class="sd">                        },</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="sd">                        &quot;2&quot;: {</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="sd">                            &quot;conf&quot;: 0.9256571531295776,</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="sd">                            &quot;x&quot;: 703.0,</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">                            &quot;y&quot;: 264.0</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a><span class="sd">                        },</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">                        &quot;20&quot;: {</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">                            &quot;x&quot;: 700.936,</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a><span class="sd">                            &quot;y&quot;: 2070.0</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">                        },</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">                        &quot;8&quot;: {</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a><span class="sd">                            &quot;conf&quot;: 0.7129100561141968,</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">                            &quot;x&quot;: 563.0,</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">                            &quot;y&quot;: 613.0</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a><span class="sd">                        },</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">                        &quot;9&quot;: {</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">                            &quot;conf&quot;: 0.8203497529029846,</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">                            &quot;x&quot;: 598.0,</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">                            &quot;y&quot;: 726.0</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">                        }</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">                    },</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">                    &quot;measurements&quot;: {</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">                        &quot;chest&quot;: {</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">                            &quot;distance&quot;: 675.0,</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a><span class="sd">                                &quot;end&quot;: &quot;18&quot;,</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a><span class="sd">                                &quot;start&quot;: &quot;8&quot;</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a><span class="sd">                            }</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a><span class="sd">                        },</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a><span class="sd">                        &quot;full length&quot;: {</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a><span class="sd">                            &quot;distance&quot;: 1806.0011794281863,</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a><span class="sd">                                &quot;end&quot;: &quot;20&quot;,</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a><span class="sd">                                &quot;start&quot;: &quot;2&quot;</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a><span class="sd">                            }</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a><span class="sd">                        },</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a><span class="sd">                        &quot;hips&quot;: {</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a><span class="sd">                            &quot;distance&quot;: 615.4299310238331,</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="sd">                                &quot;end&quot;: &quot;16&quot;,</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="sd">                                &quot;start&quot;: &quot;10&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">                            }</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a><span class="sd">                        },</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">                        &quot;waist&quot;: {</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">                            &quot;distance&quot;: 615.0,</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">                                &quot;end&quot;: &quot;17&quot;,</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">                                &quot;start&quot;: &quot;9&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a><span class="sd">                            }</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">                        }</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">                    }</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a><span class="sd">                }</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">            }</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">            ```</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="c1"># Some helper variables</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="n">use_bg_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a>        <span class="c1"># Step 1: Create the output directory</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>        <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a>        <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>        <span class="k">if</span> <span class="n">save_segmentation_image</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>            <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>        <span class="p">):</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>            <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mask_image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>            <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>                <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bg_modified_image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>                    <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>                <span class="p">)</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>        <span class="k">if</span> <span class="n">save_measurement_image</span><span class="p">:</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>            <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>                <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a>            <span class="p">)</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a>        <span class="c1"># Step 2: Collect image filenames from input_dir</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a>        <span class="n">image_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;*.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;*.png&quot;</span><span class="p">,</span> <span class="s2">&quot;*.bmp&quot;</span><span class="p">,</span> <span class="s2">&quot;*.tiff&quot;</span><span class="p">]</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>        <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="p">)</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a>        <span class="n">image_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a>        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">image_extensions</span><span class="p">:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>            <span class="n">image_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">input_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a>        <span class="c1"># Step 3: Determine column structure</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a>            <span class="s2">&quot;filename&quot;</span><span class="p">,</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a>            <span class="s2">&quot;class&quot;</span><span class="p">,</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a>            <span class="s2">&quot;mask_image&quot;</span> <span class="k">if</span> <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>            <span class="s2">&quot;bg_modified_image&quot;</span> <span class="k">if</span> <span class="n">use_bg_color</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a>            <span class="s2">&quot;measurement_image&quot;</span><span class="p">,</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a>            <span class="s2">&quot;measurement_json&quot;</span><span class="p">,</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>        <span class="p">]</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a>        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">image_files</span><span class="p">]</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a>        <span class="c1"># Step 4: Print start message and information</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start measuring </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> garment images ...&quot;</span><span class="p">)</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>                <span class="s2">&quot;There are 5 measurement steps: classification, segmentation, &quot;</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>                <span class="s2">&quot;landmark detection, landmark refinement, and landmark derivation.&quot;</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>            <span class="p">)</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="p">:</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>                <span class="s2">&quot;There are 4 measurement steps: classification, segmentation, &quot;</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>                <span class="s2">&quot;landmark detection, and landmark derivation.&quot;</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>            <span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>                <span class="s2">&quot;There are 4 measurement steps: classification, segmentation, &quot;</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>                <span class="s2">&quot;landmark detection, and landmark refinement.&quot;</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>            <span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>        <span class="k">elif</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>                <span class="s2">&quot;There are 3 measurement steps: classification, segmentation, &quot;</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>                <span class="s2">&quot;and landmark detection.&quot;</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>            <span class="p">)</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>                <span class="s2">&quot;There are 2 measurement steps: classification and landmark detection.&quot;</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>            <span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">))</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="c1"># Step 5: Classification</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>            <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Classification&quot;</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>        <span class="p">):</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>            <span class="n">label</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>            <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>            <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>        <span class="c1"># Step 6: Segmentation</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="k">if</span> <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">):</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">,</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>            <span class="p">):</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>                <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>                    <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bg_modified_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>                        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="p">,</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>                        <span class="s2">&quot;bg_modified_image&quot;</span><span class="p">:</span> <span class="n">bg_modified_image</span><span class="p">,</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a>                    <span class="p">}</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>                    <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a>                        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="p">,</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>                    <span class="p">}</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>        <span class="c1"># Step 7: Landmark detection</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a>            <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a>            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a>            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Landmark detection&quot;</span><span class="p">,</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>        <span class="p">):</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a>            <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a>                <span class="n">coords</span><span class="p">,</span> <span class="n">maxvals</span><span class="p">,</span> <span class="n">detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;bg_modified_image&quot;</span><span class="p">]</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a>                <span class="p">)</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detection_dict</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;maxvals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxvals</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>                <span class="n">coords</span><span class="p">,</span> <span class="n">maxvals</span><span class="p">,</span> <span class="n">detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a>                <span class="p">)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detection_dict</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;maxvals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxvals</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>        <span class="c1"># Step 8: Landmark refinement</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Landmark refinement&quot;</span><span class="p">,</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>            <span class="p">):</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>                <span class="n">updated_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>                    <span class="n">detection_np</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">],</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>                    <span class="n">detection_conf</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;maxvals&quot;</span><span class="p">],</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>                    <span class="n">detection_dict</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">],</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>                    <span class="n">mask</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">],</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>                <span class="p">)</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_coords</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_detection_dict</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="c1"># Step 9: Landmark derivation</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="p">:</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Landmark derivation&quot;</span><span class="p">,</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>            <span class="p">):</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>                <span class="n">derived_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>                    <span class="n">detection_dict</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">],</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>                    <span class="n">derivation_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">derivation_dict</span><span class="p">,</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a>                    <span class="n">landmark_coords</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">],</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a>                    <span class="n">np_mask</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">],</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a>                <span class="p">)</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_detection_dict</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a>        <span class="c1"># Step 10: Save segmentation image</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a>        <span class="k">if</span> <span class="n">save_segmentation_image</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>            <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a>        <span class="p">):</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Save segmentation image&quot;</span><span class="p">,</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a>            <span class="p">):</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a>                <span class="n">transformed_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a>                <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mask_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_mask.png&quot;</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a>                <span class="p">)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a>                    <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;mask_image&quot;</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mask_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_mask.png&quot;</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>                <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>                    <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;bg_modified_image&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bg_modified_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_bg_modified.png&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>                    <span class="p">)</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>                    <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>                        <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;bg_modified_image&quot;</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bg_modified_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_bg_modified.png&quot;</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>        <span class="c1"># Step 10: Save measurement image</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>        <span class="k">if</span> <span class="n">save_measurement_image</span><span class="p">:</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Save measurement image&quot;</span><span class="p">,</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>            <span class="p">):</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>                <span class="n">transformed_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>                <span class="n">image_to_save</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>                <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image_to_save</span><span class="p">)</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>                <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">load_default</span><span class="p">()</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>                <span class="n">landmarks</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="s2">&quot;landmarks&quot;</span><span class="p">]</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>                <span class="k">for</span> <span class="n">lm_id</span><span class="p">,</span> <span class="n">lm_data</span> <span class="ow">in</span> <span class="n">landmarks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lm_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">lm_data</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>                    <span class="n">radius</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>                    <span class="n">draw</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>                        <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">radius</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>                    <span class="p">)</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>                    <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">8</span><span class="p">),</span> <span class="n">lm_id</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>                <span class="n">image_to_save</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.png&quot;</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a>                <span class="p">)</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a>                    <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;measurement_image&quot;</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.png&quot;</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>        <span class="c1"># Step 11: Save measurement json</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a>            <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a>            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Save measurement json&quot;</span><span class="p">,</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a>        <span class="p">):</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a>            <span class="n">transformed_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a>            <span class="c1"># Clean the detection dictionary</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a>            <span class="n">final_dict</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">clean_detection_dict</span><span class="p">(</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>                <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a>                <span class="n">image_name</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a>                <span class="n">detection_dict</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">],</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>            <span class="p">)</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a>            <span class="c1"># Export JSON</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a>            <span class="n">utils</span><span class="o">.</span><span class="n">export_dict_to_json</span><span class="p">(</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>                <span class="n">data</span><span class="o">=</span><span class="n">final_dict</span><span class="p">,</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a>                <span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_json/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.json&quot;</span><span class="p">,</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a>            <span class="p">)</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a>            <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a>                <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;measurement_json&quot;</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_json/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.json&quot;</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a>        <span class="c1"># Step 12: Save metadata as a CSV</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a>        <span class="n">metadata</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/metadata.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a>        <span class="k">return</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">outputs</span>
</span></pre></div>


            </section>
                <section id="tailor">
                            <input id="tailor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">tailor</span>:

                <label class="view-source-button" for="tailor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tailor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tailor-17"><a href="#tailor-17"><span class="linenos"> 17</span></a><span class="k">class</span><span class="w"> </span><span class="nc">tailor</span><span class="p">:</span>
</span><span id="tailor-18"><a href="#tailor-18"><span class="linenos"> 18</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor-19"><a href="#tailor-19"><span class="linenos"> 19</span></a><span class="sd">    The `tailor` class acts as a central agent for the GarmentIQ pipeline,</span>
</span><span id="tailor-20"><a href="#tailor-20"><span class="linenos"> 20</span></a><span class="sd">    orchestrating garment measurement from classification to landmark derivation.</span>
</span><span id="tailor-21"><a href="#tailor-21"><span class="linenos"> 21</span></a>
</span><span id="tailor-22"><a href="#tailor-22"><span class="linenos"> 22</span></a><span class="sd">    It integrates functionalities from other modules (classification, segmentation, landmark)</span>
</span><span id="tailor-23"><a href="#tailor-23"><span class="linenos"> 23</span></a><span class="sd">    to provide a smooth end-to-end process for automated garment measurement from images.</span>
</span><span id="tailor-24"><a href="#tailor-24"><span class="linenos"> 24</span></a>
</span><span id="tailor-25"><a href="#tailor-25"><span class="linenos"> 25</span></a><span class="sd">    Attributes:</span>
</span><span id="tailor-26"><a href="#tailor-26"><span class="linenos"> 26</span></a><span class="sd">        input_dir (str): Directory containing input images.</span>
</span><span id="tailor-27"><a href="#tailor-27"><span class="linenos"> 27</span></a><span class="sd">        model_dir (str): Directory where models are stored.</span>
</span><span id="tailor-28"><a href="#tailor-28"><span class="linenos"> 28</span></a><span class="sd">        output_dir (str): Directory to save processed outputs.</span>
</span><span id="tailor-29"><a href="#tailor-29"><span class="linenos"> 29</span></a><span class="sd">        class_dict (dict): Dictionary defining garment classes and their properties.</span>
</span><span id="tailor-30"><a href="#tailor-30"><span class="linenos"> 30</span></a><span class="sd">        do_derive (bool): Flag to enable landmark derivation.</span>
</span><span id="tailor-31"><a href="#tailor-31"><span class="linenos"> 31</span></a><span class="sd">        do_refine (bool): Flag to enable landmark refinement.</span>
</span><span id="tailor-32"><a href="#tailor-32"><span class="linenos"> 32</span></a><span class="sd">        classification_model_path (str): Path to the classification model.</span>
</span><span id="tailor-33"><a href="#tailor-33"><span class="linenos"> 33</span></a><span class="sd">        classification_model_class (Type[nn.Module]): Class definition for the classification model.</span>
</span><span id="tailor-34"><a href="#tailor-34"><span class="linenos"> 34</span></a><span class="sd">        classification_model_args (Dict): Arguments for the classification model.</span>
</span><span id="tailor-35"><a href="#tailor-35"><span class="linenos"> 35</span></a><span class="sd">        segmentation_model_name (str): Name or path for the segmentation model.</span>
</span><span id="tailor-36"><a href="#tailor-36"><span class="linenos"> 36</span></a><span class="sd">        segmentation_model_args (Dict): Arguments for the segmentation model.</span>
</span><span id="tailor-37"><a href="#tailor-37"><span class="linenos"> 37</span></a><span class="sd">        landmark_detection_model_path (str): Path to the landmark detection model.</span>
</span><span id="tailor-38"><a href="#tailor-38"><span class="linenos"> 38</span></a><span class="sd">        landmark_detection_model_class (Type[nn.Module]): Class definition for the landmark detection model.</span>
</span><span id="tailor-39"><a href="#tailor-39"><span class="linenos"> 39</span></a><span class="sd">        landmark_detection_model_args (Dict): Arguments for the landmark detection model.</span>
</span><span id="tailor-40"><a href="#tailor-40"><span class="linenos"> 40</span></a><span class="sd">        refinement_args (Optional[Dict]): Arguments for landmark refinement.</span>
</span><span id="tailor-41"><a href="#tailor-41"><span class="linenos"> 41</span></a><span class="sd">        derivation_dict (Optional[Dict]): Dictionary for landmark derivation rules.</span>
</span><span id="tailor-42"><a href="#tailor-42"><span class="linenos"> 42</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="tailor-43"><a href="#tailor-43"><span class="linenos"> 43</span></a>
</span><span id="tailor-44"><a href="#tailor-44"><span class="linenos"> 44</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="tailor-45"><a href="#tailor-45"><span class="linenos"> 45</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="tailor-46"><a href="#tailor-46"><span class="linenos"> 46</span></a>        <span class="n">input_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor-47"><a href="#tailor-47"><span class="linenos"> 47</span></a>        <span class="n">model_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor-48"><a href="#tailor-48"><span class="linenos"> 48</span></a>        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor-49"><a href="#tailor-49"><span class="linenos"> 49</span></a>        <span class="n">class_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="tailor-50"><a href="#tailor-50"><span class="linenos"> 50</span></a>        <span class="n">do_derive</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="tailor-51"><a href="#tailor-51"><span class="linenos"> 51</span></a>        <span class="n">do_refine</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="tailor-52"><a href="#tailor-52"><span class="linenos"> 52</span></a>        <span class="n">classification_model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor-53"><a href="#tailor-53"><span class="linenos"> 53</span></a>        <span class="n">classification_model_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">],</span>
</span><span id="tailor-54"><a href="#tailor-54"><span class="linenos"> 54</span></a>        <span class="n">classification_model_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="tailor-55"><a href="#tailor-55"><span class="linenos"> 55</span></a>        <span class="n">segmentation_model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor-56"><a href="#tailor-56"><span class="linenos"> 56</span></a>        <span class="n">segmentation_model_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="tailor-57"><a href="#tailor-57"><span class="linenos"> 57</span></a>        <span class="n">landmark_detection_model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor-58"><a href="#tailor-58"><span class="linenos"> 58</span></a>        <span class="n">landmark_detection_model_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">],</span>
</span><span id="tailor-59"><a href="#tailor-59"><span class="linenos"> 59</span></a>        <span class="n">landmark_detection_model_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="tailor-60"><a href="#tailor-60"><span class="linenos"> 60</span></a>        <span class="n">refinement_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="tailor-61"><a href="#tailor-61"><span class="linenos"> 61</span></a>        <span class="n">derivation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="tailor-62"><a href="#tailor-62"><span class="linenos"> 62</span></a>    <span class="p">):</span>
</span><span id="tailor-63"><a href="#tailor-63"><span class="linenos"> 63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor-64"><a href="#tailor-64"><span class="linenos"> 64</span></a><span class="sd">        Initializes the `tailor` agent with paths, model configurations, and processing flags.</span>
</span><span id="tailor-65"><a href="#tailor-65"><span class="linenos"> 65</span></a>
</span><span id="tailor-66"><a href="#tailor-66"><span class="linenos"> 66</span></a><span class="sd">        Args:</span>
</span><span id="tailor-67"><a href="#tailor-67"><span class="linenos"> 67</span></a><span class="sd">            input_dir (str): Path to the directory containing input images.</span>
</span><span id="tailor-68"><a href="#tailor-68"><span class="linenos"> 68</span></a><span class="sd">            model_dir (str): Path to the directory where all required models are stored.</span>
</span><span id="tailor-69"><a href="#tailor-69"><span class="linenos"> 69</span></a><span class="sd">            output_dir (str): Path to the directory where all processed outputs will be saved.</span>
</span><span id="tailor-70"><a href="#tailor-70"><span class="linenos"> 70</span></a><span class="sd">            class_dict (dict): A dictionary defining the garment classes, their predefined points,</span>
</span><span id="tailor-71"><a href="#tailor-71"><span class="linenos"> 71</span></a><span class="sd">                                index ranges, and instruction JSON file paths.</span>
</span><span id="tailor-72"><a href="#tailor-72"><span class="linenos"> 72</span></a><span class="sd">            do_derive (bool): If True, enables the landmark derivation step.</span>
</span><span id="tailor-73"><a href="#tailor-73"><span class="linenos"> 73</span></a><span class="sd">            do_refine (bool): If True, enables the landmark refinement step.</span>
</span><span id="tailor-74"><a href="#tailor-74"><span class="linenos"> 74</span></a><span class="sd">            classification_model_path (str): The filename or relative path to the classification model.</span>
</span><span id="tailor-75"><a href="#tailor-75"><span class="linenos"> 75</span></a><span class="sd">            classification_model_class (Type[nn.Module]): The Python class of the classification model.</span>
</span><span id="tailor-76"><a href="#tailor-76"><span class="linenos"> 76</span></a><span class="sd">            classification_model_args (Dict): A dictionary of arguments to initialize the classification model.</span>
</span><span id="tailor-77"><a href="#tailor-77"><span class="linenos"> 77</span></a><span class="sd">            segmentation_model_name (str): The name or path of the pretrained segmentation model.</span>
</span><span id="tailor-78"><a href="#tailor-78"><span class="linenos"> 78</span></a><span class="sd">            segmentation_model_args (Dict): A dictionary of arguments for the segmentation model.</span>
</span><span id="tailor-79"><a href="#tailor-79"><span class="linenos"> 79</span></a><span class="sd">            landmark_detection_model_path (str): The filename or relative path to the landmark detection model.</span>
</span><span id="tailor-80"><a href="#tailor-80"><span class="linenos"> 80</span></a><span class="sd">            landmark_detection_model_class (Type[nn.Module]): The Python class of the landmark detection model.</span>
</span><span id="tailor-81"><a href="#tailor-81"><span class="linenos"> 81</span></a><span class="sd">            landmark_detection_model_args (Dict): A dictionary of arguments for the landmark detection model.</span>
</span><span id="tailor-82"><a href="#tailor-82"><span class="linenos"> 82</span></a><span class="sd">            refinement_args (Optional[Dict]): Optional arguments for the refinement process,</span>
</span><span id="tailor-83"><a href="#tailor-83"><span class="linenos"> 83</span></a><span class="sd">                                              e.g., `window_size`, `ksize`, `sigmaX`. Defaults to None.</span>
</span><span id="tailor-84"><a href="#tailor-84"><span class="linenos"> 84</span></a><span class="sd">            derivation_dict (Optional[Dict]): A dictionary defining derivation rules for non-predefined landmarks.</span>
</span><span id="tailor-85"><a href="#tailor-85"><span class="linenos"> 85</span></a><span class="sd">                                               Required if `do_derive` is True.</span>
</span><span id="tailor-86"><a href="#tailor-86"><span class="linenos"> 86</span></a>
</span><span id="tailor-87"><a href="#tailor-87"><span class="linenos"> 87</span></a><span class="sd">        Raises:</span>
</span><span id="tailor-88"><a href="#tailor-88"><span class="linenos"> 88</span></a><span class="sd">            ValueError: If `do_derive` is True but `derivation_dict` is None.</span>
</span><span id="tailor-89"><a href="#tailor-89"><span class="linenos"> 89</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor-90"><a href="#tailor-90"><span class="linenos"> 90</span></a>        <span class="c1"># Directories</span>
</span><span id="tailor-91"><a href="#tailor-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span> <span class="o">=</span> <span class="n">input_dir</span>
</span><span id="tailor-92"><a href="#tailor-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">=</span> <span class="n">model_dir</span>
</span><span id="tailor-93"><a href="#tailor-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
</span><span id="tailor-94"><a href="#tailor-94"><span class="linenos"> 94</span></a>
</span><span id="tailor-95"><a href="#tailor-95"><span class="linenos"> 95</span></a>        <span class="c1"># Classes</span>
</span><span id="tailor-96"><a href="#tailor-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_dict</span> <span class="o">=</span> <span class="n">class_dict</span>
</span><span id="tailor-97"><a href="#tailor-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">class_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="tailor-98"><a href="#tailor-98"><span class="linenos"> 98</span></a>
</span><span id="tailor-99"><a href="#tailor-99"><span class="linenos"> 99</span></a>        <span class="c1"># Derivation</span>
</span><span id="tailor-100"><a href="#tailor-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="o">=</span> <span class="n">do_derive</span>
</span><span id="tailor-101"><a href="#tailor-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="p">:</span>
</span><span id="tailor-102"><a href="#tailor-102"><span class="linenos">102</span></a>            <span class="k">if</span> <span class="n">derivation_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor-103"><a href="#tailor-103"><span class="linenos">103</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="tailor-104"><a href="#tailor-104"><span class="linenos">104</span></a>                    <span class="s2">&quot;`derivation_dict` must be provided if `do_derive=True`.&quot;</span>
</span><span id="tailor-105"><a href="#tailor-105"><span class="linenos">105</span></a>                <span class="p">)</span>
</span><span id="tailor-106"><a href="#tailor-106"><span class="linenos">106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">derivation_dict</span> <span class="o">=</span> <span class="n">derivation_dict</span>
</span><span id="tailor-107"><a href="#tailor-107"><span class="linenos">107</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="tailor-108"><a href="#tailor-108"><span class="linenos">108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">derivation_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="tailor-109"><a href="#tailor-109"><span class="linenos">109</span></a>
</span><span id="tailor-110"><a href="#tailor-110"><span class="linenos">110</span></a>        <span class="c1"># Refinement setup</span>
</span><span id="tailor-111"><a href="#tailor-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span> <span class="o">=</span> <span class="n">do_refine</span>
</span><span id="tailor-112"><a href="#tailor-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span> <span class="o">=</span> <span class="n">do_refine</span>
</span><span id="tailor-113"><a href="#tailor-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor-114"><a href="#tailor-114"><span class="linenos">114</span></a>            <span class="k">if</span> <span class="n">refinement_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor-115"><a href="#tailor-115"><span class="linenos">115</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="tailor-116"><a href="#tailor-116"><span class="linenos">116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span> <span class="o">=</span> <span class="n">refinement_args</span>
</span><span id="tailor-117"><a href="#tailor-117"><span class="linenos">117</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="tailor-118"><a href="#tailor-118"><span class="linenos">118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="tailor-119"><a href="#tailor-119"><span class="linenos">119</span></a>
</span><span id="tailor-120"><a href="#tailor-120"><span class="linenos">120</span></a>        <span class="c1"># Classification model setup</span>
</span><span id="tailor-121"><a href="#tailor-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_path</span> <span class="o">=</span> <span class="n">classification_model_path</span>
</span><span id="tailor-122"><a href="#tailor-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span> <span class="o">=</span> <span class="n">classification_model_args</span>
</span><span id="tailor-123"><a href="#tailor-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_class</span> <span class="o">=</span> <span class="n">classification_model_class</span>
</span><span id="tailor-124"><a href="#tailor-124"><span class="linenos">124</span></a>        <span class="n">filtered_model_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="tailor-125"><a href="#tailor-125"><span class="linenos">125</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="tailor-126"><a href="#tailor-126"><span class="linenos">126</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="tailor-127"><a href="#tailor-127"><span class="linenos">127</span></a>            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">,</span> <span class="s2">&quot;normalize_mean&quot;</span><span class="p">,</span> <span class="s2">&quot;normalize_std&quot;</span><span class="p">)</span>
</span><span id="tailor-128"><a href="#tailor-128"><span class="linenos">128</span></a>        <span class="p">}</span>
</span><span id="tailor-129"><a href="#tailor-129"><span class="linenos">129</span></a>
</span><span id="tailor-130"><a href="#tailor-130"><span class="linenos">130</span></a>        <span class="c1"># Load the model using the filtered arguments</span>
</span><span id="tailor-131"><a href="#tailor-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model</span> <span class="o">=</span> <span class="n">classification</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
</span><span id="tailor-132"><a href="#tailor-132"><span class="linenos">132</span></a>            <span class="n">model_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="tailor-133"><a href="#tailor-133"><span class="linenos">133</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_class</span><span class="p">,</span>
</span><span id="tailor-134"><a href="#tailor-134"><span class="linenos">134</span></a>            <span class="n">model_args</span><span class="o">=</span><span class="n">filtered_model_args</span><span class="p">,</span>
</span><span id="tailor-135"><a href="#tailor-135"><span class="linenos">135</span></a>        <span class="p">)</span>
</span><span id="tailor-136"><a href="#tailor-136"><span class="linenos">136</span></a>
</span><span id="tailor-137"><a href="#tailor-137"><span class="linenos">137</span></a>        <span class="c1"># Segmentation model setup</span>
</span><span id="tailor-138"><a href="#tailor-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_name</span> <span class="o">=</span> <span class="n">segmentation_model_name</span>
</span><span id="tailor-139"><a href="#tailor-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span> <span class="o">=</span> <span class="n">segmentation_model_args</span>
</span><span id="tailor-140"><a href="#tailor-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_has_bg_color</span> <span class="o">=</span> <span class="s2">&quot;background_color&quot;</span> <span class="ow">in</span> <span class="n">segmentation_model_args</span>
</span><span id="tailor-141"><a href="#tailor-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
</span><span id="tailor-142"><a href="#tailor-142"><span class="linenos">142</span></a>            <span class="n">pretrained_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_name</span><span class="p">,</span>
</span><span id="tailor-143"><a href="#tailor-143"><span class="linenos">143</span></a>            <span class="n">pretrained_model_args</span><span class="o">=</span><span class="p">{</span>
</span><span id="tailor-144"><a href="#tailor-144"><span class="linenos">144</span></a>                <span class="s2">&quot;trust_remote_code&quot;</span><span class="p">:</span> <span class="n">segmentation_model_args</span><span class="p">[</span><span class="s2">&quot;trust_remote_code&quot;</span><span class="p">]</span>
</span><span id="tailor-145"><a href="#tailor-145"><span class="linenos">145</span></a>            <span class="p">},</span>
</span><span id="tailor-146"><a href="#tailor-146"><span class="linenos">146</span></a>            <span class="n">high_precision</span><span class="o">=</span><span class="n">segmentation_model_args</span><span class="p">[</span><span class="s2">&quot;high_precision&quot;</span><span class="p">],</span>
</span><span id="tailor-147"><a href="#tailor-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="tailor-148"><a href="#tailor-148"><span class="linenos">148</span></a>
</span><span id="tailor-149"><a href="#tailor-149"><span class="linenos">149</span></a>        <span class="c1"># Landmark detection model setup</span>
</span><span id="tailor-150"><a href="#tailor-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_path</span> <span class="o">=</span> <span class="n">landmark_detection_model_path</span>
</span><span id="tailor-151"><a href="#tailor-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_class</span> <span class="o">=</span> <span class="n">landmark_detection_model_class</span>
</span><span id="tailor-152"><a href="#tailor-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span> <span class="o">=</span> <span class="n">landmark_detection_model_args</span>
</span><span id="tailor-153"><a href="#tailor-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
</span><span id="tailor-154"><a href="#tailor-154"><span class="linenos">154</span></a>            <span class="n">model_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="tailor-155"><a href="#tailor-155"><span class="linenos">155</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_class</span><span class="p">,</span>
</span><span id="tailor-156"><a href="#tailor-156"><span class="linenos">156</span></a>        <span class="p">)</span>
</span><span id="tailor-157"><a href="#tailor-157"><span class="linenos">157</span></a>
</span><span id="tailor-158"><a href="#tailor-158"><span class="linenos">158</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="tailor-159"><a href="#tailor-159"><span class="linenos">159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor-160"><a href="#tailor-160"><span class="linenos">160</span></a><span class="sd">        Prints a summary of the `tailor` agent&#39;s configuration, including directory paths,</span>
</span><span id="tailor-161"><a href="#tailor-161"><span class="linenos">161</span></a><span class="sd">        defined classes, processing options (refine, derive), and loaded models.</span>
</span><span id="tailor-162"><a href="#tailor-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor-163"><a href="#tailor-163"><span class="linenos">163</span></a>        <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
</span><span id="tailor-164"><a href="#tailor-164"><span class="linenos">164</span></a>        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="n">width</span>
</span><span id="tailor-165"><a href="#tailor-165"><span class="linenos">165</span></a>
</span><span id="tailor-166"><a href="#tailor-166"><span class="linenos">166</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="tailor-167"><a href="#tailor-167"><span class="linenos">167</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TAILOR AGENT SUMMARY&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
</span><span id="tailor-168"><a href="#tailor-168"><span class="linenos">168</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="tailor-169"><a href="#tailor-169"><span class="linenos">169</span></a>
</span><span id="tailor-170"><a href="#tailor-170"><span class="linenos">170</span></a>        <span class="c1"># Directories</span>
</span><span id="tailor-171"><a href="#tailor-171"><span class="linenos">171</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DIRECTORY PATHS&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="tailor-172"><a href="#tailor-172"><span class="linenos">172</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Input directory:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor-173"><a href="#tailor-173"><span class="linenos">173</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Model directory:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor-174"><a href="#tailor-174"><span class="linenos">174</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Output directory:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor-175"><a href="#tailor-175"><span class="linenos">175</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="tailor-176"><a href="#tailor-176"><span class="linenos">176</span></a>
</span><span id="tailor-177"><a href="#tailor-177"><span class="linenos">177</span></a>        <span class="c1"># Classes</span>
</span><span id="tailor-178"><a href="#tailor-178"><span class="linenos">178</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CLASSES&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="tailor-179"><a href="#tailor-179"><span class="linenos">179</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Class Index&#39;</span><span class="si">:</span><span class="s2">&lt;11</span><span class="si">}</span><span class="s2"> | Class Name&quot;</span><span class="p">)</span>
</span><span id="tailor-180"><a href="#tailor-180"><span class="linenos">180</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">11</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">66</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor-181"><a href="#tailor-181"><span class="linenos">181</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
</span><span id="tailor-182"><a href="#tailor-182"><span class="linenos">182</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">&lt;11</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="bp">cls</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor-183"><a href="#tailor-183"><span class="linenos">183</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="tailor-184"><a href="#tailor-184"><span class="linenos">184</span></a>
</span><span id="tailor-185"><a href="#tailor-185"><span class="linenos">185</span></a>        <span class="c1"># Flags</span>
</span><span id="tailor-186"><a href="#tailor-186"><span class="linenos">186</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OPTIONS&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="tailor-187"><a href="#tailor-187"><span class="linenos">187</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Do refine?:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor-188"><a href="#tailor-188"><span class="linenos">188</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Do derive?:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor-189"><a href="#tailor-189"><span class="linenos">189</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="tailor-190"><a href="#tailor-190"><span class="linenos">190</span></a>
</span><span id="tailor-191"><a href="#tailor-191"><span class="linenos">191</span></a>        <span class="c1"># Models</span>
</span><span id="tailor-192"><a href="#tailor-192"><span class="linenos">192</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MODELS&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="tailor-193"><a href="#tailor-193"><span class="linenos">193</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="tailor-194"><a href="#tailor-194"><span class="linenos">194</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Classification Model:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="tailor-195"><a href="#tailor-195"><span class="linenos">195</span></a>        <span class="p">)</span>
</span><span id="tailor-196"><a href="#tailor-196"><span class="linenos">196</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Segmentation Model:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor-197"><a href="#tailor-197"><span class="linenos">197</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;   Change BG color?:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_has_bg_color</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor-198"><a href="#tailor-198"><span class="linenos">198</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="tailor-199"><a href="#tailor-199"><span class="linenos">199</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Landmark Detection Model:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_class</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="tailor-200"><a href="#tailor-200"><span class="linenos">200</span></a>        <span class="p">)</span>
</span><span id="tailor-201"><a href="#tailor-201"><span class="linenos">201</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="tailor-202"><a href="#tailor-202"><span class="linenos">202</span></a>
</span><span id="tailor-203"><a href="#tailor-203"><span class="linenos">203</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="tailor-204"><a href="#tailor-204"><span class="linenos">204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor-205"><a href="#tailor-205"><span class="linenos">205</span></a><span class="sd">        Classifies a single garment image using the configured classification model.</span>
</span><span id="tailor-206"><a href="#tailor-206"><span class="linenos">206</span></a>
</span><span id="tailor-207"><a href="#tailor-207"><span class="linenos">207</span></a><span class="sd">        Args:</span>
</span><span id="tailor-208"><a href="#tailor-208"><span class="linenos">208</span></a><span class="sd">            image (str): The filename of the image to classify, located in `self.input_dir`.</span>
</span><span id="tailor-209"><a href="#tailor-209"><span class="linenos">209</span></a><span class="sd">            verbose (bool): If True, prints detailed classification output. Defaults to False.</span>
</span><span id="tailor-210"><a href="#tailor-210"><span class="linenos">210</span></a>
</span><span id="tailor-211"><a href="#tailor-211"><span class="linenos">211</span></a><span class="sd">        Returns:</span>
</span><span id="tailor-212"><a href="#tailor-212"><span class="linenos">212</span></a><span class="sd">            tuple:</span>
</span><span id="tailor-213"><a href="#tailor-213"><span class="linenos">213</span></a><span class="sd">                - label (str): The predicted class label of the garment.</span>
</span><span id="tailor-214"><a href="#tailor-214"><span class="linenos">214</span></a><span class="sd">                - probabilities (List[float]): A list of probabilities for each class.</span>
</span><span id="tailor-215"><a href="#tailor-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor-216"><a href="#tailor-216"><span class="linenos">216</span></a>        <span class="n">label</span><span class="p">,</span> <span class="n">probablities</span> <span class="o">=</span> <span class="n">classification</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
</span><span id="tailor-217"><a href="#tailor-217"><span class="linenos">217</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model</span><span class="p">,</span>
</span><span id="tailor-218"><a href="#tailor-218"><span class="linenos">218</span></a>            <span class="n">image_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="tailor-219"><a href="#tailor-219"><span class="linenos">219</span></a>            <span class="n">classes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span>
</span><span id="tailor-220"><a href="#tailor-220"><span class="linenos">220</span></a>            <span class="n">resize_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">),</span>
</span><span id="tailor-221"><a href="#tailor-221"><span class="linenos">221</span></a>            <span class="n">normalize_mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_mean&quot;</span><span class="p">),</span>
</span><span id="tailor-222"><a href="#tailor-222"><span class="linenos">222</span></a>            <span class="n">normalize_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_std&quot;</span><span class="p">),</span>
</span><span id="tailor-223"><a href="#tailor-223"><span class="linenos">223</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="tailor-224"><a href="#tailor-224"><span class="linenos">224</span></a>        <span class="p">)</span>
</span><span id="tailor-225"><a href="#tailor-225"><span class="linenos">225</span></a>        <span class="k">return</span> <span class="n">label</span><span class="p">,</span> <span class="n">probablities</span>
</span><span id="tailor-226"><a href="#tailor-226"><span class="linenos">226</span></a>
</span><span id="tailor-227"><a href="#tailor-227"><span class="linenos">227</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="tailor-228"><a href="#tailor-228"><span class="linenos">228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor-229"><a href="#tailor-229"><span class="linenos">229</span></a><span class="sd">        Segments a single garment image to extract its mask and optionally modifies the background color.</span>
</span><span id="tailor-230"><a href="#tailor-230"><span class="linenos">230</span></a>
</span><span id="tailor-231"><a href="#tailor-231"><span class="linenos">231</span></a><span class="sd">        Args:</span>
</span><span id="tailor-232"><a href="#tailor-232"><span class="linenos">232</span></a><span class="sd">            image (str): The filename of the image to segment, located in `self.input_dir`.</span>
</span><span id="tailor-233"><a href="#tailor-233"><span class="linenos">233</span></a>
</span><span id="tailor-234"><a href="#tailor-234"><span class="linenos">234</span></a><span class="sd">        Returns:</span>
</span><span id="tailor-235"><a href="#tailor-235"><span class="linenos">235</span></a><span class="sd">            tuple:</span>
</span><span id="tailor-236"><a href="#tailor-236"><span class="linenos">236</span></a><span class="sd">                - original_img (np.ndarray): The original image with the mask overlaid.</span>
</span><span id="tailor-237"><a href="#tailor-237"><span class="linenos">237</span></a><span class="sd">                - mask (np.ndarray): The binary segmentation mask.</span>
</span><span id="tailor-238"><a href="#tailor-238"><span class="linenos">238</span></a><span class="sd">                - bg_modified_img (np.ndarray, optional): The image with the background color changed,</span>
</span><span id="tailor-239"><a href="#tailor-239"><span class="linenos">239</span></a><span class="sd">                                                         returned only if `background_color` is specified</span>
</span><span id="tailor-240"><a href="#tailor-240"><span class="linenos">240</span></a><span class="sd">                                                         in `segmentation_model_args`.</span>
</span><span id="tailor-241"><a href="#tailor-241"><span class="linenos">241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor-242"><a href="#tailor-242"><span class="linenos">242</span></a>        <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
</span><span id="tailor-243"><a href="#tailor-243"><span class="linenos">243</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model</span><span class="p">,</span>
</span><span id="tailor-244"><a href="#tailor-244"><span class="linenos">244</span></a>            <span class="n">image_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="tailor-245"><a href="#tailor-245"><span class="linenos">245</span></a>            <span class="n">resize_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">),</span>
</span><span id="tailor-246"><a href="#tailor-246"><span class="linenos">246</span></a>            <span class="n">normalize_mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_mean&quot;</span><span class="p">),</span>
</span><span id="tailor-247"><a href="#tailor-247"><span class="linenos">247</span></a>            <span class="n">normalize_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_std&quot;</span><span class="p">),</span>
</span><span id="tailor-248"><a href="#tailor-248"><span class="linenos">248</span></a>            <span class="n">high_precision</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;high_precision&quot;</span><span class="p">),</span>
</span><span id="tailor-249"><a href="#tailor-249"><span class="linenos">249</span></a>        <span class="p">)</span>
</span><span id="tailor-250"><a href="#tailor-250"><span class="linenos">250</span></a>
</span><span id="tailor-251"><a href="#tailor-251"><span class="linenos">251</span></a>        <span class="n">background_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">)</span>
</span><span id="tailor-252"><a href="#tailor-252"><span class="linenos">252</span></a>
</span><span id="tailor-253"><a href="#tailor-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="n">background_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor-254"><a href="#tailor-254"><span class="linenos">254</span></a>            <span class="k">return</span> <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span>
</span><span id="tailor-255"><a href="#tailor-255"><span class="linenos">255</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="tailor-256"><a href="#tailor-256"><span class="linenos">256</span></a>            <span class="n">bg_modified_img</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">change_background_color</span><span class="p">(</span>
</span><span id="tailor-257"><a href="#tailor-257"><span class="linenos">257</span></a>                <span class="n">image_np</span><span class="o">=</span><span class="n">original_img</span><span class="p">,</span> <span class="n">mask_np</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">background_color</span>
</span><span id="tailor-258"><a href="#tailor-258"><span class="linenos">258</span></a>            <span class="p">)</span>
</span><span id="tailor-259"><a href="#tailor-259"><span class="linenos">259</span></a>            <span class="k">return</span> <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bg_modified_img</span>
</span><span id="tailor-260"><a href="#tailor-260"><span class="linenos">260</span></a>
</span><span id="tailor-261"><a href="#tailor-261"><span class="linenos">261</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
</span><span id="tailor-262"><a href="#tailor-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor-263"><a href="#tailor-263"><span class="linenos">263</span></a><span class="sd">        Detects predefined landmarks on a garment image based on its classified class.</span>
</span><span id="tailor-264"><a href="#tailor-264"><span class="linenos">264</span></a>
</span><span id="tailor-265"><a href="#tailor-265"><span class="linenos">265</span></a><span class="sd">        Args:</span>
</span><span id="tailor-266"><a href="#tailor-266"><span class="linenos">266</span></a><span class="sd">            class_name (str): The classified name of the garment.</span>
</span><span id="tailor-267"><a href="#tailor-267"><span class="linenos">267</span></a><span class="sd">            image (Union[str, np.ndarray]): The path to the image file or a NumPy array of the image.</span>
</span><span id="tailor-268"><a href="#tailor-268"><span class="linenos">268</span></a>
</span><span id="tailor-269"><a href="#tailor-269"><span class="linenos">269</span></a><span class="sd">        Returns:</span>
</span><span id="tailor-270"><a href="#tailor-270"><span class="linenos">270</span></a><span class="sd">            tuple:</span>
</span><span id="tailor-271"><a href="#tailor-271"><span class="linenos">271</span></a><span class="sd">                - coords (np.array): Detected landmark coordinates.</span>
</span><span id="tailor-272"><a href="#tailor-272"><span class="linenos">272</span></a><span class="sd">                - maxval (np.array): Confidence scores for detected landmarks.</span>
</span><span id="tailor-273"><a href="#tailor-273"><span class="linenos">273</span></a><span class="sd">                - detection_dict (dict): A dictionary containing detailed landmark detection data.</span>
</span><span id="tailor-274"><a href="#tailor-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor-275"><a href="#tailor-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="tailor-276"><a href="#tailor-276"><span class="linenos">276</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="tailor-277"><a href="#tailor-277"><span class="linenos">277</span></a>
</span><span id="tailor-278"><a href="#tailor-278"><span class="linenos">278</span></a>        <span class="n">coords</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">detection_dict</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
</span><span id="tailor-279"><a href="#tailor-279"><span class="linenos">279</span></a>            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
</span><span id="tailor-280"><a href="#tailor-280"><span class="linenos">280</span></a>            <span class="n">class_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_dict</span><span class="p">,</span>
</span><span id="tailor-281"><a href="#tailor-281"><span class="linenos">281</span></a>            <span class="n">image_path</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="tailor-282"><a href="#tailor-282"><span class="linenos">282</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model</span><span class="p">,</span>
</span><span id="tailor-283"><a href="#tailor-283"><span class="linenos">283</span></a>            <span class="n">scale_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scale_std&quot;</span><span class="p">),</span>
</span><span id="tailor-284"><a href="#tailor-284"><span class="linenos">284</span></a>            <span class="n">resize_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">),</span>
</span><span id="tailor-285"><a href="#tailor-285"><span class="linenos">285</span></a>            <span class="n">normalize_mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_mean&quot;</span><span class="p">),</span>
</span><span id="tailor-286"><a href="#tailor-286"><span class="linenos">286</span></a>            <span class="n">normalize_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_std&quot;</span><span class="p">),</span>
</span><span id="tailor-287"><a href="#tailor-287"><span class="linenos">287</span></a>        <span class="p">)</span>
</span><span id="tailor-288"><a href="#tailor-288"><span class="linenos">288</span></a>        <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">detection_dict</span>
</span><span id="tailor-289"><a href="#tailor-289"><span class="linenos">289</span></a>
</span><span id="tailor-290"><a href="#tailor-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">derive</span><span class="p">(</span>
</span><span id="tailor-291"><a href="#tailor-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="tailor-292"><a href="#tailor-292"><span class="linenos">292</span></a>        <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor-293"><a href="#tailor-293"><span class="linenos">293</span></a>        <span class="n">detection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="tailor-294"><a href="#tailor-294"><span class="linenos">294</span></a>        <span class="n">derivation_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="tailor-295"><a href="#tailor-295"><span class="linenos">295</span></a>        <span class="n">landmark_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor-296"><a href="#tailor-296"><span class="linenos">296</span></a>        <span class="n">np_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor-297"><a href="#tailor-297"><span class="linenos">297</span></a>    <span class="p">):</span>
</span><span id="tailor-298"><a href="#tailor-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor-299"><a href="#tailor-299"><span class="linenos">299</span></a><span class="sd">        Derives non-predefined landmark coordinates based on predefined landmarks and a mask.</span>
</span><span id="tailor-300"><a href="#tailor-300"><span class="linenos">300</span></a>
</span><span id="tailor-301"><a href="#tailor-301"><span class="linenos">301</span></a><span class="sd">        Args:</span>
</span><span id="tailor-302"><a href="#tailor-302"><span class="linenos">302</span></a><span class="sd">            class_name (str): The name of the garment class.</span>
</span><span id="tailor-303"><a href="#tailor-303"><span class="linenos">303</span></a><span class="sd">            detection_dict (dict): The dictionary containing detected landmarks.</span>
</span><span id="tailor-304"><a href="#tailor-304"><span class="linenos">304</span></a><span class="sd">            derivation_dict (dict): The dictionary defining derivation rules.</span>
</span><span id="tailor-305"><a href="#tailor-305"><span class="linenos">305</span></a><span class="sd">            landmark_coords (np.array): NumPy array of initial landmark coordinates.</span>
</span><span id="tailor-306"><a href="#tailor-306"><span class="linenos">306</span></a><span class="sd">            np_mask (np.array): NumPy array of the segmentation mask.</span>
</span><span id="tailor-307"><a href="#tailor-307"><span class="linenos">307</span></a>
</span><span id="tailor-308"><a href="#tailor-308"><span class="linenos">308</span></a><span class="sd">        Returns:</span>
</span><span id="tailor-309"><a href="#tailor-309"><span class="linenos">309</span></a><span class="sd">            tuple:</span>
</span><span id="tailor-310"><a href="#tailor-310"><span class="linenos">310</span></a><span class="sd">                - derived_coords (dict): A dictionary of the newly derived landmark coordinates.</span>
</span><span id="tailor-311"><a href="#tailor-311"><span class="linenos">311</span></a><span class="sd">                - updated_detection_dict (dict): The detection dictionary updated with derived landmarks.</span>
</span><span id="tailor-312"><a href="#tailor-312"><span class="linenos">312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor-313"><a href="#tailor-313"><span class="linenos">313</span></a>        <span class="n">derived_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span>
</span><span id="tailor-314"><a href="#tailor-314"><span class="linenos">314</span></a>            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
</span><span id="tailor-315"><a href="#tailor-315"><span class="linenos">315</span></a>            <span class="n">detection_dict</span><span class="o">=</span><span class="n">detection_dict</span><span class="p">,</span>
</span><span id="tailor-316"><a href="#tailor-316"><span class="linenos">316</span></a>            <span class="n">derivation_dict</span><span class="o">=</span><span class="n">derivation_dict</span><span class="p">,</span>
</span><span id="tailor-317"><a href="#tailor-317"><span class="linenos">317</span></a>            <span class="n">landmark_coords</span><span class="o">=</span><span class="n">landmark_coords</span><span class="p">,</span>
</span><span id="tailor-318"><a href="#tailor-318"><span class="linenos">318</span></a>            <span class="n">np_mask</span><span class="o">=</span><span class="n">np_mask</span><span class="p">,</span>
</span><span id="tailor-319"><a href="#tailor-319"><span class="linenos">319</span></a>        <span class="p">)</span>
</span><span id="tailor-320"><a href="#tailor-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="n">derived_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span>
</span><span id="tailor-321"><a href="#tailor-321"><span class="linenos">321</span></a>
</span><span id="tailor-322"><a href="#tailor-322"><span class="linenos">322</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refine</span><span class="p">(</span>
</span><span id="tailor-323"><a href="#tailor-323"><span class="linenos">323</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="tailor-324"><a href="#tailor-324"><span class="linenos">324</span></a>        <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor-325"><a href="#tailor-325"><span class="linenos">325</span></a>        <span class="n">detection_np</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor-326"><a href="#tailor-326"><span class="linenos">326</span></a>        <span class="n">detection_conf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor-327"><a href="#tailor-327"><span class="linenos">327</span></a>        <span class="n">detection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="tailor-328"><a href="#tailor-328"><span class="linenos">328</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor-329"><a href="#tailor-329"><span class="linenos">329</span></a>        <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="tailor-330"><a href="#tailor-330"><span class="linenos">330</span></a>        <span class="n">ksize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
</span><span id="tailor-331"><a href="#tailor-331"><span class="linenos">331</span></a>        <span class="n">sigmaX</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="tailor-332"><a href="#tailor-332"><span class="linenos">332</span></a>    <span class="p">):</span>
</span><span id="tailor-333"><a href="#tailor-333"><span class="linenos">333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor-334"><a href="#tailor-334"><span class="linenos">334</span></a><span class="sd">        Refines detected landmark coordinates using a blurred segmentation mask.</span>
</span><span id="tailor-335"><a href="#tailor-335"><span class="linenos">335</span></a>
</span><span id="tailor-336"><a href="#tailor-336"><span class="linenos">336</span></a><span class="sd">        Args:</span>
</span><span id="tailor-337"><a href="#tailor-337"><span class="linenos">337</span></a><span class="sd">            class_name (str): The name of the garment class.</span>
</span><span id="tailor-338"><a href="#tailor-338"><span class="linenos">338</span></a><span class="sd">            detection_np (np.array): NumPy array of initial landmark predictions.</span>
</span><span id="tailor-339"><a href="#tailor-339"><span class="linenos">339</span></a><span class="sd">            detection_conf (np.array): NumPy array of confidence scores for each predicted landmark.</span>
</span><span id="tailor-340"><a href="#tailor-340"><span class="linenos">340</span></a><span class="sd">            detection_dict (dict): Dictionary containing landmark data for each class.</span>
</span><span id="tailor-341"><a href="#tailor-341"><span class="linenos">341</span></a><span class="sd">            mask (np.array): Grayscale mask image used to guide refinement.</span>
</span><span id="tailor-342"><a href="#tailor-342"><span class="linenos">342</span></a><span class="sd">            window_size (int, optional): Size of the window used in the refinement algorithm. Defaults to 5.</span>
</span><span id="tailor-343"><a href="#tailor-343"><span class="linenos">343</span></a><span class="sd">            ksize (tuple, optional): Kernel size for Gaussian blur. Must be odd integers. Defaults to (11, 11).</span>
</span><span id="tailor-344"><a href="#tailor-344"><span class="linenos">344</span></a><span class="sd">            sigmaX (float, optional): Gaussian kernel standard deviation in the X direction. Defaults to 0.0.</span>
</span><span id="tailor-345"><a href="#tailor-345"><span class="linenos">345</span></a>
</span><span id="tailor-346"><a href="#tailor-346"><span class="linenos">346</span></a><span class="sd">        Returns:</span>
</span><span id="tailor-347"><a href="#tailor-347"><span class="linenos">347</span></a><span class="sd">            tuple:</span>
</span><span id="tailor-348"><a href="#tailor-348"><span class="linenos">348</span></a><span class="sd">                - refined_detection_np (np.array): Array of the same shape as `detection_np` with refined coordinates.</span>
</span><span id="tailor-349"><a href="#tailor-349"><span class="linenos">349</span></a><span class="sd">                - detection_dict (dict): Updated detection dictionary with refined landmark coordinates.</span>
</span><span id="tailor-350"><a href="#tailor-350"><span class="linenos">350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor-351"><a href="#tailor-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">:</span>
</span><span id="tailor-352"><a href="#tailor-352"><span class="linenos">352</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;window_size&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor-353"><a href="#tailor-353"><span class="linenos">353</span></a>                <span class="n">window_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">]</span>
</span><span id="tailor-354"><a href="#tailor-354"><span class="linenos">354</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ksize&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor-355"><a href="#tailor-355"><span class="linenos">355</span></a>                <span class="n">ksize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">[</span><span class="s2">&quot;ksize&quot;</span><span class="p">]</span>
</span><span id="tailor-356"><a href="#tailor-356"><span class="linenos">356</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sigmaX&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor-357"><a href="#tailor-357"><span class="linenos">357</span></a>                <span class="n">sigmaX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">[</span><span class="s2">&quot;sigmaX&quot;</span><span class="p">]</span>
</span><span id="tailor-358"><a href="#tailor-358"><span class="linenos">358</span></a>
</span><span id="tailor-359"><a href="#tailor-359"><span class="linenos">359</span></a>        <span class="n">refined_detection_np</span><span class="p">,</span> <span class="n">refined_detection_dict</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span>
</span><span id="tailor-360"><a href="#tailor-360"><span class="linenos">360</span></a>            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
</span><span id="tailor-361"><a href="#tailor-361"><span class="linenos">361</span></a>            <span class="n">detection_np</span><span class="o">=</span><span class="n">detection_np</span><span class="p">,</span>
</span><span id="tailor-362"><a href="#tailor-362"><span class="linenos">362</span></a>            <span class="n">detection_conf</span><span class="o">=</span><span class="n">detection_conf</span><span class="p">,</span>
</span><span id="tailor-363"><a href="#tailor-363"><span class="linenos">363</span></a>            <span class="n">detection_dict</span><span class="o">=</span><span class="n">detection_dict</span><span class="p">,</span>
</span><span id="tailor-364"><a href="#tailor-364"><span class="linenos">364</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="tailor-365"><a href="#tailor-365"><span class="linenos">365</span></a>            <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
</span><span id="tailor-366"><a href="#tailor-366"><span class="linenos">366</span></a>            <span class="n">ksize</span><span class="o">=</span><span class="n">ksize</span><span class="p">,</span>
</span><span id="tailor-367"><a href="#tailor-367"><span class="linenos">367</span></a>            <span class="n">sigmaX</span><span class="o">=</span><span class="n">sigmaX</span><span class="p">,</span>
</span><span id="tailor-368"><a href="#tailor-368"><span class="linenos">368</span></a>        <span class="p">)</span>
</span><span id="tailor-369"><a href="#tailor-369"><span class="linenos">369</span></a>
</span><span id="tailor-370"><a href="#tailor-370"><span class="linenos">370</span></a>        <span class="k">return</span> <span class="n">refined_detection_np</span><span class="p">,</span> <span class="n">refined_detection_dict</span>
</span><span id="tailor-371"><a href="#tailor-371"><span class="linenos">371</span></a>
</span><span id="tailor-372"><a href="#tailor-372"><span class="linenos">372</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">measure</span><span class="p">(</span>
</span><span id="tailor-373"><a href="#tailor-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="tailor-374"><a href="#tailor-374"><span class="linenos">374</span></a>        <span class="n">save_segmentation_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="tailor-375"><a href="#tailor-375"><span class="linenos">375</span></a>        <span class="n">save_measurement_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="tailor-376"><a href="#tailor-376"><span class="linenos">376</span></a>    <span class="p">):</span>
</span><span id="tailor-377"><a href="#tailor-377"><span class="linenos">377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor-378"><a href="#tailor-378"><span class="linenos">378</span></a><span class="sd">        Executes the full garment measurement pipeline for all images in the input directory.</span>
</span><span id="tailor-379"><a href="#tailor-379"><span class="linenos">379</span></a><span class="sd">    </span>
</span><span id="tailor-380"><a href="#tailor-380"><span class="linenos">380</span></a><span class="sd">        This method processes each image through a multi-stage pipeline that includes garment classification, </span>
</span><span id="tailor-381"><a href="#tailor-381"><span class="linenos">381</span></a><span class="sd">        segmentation, landmark detection, optional refinement, and measurement derivation. During classification, </span>
</span><span id="tailor-382"><a href="#tailor-382"><span class="linenos">382</span></a><span class="sd">        the system identifies the type of garment (e.g., shirt, dress, pants). Segmentation follows, producing </span>
</span><span id="tailor-383"><a href="#tailor-383"><span class="linenos">383</span></a><span class="sd">        binary or instance masks that separate the garment from the background. Landmark detection is then </span>
</span><span id="tailor-384"><a href="#tailor-384"><span class="linenos">384</span></a><span class="sd">        performed to locate anatomical or garment-specific keypoints such as shoulders or waist positions. If </span>
</span><span id="tailor-385"><a href="#tailor-385"><span class="linenos">385</span></a><span class="sd">        enabled, an optional refinement step applies post-processing or model-based corrections to improve the </span>
</span><span id="tailor-386"><a href="#tailor-386"><span class="linenos">386</span></a><span class="sd">        accuracy of detected keypoints. Finally, the system calculates key garment dimensions - such as chest width, </span>
</span><span id="tailor-387"><a href="#tailor-387"><span class="linenos">387</span></a><span class="sd">        waist width, and full length - based on the detected landmarks. In addition to this processing pipeline, </span>
</span><span id="tailor-388"><a href="#tailor-388"><span class="linenos">388</span></a><span class="sd">        the method also manages data and visual output exports. For each input image, a cleaned JSON file is </span>
</span><span id="tailor-389"><a href="#tailor-389"><span class="linenos">389</span></a><span class="sd">        generated containing the predicted garment class, landmark coordinates, and the resulting measurements. </span>
</span><span id="tailor-390"><a href="#tailor-390"><span class="linenos">390</span></a><span class="sd">        Optionally, visual outputs such as segmentation masks and images annotated with landmarks and measurements </span>
</span><span id="tailor-391"><a href="#tailor-391"><span class="linenos">391</span></a><span class="sd">        can be saved to assist in inspection or debugging.</span>
</span><span id="tailor-392"><a href="#tailor-392"><span class="linenos">392</span></a><span class="sd">    </span>
</span><span id="tailor-393"><a href="#tailor-393"><span class="linenos">393</span></a><span class="sd">        Args:</span>
</span><span id="tailor-394"><a href="#tailor-394"><span class="linenos">394</span></a><span class="sd">            save_segmentation_image (bool): If True, saves segmentation masks and background-modified images.</span>
</span><span id="tailor-395"><a href="#tailor-395"><span class="linenos">395</span></a><span class="sd">                                            Defaults to False.</span>
</span><span id="tailor-396"><a href="#tailor-396"><span class="linenos">396</span></a><span class="sd">            save_measurement_image (bool): If True, saves images overlaid with detected landmarks and measurements.</span>
</span><span id="tailor-397"><a href="#tailor-397"><span class="linenos">397</span></a><span class="sd">                                           Defaults to False.</span>
</span><span id="tailor-398"><a href="#tailor-398"><span class="linenos">398</span></a><span class="sd">    </span>
</span><span id="tailor-399"><a href="#tailor-399"><span class="linenos">399</span></a><span class="sd">        Returns:</span>
</span><span id="tailor-400"><a href="#tailor-400"><span class="linenos">400</span></a><span class="sd">            tuple:</span>
</span><span id="tailor-401"><a href="#tailor-401"><span class="linenos">401</span></a><span class="sd">                - metadata (pd.DataFrame): A DataFrame containing metadata for each processed image, such as:</span>
</span><span id="tailor-402"><a href="#tailor-402"><span class="linenos">402</span></a><span class="sd">                    - Original image path</span>
</span><span id="tailor-403"><a href="#tailor-403"><span class="linenos">403</span></a><span class="sd">                    - Paths to any saved segmentation or annotated images</span>
</span><span id="tailor-404"><a href="#tailor-404"><span class="linenos">404</span></a><span class="sd">                    - Class and measurement results</span>
</span><span id="tailor-405"><a href="#tailor-405"><span class="linenos">405</span></a><span class="sd">                - outputs (dict): A dictionary mapping image filenames to their detailed processing results, including:</span>
</span><span id="tailor-406"><a href="#tailor-406"><span class="linenos">406</span></a><span class="sd">                    - Predicted class</span>
</span><span id="tailor-407"><a href="#tailor-407"><span class="linenos">407</span></a><span class="sd">                    - Detected landmarks with coordinates and confidence scores</span>
</span><span id="tailor-408"><a href="#tailor-408"><span class="linenos">408</span></a><span class="sd">                    - Calculated measurements</span>
</span><span id="tailor-409"><a href="#tailor-409"><span class="linenos">409</span></a><span class="sd">                    - File paths to any saved images (if applicable)</span>
</span><span id="tailor-410"><a href="#tailor-410"><span class="linenos">410</span></a><span class="sd">    </span>
</span><span id="tailor-411"><a href="#tailor-411"><span class="linenos">411</span></a><span class="sd">        Example of exported JSON:</span>
</span><span id="tailor-412"><a href="#tailor-412"><span class="linenos">412</span></a><span class="sd">            ```</span>
</span><span id="tailor-413"><a href="#tailor-413"><span class="linenos">413</span></a><span class="sd">            {</span>
</span><span id="tailor-414"><a href="#tailor-414"><span class="linenos">414</span></a><span class="sd">                &quot;cloth_3.jpg&quot;: {</span>
</span><span id="tailor-415"><a href="#tailor-415"><span class="linenos">415</span></a><span class="sd">                    &quot;class&quot;: &quot;vest dress&quot;,</span>
</span><span id="tailor-416"><a href="#tailor-416"><span class="linenos">416</span></a><span class="sd">                    &quot;landmarks&quot;: {</span>
</span><span id="tailor-417"><a href="#tailor-417"><span class="linenos">417</span></a><span class="sd">                        &quot;10&quot;: {</span>
</span><span id="tailor-418"><a href="#tailor-418"><span class="linenos">418</span></a><span class="sd">                            &quot;conf&quot;: 0.7269417643547058,</span>
</span><span id="tailor-419"><a href="#tailor-419"><span class="linenos">419</span></a><span class="sd">                            &quot;x&quot;: 611.0,</span>
</span><span id="tailor-420"><a href="#tailor-420"><span class="linenos">420</span></a><span class="sd">                            &quot;y&quot;: 861.0</span>
</span><span id="tailor-421"><a href="#tailor-421"><span class="linenos">421</span></a><span class="sd">                        },</span>
</span><span id="tailor-422"><a href="#tailor-422"><span class="linenos">422</span></a><span class="sd">                        &quot;16&quot;: {</span>
</span><span id="tailor-423"><a href="#tailor-423"><span class="linenos">423</span></a><span class="sd">                            &quot;conf&quot;: 0.6769524812698364,</span>
</span><span id="tailor-424"><a href="#tailor-424"><span class="linenos">424</span></a><span class="sd">                            &quot;x&quot;: 1226.0,</span>
</span><span id="tailor-425"><a href="#tailor-425"><span class="linenos">425</span></a><span class="sd">                            &quot;y&quot;: 838.0</span>
</span><span id="tailor-426"><a href="#tailor-426"><span class="linenos">426</span></a><span class="sd">                        },</span>
</span><span id="tailor-427"><a href="#tailor-427"><span class="linenos">427</span></a><span class="sd">                        &quot;17&quot;: {</span>
</span><span id="tailor-428"><a href="#tailor-428"><span class="linenos">428</span></a><span class="sd">                            &quot;conf&quot;: 0.7472652196884155,</span>
</span><span id="tailor-429"><a href="#tailor-429"><span class="linenos">429</span></a><span class="sd">                            &quot;x&quot;: 1213.0,</span>
</span><span id="tailor-430"><a href="#tailor-430"><span class="linenos">430</span></a><span class="sd">                            &quot;y&quot;: 726.0</span>
</span><span id="tailor-431"><a href="#tailor-431"><span class="linenos">431</span></a><span class="sd">                        },</span>
</span><span id="tailor-432"><a href="#tailor-432"><span class="linenos">432</span></a><span class="sd">                        &quot;18&quot;: {</span>
</span><span id="tailor-433"><a href="#tailor-433"><span class="linenos">433</span></a><span class="sd">                            &quot;conf&quot;: 0.7360446453094482,</span>
</span><span id="tailor-434"><a href="#tailor-434"><span class="linenos">434</span></a><span class="sd">                            &quot;x&quot;: 1238.0,</span>
</span><span id="tailor-435"><a href="#tailor-435"><span class="linenos">435</span></a><span class="sd">                            &quot;y&quot;: 613.0</span>
</span><span id="tailor-436"><a href="#tailor-436"><span class="linenos">436</span></a><span class="sd">                        },</span>
</span><span id="tailor-437"><a href="#tailor-437"><span class="linenos">437</span></a><span class="sd">                        &quot;2&quot;: {</span>
</span><span id="tailor-438"><a href="#tailor-438"><span class="linenos">438</span></a><span class="sd">                            &quot;conf&quot;: 0.9256571531295776,</span>
</span><span id="tailor-439"><a href="#tailor-439"><span class="linenos">439</span></a><span class="sd">                            &quot;x&quot;: 703.0,</span>
</span><span id="tailor-440"><a href="#tailor-440"><span class="linenos">440</span></a><span class="sd">                            &quot;y&quot;: 264.0</span>
</span><span id="tailor-441"><a href="#tailor-441"><span class="linenos">441</span></a><span class="sd">                        },</span>
</span><span id="tailor-442"><a href="#tailor-442"><span class="linenos">442</span></a><span class="sd">                        &quot;20&quot;: {</span>
</span><span id="tailor-443"><a href="#tailor-443"><span class="linenos">443</span></a><span class="sd">                            &quot;x&quot;: 700.936,</span>
</span><span id="tailor-444"><a href="#tailor-444"><span class="linenos">444</span></a><span class="sd">                            &quot;y&quot;: 2070.0</span>
</span><span id="tailor-445"><a href="#tailor-445"><span class="linenos">445</span></a><span class="sd">                        },</span>
</span><span id="tailor-446"><a href="#tailor-446"><span class="linenos">446</span></a><span class="sd">                        &quot;8&quot;: {</span>
</span><span id="tailor-447"><a href="#tailor-447"><span class="linenos">447</span></a><span class="sd">                            &quot;conf&quot;: 0.7129100561141968,</span>
</span><span id="tailor-448"><a href="#tailor-448"><span class="linenos">448</span></a><span class="sd">                            &quot;x&quot;: 563.0,</span>
</span><span id="tailor-449"><a href="#tailor-449"><span class="linenos">449</span></a><span class="sd">                            &quot;y&quot;: 613.0</span>
</span><span id="tailor-450"><a href="#tailor-450"><span class="linenos">450</span></a><span class="sd">                        },</span>
</span><span id="tailor-451"><a href="#tailor-451"><span class="linenos">451</span></a><span class="sd">                        &quot;9&quot;: {</span>
</span><span id="tailor-452"><a href="#tailor-452"><span class="linenos">452</span></a><span class="sd">                            &quot;conf&quot;: 0.8203497529029846,</span>
</span><span id="tailor-453"><a href="#tailor-453"><span class="linenos">453</span></a><span class="sd">                            &quot;x&quot;: 598.0,</span>
</span><span id="tailor-454"><a href="#tailor-454"><span class="linenos">454</span></a><span class="sd">                            &quot;y&quot;: 726.0</span>
</span><span id="tailor-455"><a href="#tailor-455"><span class="linenos">455</span></a><span class="sd">                        }</span>
</span><span id="tailor-456"><a href="#tailor-456"><span class="linenos">456</span></a><span class="sd">                    },</span>
</span><span id="tailor-457"><a href="#tailor-457"><span class="linenos">457</span></a><span class="sd">                    &quot;measurements&quot;: {</span>
</span><span id="tailor-458"><a href="#tailor-458"><span class="linenos">458</span></a><span class="sd">                        &quot;chest&quot;: {</span>
</span><span id="tailor-459"><a href="#tailor-459"><span class="linenos">459</span></a><span class="sd">                            &quot;distance&quot;: 675.0,</span>
</span><span id="tailor-460"><a href="#tailor-460"><span class="linenos">460</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="tailor-461"><a href="#tailor-461"><span class="linenos">461</span></a><span class="sd">                                &quot;end&quot;: &quot;18&quot;,</span>
</span><span id="tailor-462"><a href="#tailor-462"><span class="linenos">462</span></a><span class="sd">                                &quot;start&quot;: &quot;8&quot;</span>
</span><span id="tailor-463"><a href="#tailor-463"><span class="linenos">463</span></a><span class="sd">                            }</span>
</span><span id="tailor-464"><a href="#tailor-464"><span class="linenos">464</span></a><span class="sd">                        },</span>
</span><span id="tailor-465"><a href="#tailor-465"><span class="linenos">465</span></a><span class="sd">                        &quot;full length&quot;: {</span>
</span><span id="tailor-466"><a href="#tailor-466"><span class="linenos">466</span></a><span class="sd">                            &quot;distance&quot;: 1806.0011794281863,</span>
</span><span id="tailor-467"><a href="#tailor-467"><span class="linenos">467</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="tailor-468"><a href="#tailor-468"><span class="linenos">468</span></a><span class="sd">                                &quot;end&quot;: &quot;20&quot;,</span>
</span><span id="tailor-469"><a href="#tailor-469"><span class="linenos">469</span></a><span class="sd">                                &quot;start&quot;: &quot;2&quot;</span>
</span><span id="tailor-470"><a href="#tailor-470"><span class="linenos">470</span></a><span class="sd">                            }</span>
</span><span id="tailor-471"><a href="#tailor-471"><span class="linenos">471</span></a><span class="sd">                        },</span>
</span><span id="tailor-472"><a href="#tailor-472"><span class="linenos">472</span></a><span class="sd">                        &quot;hips&quot;: {</span>
</span><span id="tailor-473"><a href="#tailor-473"><span class="linenos">473</span></a><span class="sd">                            &quot;distance&quot;: 615.4299310238331,</span>
</span><span id="tailor-474"><a href="#tailor-474"><span class="linenos">474</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="tailor-475"><a href="#tailor-475"><span class="linenos">475</span></a><span class="sd">                                &quot;end&quot;: &quot;16&quot;,</span>
</span><span id="tailor-476"><a href="#tailor-476"><span class="linenos">476</span></a><span class="sd">                                &quot;start&quot;: &quot;10&quot;</span>
</span><span id="tailor-477"><a href="#tailor-477"><span class="linenos">477</span></a><span class="sd">                            }</span>
</span><span id="tailor-478"><a href="#tailor-478"><span class="linenos">478</span></a><span class="sd">                        },</span>
</span><span id="tailor-479"><a href="#tailor-479"><span class="linenos">479</span></a><span class="sd">                        &quot;waist&quot;: {</span>
</span><span id="tailor-480"><a href="#tailor-480"><span class="linenos">480</span></a><span class="sd">                            &quot;distance&quot;: 615.0,</span>
</span><span id="tailor-481"><a href="#tailor-481"><span class="linenos">481</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="tailor-482"><a href="#tailor-482"><span class="linenos">482</span></a><span class="sd">                                &quot;end&quot;: &quot;17&quot;,</span>
</span><span id="tailor-483"><a href="#tailor-483"><span class="linenos">483</span></a><span class="sd">                                &quot;start&quot;: &quot;9&quot;</span>
</span><span id="tailor-484"><a href="#tailor-484"><span class="linenos">484</span></a><span class="sd">                            }</span>
</span><span id="tailor-485"><a href="#tailor-485"><span class="linenos">485</span></a><span class="sd">                        }</span>
</span><span id="tailor-486"><a href="#tailor-486"><span class="linenos">486</span></a><span class="sd">                    }</span>
</span><span id="tailor-487"><a href="#tailor-487"><span class="linenos">487</span></a><span class="sd">                }</span>
</span><span id="tailor-488"><a href="#tailor-488"><span class="linenos">488</span></a><span class="sd">            }</span>
</span><span id="tailor-489"><a href="#tailor-489"><span class="linenos">489</span></a><span class="sd">            ```</span>
</span><span id="tailor-490"><a href="#tailor-490"><span class="linenos">490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor-491"><a href="#tailor-491"><span class="linenos">491</span></a>        <span class="c1"># Some helper variables</span>
</span><span id="tailor-492"><a href="#tailor-492"><span class="linenos">492</span></a>        <span class="n">use_bg_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="tailor-493"><a href="#tailor-493"><span class="linenos">493</span></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="tailor-494"><a href="#tailor-494"><span class="linenos">494</span></a>
</span><span id="tailor-495"><a href="#tailor-495"><span class="linenos">495</span></a>        <span class="c1"># Step 1: Create the output directory</span>
</span><span id="tailor-496"><a href="#tailor-496"><span class="linenos">496</span></a>        <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="tailor-497"><a href="#tailor-497"><span class="linenos">497</span></a>        <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="tailor-498"><a href="#tailor-498"><span class="linenos">498</span></a>
</span><span id="tailor-499"><a href="#tailor-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="n">save_segmentation_image</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="tailor-500"><a href="#tailor-500"><span class="linenos">500</span></a>            <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span>
</span><span id="tailor-501"><a href="#tailor-501"><span class="linenos">501</span></a>        <span class="p">):</span>
</span><span id="tailor-502"><a href="#tailor-502"><span class="linenos">502</span></a>            <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mask_image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="tailor-503"><a href="#tailor-503"><span class="linenos">503</span></a>            <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor-504"><a href="#tailor-504"><span class="linenos">504</span></a>                <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bg_modified_image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="tailor-505"><a href="#tailor-505"><span class="linenos">505</span></a>                    <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="tailor-506"><a href="#tailor-506"><span class="linenos">506</span></a>                <span class="p">)</span>
</span><span id="tailor-507"><a href="#tailor-507"><span class="linenos">507</span></a>
</span><span id="tailor-508"><a href="#tailor-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="n">save_measurement_image</span><span class="p">:</span>
</span><span id="tailor-509"><a href="#tailor-509"><span class="linenos">509</span></a>            <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="tailor-510"><a href="#tailor-510"><span class="linenos">510</span></a>                <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="tailor-511"><a href="#tailor-511"><span class="linenos">511</span></a>            <span class="p">)</span>
</span><span id="tailor-512"><a href="#tailor-512"><span class="linenos">512</span></a>
</span><span id="tailor-513"><a href="#tailor-513"><span class="linenos">513</span></a>        <span class="c1"># Step 2: Collect image filenames from input_dir</span>
</span><span id="tailor-514"><a href="#tailor-514"><span class="linenos">514</span></a>        <span class="n">image_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;*.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;*.png&quot;</span><span class="p">,</span> <span class="s2">&quot;*.bmp&quot;</span><span class="p">,</span> <span class="s2">&quot;*.tiff&quot;</span><span class="p">]</span>
</span><span id="tailor-515"><a href="#tailor-515"><span class="linenos">515</span></a>        <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="p">)</span>
</span><span id="tailor-516"><a href="#tailor-516"><span class="linenos">516</span></a>
</span><span id="tailor-517"><a href="#tailor-517"><span class="linenos">517</span></a>        <span class="n">image_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="tailor-518"><a href="#tailor-518"><span class="linenos">518</span></a>        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">image_extensions</span><span class="p">:</span>
</span><span id="tailor-519"><a href="#tailor-519"><span class="linenos">519</span></a>            <span class="n">image_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">input_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span>
</span><span id="tailor-520"><a href="#tailor-520"><span class="linenos">520</span></a>
</span><span id="tailor-521"><a href="#tailor-521"><span class="linenos">521</span></a>        <span class="c1"># Step 3: Determine column structure</span>
</span><span id="tailor-522"><a href="#tailor-522"><span class="linenos">522</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="tailor-523"><a href="#tailor-523"><span class="linenos">523</span></a>            <span class="s2">&quot;filename&quot;</span><span class="p">,</span>
</span><span id="tailor-524"><a href="#tailor-524"><span class="linenos">524</span></a>            <span class="s2">&quot;class&quot;</span><span class="p">,</span>
</span><span id="tailor-525"><a href="#tailor-525"><span class="linenos">525</span></a>            <span class="s2">&quot;mask_image&quot;</span> <span class="k">if</span> <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="tailor-526"><a href="#tailor-526"><span class="linenos">526</span></a>            <span class="s2">&quot;bg_modified_image&quot;</span> <span class="k">if</span> <span class="n">use_bg_color</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="tailor-527"><a href="#tailor-527"><span class="linenos">527</span></a>            <span class="s2">&quot;measurement_image&quot;</span><span class="p">,</span>
</span><span id="tailor-528"><a href="#tailor-528"><span class="linenos">528</span></a>            <span class="s2">&quot;measurement_json&quot;</span><span class="p">,</span>
</span><span id="tailor-529"><a href="#tailor-529"><span class="linenos">529</span></a>        <span class="p">]</span>
</span><span id="tailor-530"><a href="#tailor-530"><span class="linenos">530</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="tailor-531"><a href="#tailor-531"><span class="linenos">531</span></a>
</span><span id="tailor-532"><a href="#tailor-532"><span class="linenos">532</span></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span><span id="tailor-533"><a href="#tailor-533"><span class="linenos">533</span></a>        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">image_files</span><span class="p">]</span>
</span><span id="tailor-534"><a href="#tailor-534"><span class="linenos">534</span></a>
</span><span id="tailor-535"><a href="#tailor-535"><span class="linenos">535</span></a>        <span class="c1"># Step 4: Print start message and information</span>
</span><span id="tailor-536"><a href="#tailor-536"><span class="linenos">536</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start measuring </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> garment images ...&quot;</span><span class="p">)</span>
</span><span id="tailor-537"><a href="#tailor-537"><span class="linenos">537</span></a>
</span><span id="tailor-538"><a href="#tailor-538"><span class="linenos">538</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor-539"><a href="#tailor-539"><span class="linenos">539</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor-540"><a href="#tailor-540"><span class="linenos">540</span></a>                <span class="s2">&quot;There are 5 measurement steps: classification, segmentation, &quot;</span>
</span><span id="tailor-541"><a href="#tailor-541"><span class="linenos">541</span></a>                <span class="s2">&quot;landmark detection, landmark refinement, and landmark derivation.&quot;</span>
</span><span id="tailor-542"><a href="#tailor-542"><span class="linenos">542</span></a>            <span class="p">)</span>
</span><span id="tailor-543"><a href="#tailor-543"><span class="linenos">543</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="p">:</span>
</span><span id="tailor-544"><a href="#tailor-544"><span class="linenos">544</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor-545"><a href="#tailor-545"><span class="linenos">545</span></a>                <span class="s2">&quot;There are 4 measurement steps: classification, segmentation, &quot;</span>
</span><span id="tailor-546"><a href="#tailor-546"><span class="linenos">546</span></a>                <span class="s2">&quot;landmark detection, and landmark derivation.&quot;</span>
</span><span id="tailor-547"><a href="#tailor-547"><span class="linenos">547</span></a>            <span class="p">)</span>
</span><span id="tailor-548"><a href="#tailor-548"><span class="linenos">548</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor-549"><a href="#tailor-549"><span class="linenos">549</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor-550"><a href="#tailor-550"><span class="linenos">550</span></a>                <span class="s2">&quot;There are 4 measurement steps: classification, segmentation, &quot;</span>
</span><span id="tailor-551"><a href="#tailor-551"><span class="linenos">551</span></a>                <span class="s2">&quot;landmark detection, and landmark refinement.&quot;</span>
</span><span id="tailor-552"><a href="#tailor-552"><span class="linenos">552</span></a>            <span class="p">)</span>
</span><span id="tailor-553"><a href="#tailor-553"><span class="linenos">553</span></a>        <span class="k">elif</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor-554"><a href="#tailor-554"><span class="linenos">554</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor-555"><a href="#tailor-555"><span class="linenos">555</span></a>                <span class="s2">&quot;There are 3 measurement steps: classification, segmentation, &quot;</span>
</span><span id="tailor-556"><a href="#tailor-556"><span class="linenos">556</span></a>                <span class="s2">&quot;and landmark detection.&quot;</span>
</span><span id="tailor-557"><a href="#tailor-557"><span class="linenos">557</span></a>            <span class="p">)</span>
</span><span id="tailor-558"><a href="#tailor-558"><span class="linenos">558</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="tailor-559"><a href="#tailor-559"><span class="linenos">559</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor-560"><a href="#tailor-560"><span class="linenos">560</span></a>                <span class="s2">&quot;There are 2 measurement steps: classification and landmark detection.&quot;</span>
</span><span id="tailor-561"><a href="#tailor-561"><span class="linenos">561</span></a>            <span class="p">)</span>
</span><span id="tailor-562"><a href="#tailor-562"><span class="linenos">562</span></a>
</span><span id="tailor-563"><a href="#tailor-563"><span class="linenos">563</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">))</span>
</span><span id="tailor-564"><a href="#tailor-564"><span class="linenos">564</span></a>
</span><span id="tailor-565"><a href="#tailor-565"><span class="linenos">565</span></a>        <span class="c1"># Step 5: Classification</span>
</span><span id="tailor-566"><a href="#tailor-566"><span class="linenos">566</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor-567"><a href="#tailor-567"><span class="linenos">567</span></a>            <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Classification&quot;</span>
</span><span id="tailor-568"><a href="#tailor-568"><span class="linenos">568</span></a>        <span class="p">):</span>
</span><span id="tailor-569"><a href="#tailor-569"><span class="linenos">569</span></a>            <span class="n">label</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="tailor-570"><a href="#tailor-570"><span class="linenos">570</span></a>            <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="tailor-571"><a href="#tailor-571"><span class="linenos">571</span></a>            <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="tailor-572"><a href="#tailor-572"><span class="linenos">572</span></a>
</span><span id="tailor-573"><a href="#tailor-573"><span class="linenos">573</span></a>        <span class="c1"># Step 6: Segmentation</span>
</span><span id="tailor-574"><a href="#tailor-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">):</span>
</span><span id="tailor-575"><a href="#tailor-575"><span class="linenos">575</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor-576"><a href="#tailor-576"><span class="linenos">576</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor-577"><a href="#tailor-577"><span class="linenos">577</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor-578"><a href="#tailor-578"><span class="linenos">578</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">,</span>
</span><span id="tailor-579"><a href="#tailor-579"><span class="linenos">579</span></a>            <span class="p">):</span>
</span><span id="tailor-580"><a href="#tailor-580"><span class="linenos">580</span></a>                <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor-581"><a href="#tailor-581"><span class="linenos">581</span></a>                    <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bg_modified_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
</span><span id="tailor-582"><a href="#tailor-582"><span class="linenos">582</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="tailor-583"><a href="#tailor-583"><span class="linenos">583</span></a>                        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="p">,</span>
</span><span id="tailor-584"><a href="#tailor-584"><span class="linenos">584</span></a>                        <span class="s2">&quot;bg_modified_image&quot;</span><span class="p">:</span> <span class="n">bg_modified_image</span><span class="p">,</span>
</span><span id="tailor-585"><a href="#tailor-585"><span class="linenos">585</span></a>                    <span class="p">}</span>
</span><span id="tailor-586"><a href="#tailor-586"><span class="linenos">586</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="tailor-587"><a href="#tailor-587"><span class="linenos">587</span></a>                    <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
</span><span id="tailor-588"><a href="#tailor-588"><span class="linenos">588</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="tailor-589"><a href="#tailor-589"><span class="linenos">589</span></a>                        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="p">,</span>
</span><span id="tailor-590"><a href="#tailor-590"><span class="linenos">590</span></a>                    <span class="p">}</span>
</span><span id="tailor-591"><a href="#tailor-591"><span class="linenos">591</span></a>
</span><span id="tailor-592"><a href="#tailor-592"><span class="linenos">592</span></a>        <span class="c1"># Step 7: Landmark detection</span>
</span><span id="tailor-593"><a href="#tailor-593"><span class="linenos">593</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor-594"><a href="#tailor-594"><span class="linenos">594</span></a>            <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor-595"><a href="#tailor-595"><span class="linenos">595</span></a>            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor-596"><a href="#tailor-596"><span class="linenos">596</span></a>            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Landmark detection&quot;</span><span class="p">,</span>
</span><span id="tailor-597"><a href="#tailor-597"><span class="linenos">597</span></a>        <span class="p">):</span>
</span><span id="tailor-598"><a href="#tailor-598"><span class="linenos">598</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor-599"><a href="#tailor-599"><span class="linenos">599</span></a>            <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor-600"><a href="#tailor-600"><span class="linenos">600</span></a>                <span class="n">coords</span><span class="p">,</span> <span class="n">maxvals</span><span class="p">,</span> <span class="n">detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
</span><span id="tailor-601"><a href="#tailor-601"><span class="linenos">601</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;bg_modified_image&quot;</span><span class="p">]</span>
</span><span id="tailor-602"><a href="#tailor-602"><span class="linenos">602</span></a>                <span class="p">)</span>
</span><span id="tailor-603"><a href="#tailor-603"><span class="linenos">603</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detection_dict</span>
</span><span id="tailor-604"><a href="#tailor-604"><span class="linenos">604</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor-605"><a href="#tailor-605"><span class="linenos">605</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="tailor-606"><a href="#tailor-606"><span class="linenos">606</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;maxvals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxvals</span>
</span><span id="tailor-607"><a href="#tailor-607"><span class="linenos">607</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="tailor-608"><a href="#tailor-608"><span class="linenos">608</span></a>                <span class="n">coords</span><span class="p">,</span> <span class="n">maxvals</span><span class="p">,</span> <span class="n">detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
</span><span id="tailor-609"><a href="#tailor-609"><span class="linenos">609</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image</span>
</span><span id="tailor-610"><a href="#tailor-610"><span class="linenos">610</span></a>                <span class="p">)</span>
</span><span id="tailor-611"><a href="#tailor-611"><span class="linenos">611</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detection_dict</span>
</span><span id="tailor-612"><a href="#tailor-612"><span class="linenos">612</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor-613"><a href="#tailor-613"><span class="linenos">613</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="tailor-614"><a href="#tailor-614"><span class="linenos">614</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;maxvals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxvals</span>
</span><span id="tailor-615"><a href="#tailor-615"><span class="linenos">615</span></a>
</span><span id="tailor-616"><a href="#tailor-616"><span class="linenos">616</span></a>        <span class="c1"># Step 8: Landmark refinement</span>
</span><span id="tailor-617"><a href="#tailor-617"><span class="linenos">617</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor-618"><a href="#tailor-618"><span class="linenos">618</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor-619"><a href="#tailor-619"><span class="linenos">619</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor-620"><a href="#tailor-620"><span class="linenos">620</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor-621"><a href="#tailor-621"><span class="linenos">621</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Landmark refinement&quot;</span><span class="p">,</span>
</span><span id="tailor-622"><a href="#tailor-622"><span class="linenos">622</span></a>            <span class="p">):</span>
</span><span id="tailor-623"><a href="#tailor-623"><span class="linenos">623</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor-624"><a href="#tailor-624"><span class="linenos">624</span></a>                <span class="n">updated_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span>
</span><span id="tailor-625"><a href="#tailor-625"><span class="linenos">625</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="tailor-626"><a href="#tailor-626"><span class="linenos">626</span></a>                    <span class="n">detection_np</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">],</span>
</span><span id="tailor-627"><a href="#tailor-627"><span class="linenos">627</span></a>                    <span class="n">detection_conf</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;maxvals&quot;</span><span class="p">],</span>
</span><span id="tailor-628"><a href="#tailor-628"><span class="linenos">628</span></a>                    <span class="n">detection_dict</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">],</span>
</span><span id="tailor-629"><a href="#tailor-629"><span class="linenos">629</span></a>                    <span class="n">mask</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">],</span>
</span><span id="tailor-630"><a href="#tailor-630"><span class="linenos">630</span></a>                <span class="p">)</span>
</span><span id="tailor-631"><a href="#tailor-631"><span class="linenos">631</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_coords</span>
</span><span id="tailor-632"><a href="#tailor-632"><span class="linenos">632</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_detection_dict</span>
</span><span id="tailor-633"><a href="#tailor-633"><span class="linenos">633</span></a>
</span><span id="tailor-634"><a href="#tailor-634"><span class="linenos">634</span></a>        <span class="c1"># Step 9: Landmark derivation</span>
</span><span id="tailor-635"><a href="#tailor-635"><span class="linenos">635</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="p">:</span>
</span><span id="tailor-636"><a href="#tailor-636"><span class="linenos">636</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor-637"><a href="#tailor-637"><span class="linenos">637</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor-638"><a href="#tailor-638"><span class="linenos">638</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor-639"><a href="#tailor-639"><span class="linenos">639</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Landmark derivation&quot;</span><span class="p">,</span>
</span><span id="tailor-640"><a href="#tailor-640"><span class="linenos">640</span></a>            <span class="p">):</span>
</span><span id="tailor-641"><a href="#tailor-641"><span class="linenos">641</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor-642"><a href="#tailor-642"><span class="linenos">642</span></a>                <span class="n">derived_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span>
</span><span id="tailor-643"><a href="#tailor-643"><span class="linenos">643</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="tailor-644"><a href="#tailor-644"><span class="linenos">644</span></a>                    <span class="n">detection_dict</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">],</span>
</span><span id="tailor-645"><a href="#tailor-645"><span class="linenos">645</span></a>                    <span class="n">derivation_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">derivation_dict</span><span class="p">,</span>
</span><span id="tailor-646"><a href="#tailor-646"><span class="linenos">646</span></a>                    <span class="n">landmark_coords</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">],</span>
</span><span id="tailor-647"><a href="#tailor-647"><span class="linenos">647</span></a>                    <span class="n">np_mask</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">],</span>
</span><span id="tailor-648"><a href="#tailor-648"><span class="linenos">648</span></a>                <span class="p">)</span>
</span><span id="tailor-649"><a href="#tailor-649"><span class="linenos">649</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_detection_dict</span>
</span><span id="tailor-650"><a href="#tailor-650"><span class="linenos">650</span></a>
</span><span id="tailor-651"><a href="#tailor-651"><span class="linenos">651</span></a>        <span class="c1"># Step 10: Save segmentation image</span>
</span><span id="tailor-652"><a href="#tailor-652"><span class="linenos">652</span></a>        <span class="k">if</span> <span class="n">save_segmentation_image</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="tailor-653"><a href="#tailor-653"><span class="linenos">653</span></a>            <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span>
</span><span id="tailor-654"><a href="#tailor-654"><span class="linenos">654</span></a>        <span class="p">):</span>
</span><span id="tailor-655"><a href="#tailor-655"><span class="linenos">655</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor-656"><a href="#tailor-656"><span class="linenos">656</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor-657"><a href="#tailor-657"><span class="linenos">657</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor-658"><a href="#tailor-658"><span class="linenos">658</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Save segmentation image&quot;</span><span class="p">,</span>
</span><span id="tailor-659"><a href="#tailor-659"><span class="linenos">659</span></a>            <span class="p">):</span>
</span><span id="tailor-660"><a href="#tailor-660"><span class="linenos">660</span></a>                <span class="n">transformed_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor-661"><a href="#tailor-661"><span class="linenos">661</span></a>                <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="tailor-662"><a href="#tailor-662"><span class="linenos">662</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mask_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_mask.png&quot;</span>
</span><span id="tailor-663"><a href="#tailor-663"><span class="linenos">663</span></a>                <span class="p">)</span>
</span><span id="tailor-664"><a href="#tailor-664"><span class="linenos">664</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="tailor-665"><a href="#tailor-665"><span class="linenos">665</span></a>                    <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;mask_image&quot;</span>
</span><span id="tailor-666"><a href="#tailor-666"><span class="linenos">666</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mask_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_mask.png&quot;</span>
</span><span id="tailor-667"><a href="#tailor-667"><span class="linenos">667</span></a>                <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor-668"><a href="#tailor-668"><span class="linenos">668</span></a>                    <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;bg_modified_image&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="tailor-669"><a href="#tailor-669"><span class="linenos">669</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bg_modified_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_bg_modified.png&quot;</span>
</span><span id="tailor-670"><a href="#tailor-670"><span class="linenos">670</span></a>                    <span class="p">)</span>
</span><span id="tailor-671"><a href="#tailor-671"><span class="linenos">671</span></a>                    <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="tailor-672"><a href="#tailor-672"><span class="linenos">672</span></a>                        <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;bg_modified_image&quot;</span>
</span><span id="tailor-673"><a href="#tailor-673"><span class="linenos">673</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bg_modified_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_bg_modified.png&quot;</span>
</span><span id="tailor-674"><a href="#tailor-674"><span class="linenos">674</span></a>
</span><span id="tailor-675"><a href="#tailor-675"><span class="linenos">675</span></a>        <span class="c1"># Step 10: Save measurement image</span>
</span><span id="tailor-676"><a href="#tailor-676"><span class="linenos">676</span></a>        <span class="k">if</span> <span class="n">save_measurement_image</span><span class="p">:</span>
</span><span id="tailor-677"><a href="#tailor-677"><span class="linenos">677</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor-678"><a href="#tailor-678"><span class="linenos">678</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor-679"><a href="#tailor-679"><span class="linenos">679</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor-680"><a href="#tailor-680"><span class="linenos">680</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Save measurement image&quot;</span><span class="p">,</span>
</span><span id="tailor-681"><a href="#tailor-681"><span class="linenos">681</span></a>            <span class="p">):</span>
</span><span id="tailor-682"><a href="#tailor-682"><span class="linenos">682</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor-683"><a href="#tailor-683"><span class="linenos">683</span></a>                <span class="n">transformed_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor-684"><a href="#tailor-684"><span class="linenos">684</span></a>
</span><span id="tailor-685"><a href="#tailor-685"><span class="linenos">685</span></a>                <span class="n">image_to_save</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
</span><span id="tailor-686"><a href="#tailor-686"><span class="linenos">686</span></a>                <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image_to_save</span><span class="p">)</span>
</span><span id="tailor-687"><a href="#tailor-687"><span class="linenos">687</span></a>                <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">load_default</span><span class="p">()</span>
</span><span id="tailor-688"><a href="#tailor-688"><span class="linenos">688</span></a>                <span class="n">landmarks</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="s2">&quot;landmarks&quot;</span><span class="p">]</span>
</span><span id="tailor-689"><a href="#tailor-689"><span class="linenos">689</span></a>
</span><span id="tailor-690"><a href="#tailor-690"><span class="linenos">690</span></a>                <span class="k">for</span> <span class="n">lm_id</span><span class="p">,</span> <span class="n">lm_data</span> <span class="ow">in</span> <span class="n">landmarks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="tailor-691"><a href="#tailor-691"><span class="linenos">691</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lm_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">lm_data</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
</span><span id="tailor-692"><a href="#tailor-692"><span class="linenos">692</span></a>                    <span class="n">radius</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="tailor-693"><a href="#tailor-693"><span class="linenos">693</span></a>                    <span class="n">draw</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span>
</span><span id="tailor-694"><a href="#tailor-694"><span class="linenos">694</span></a>                        <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">radius</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
</span><span id="tailor-695"><a href="#tailor-695"><span class="linenos">695</span></a>                    <span class="p">)</span>
</span><span id="tailor-696"><a href="#tailor-696"><span class="linenos">696</span></a>                    <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">8</span><span class="p">),</span> <span class="n">lm_id</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
</span><span id="tailor-697"><a href="#tailor-697"><span class="linenos">697</span></a>
</span><span id="tailor-698"><a href="#tailor-698"><span class="linenos">698</span></a>                <span class="n">image_to_save</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="tailor-699"><a href="#tailor-699"><span class="linenos">699</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.png&quot;</span>
</span><span id="tailor-700"><a href="#tailor-700"><span class="linenos">700</span></a>                <span class="p">)</span>
</span><span id="tailor-701"><a href="#tailor-701"><span class="linenos">701</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="tailor-702"><a href="#tailor-702"><span class="linenos">702</span></a>                    <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;measurement_image&quot;</span>
</span><span id="tailor-703"><a href="#tailor-703"><span class="linenos">703</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.png&quot;</span>
</span><span id="tailor-704"><a href="#tailor-704"><span class="linenos">704</span></a>
</span><span id="tailor-705"><a href="#tailor-705"><span class="linenos">705</span></a>        <span class="c1"># Step 11: Save measurement json</span>
</span><span id="tailor-706"><a href="#tailor-706"><span class="linenos">706</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor-707"><a href="#tailor-707"><span class="linenos">707</span></a>            <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor-708"><a href="#tailor-708"><span class="linenos">708</span></a>            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor-709"><a href="#tailor-709"><span class="linenos">709</span></a>            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Save measurement json&quot;</span><span class="p">,</span>
</span><span id="tailor-710"><a href="#tailor-710"><span class="linenos">710</span></a>        <span class="p">):</span>
</span><span id="tailor-711"><a href="#tailor-711"><span class="linenos">711</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor-712"><a href="#tailor-712"><span class="linenos">712</span></a>            <span class="n">transformed_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor-713"><a href="#tailor-713"><span class="linenos">713</span></a>
</span><span id="tailor-714"><a href="#tailor-714"><span class="linenos">714</span></a>            <span class="c1"># Clean the detection dictionary</span>
</span><span id="tailor-715"><a href="#tailor-715"><span class="linenos">715</span></a>            <span class="n">final_dict</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">clean_detection_dict</span><span class="p">(</span>
</span><span id="tailor-716"><a href="#tailor-716"><span class="linenos">716</span></a>                <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="tailor-717"><a href="#tailor-717"><span class="linenos">717</span></a>                <span class="n">image_name</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="tailor-718"><a href="#tailor-718"><span class="linenos">718</span></a>                <span class="n">detection_dict</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">],</span>
</span><span id="tailor-719"><a href="#tailor-719"><span class="linenos">719</span></a>            <span class="p">)</span>
</span><span id="tailor-720"><a href="#tailor-720"><span class="linenos">720</span></a>
</span><span id="tailor-721"><a href="#tailor-721"><span class="linenos">721</span></a>            <span class="c1"># Export JSON</span>
</span><span id="tailor-722"><a href="#tailor-722"><span class="linenos">722</span></a>            <span class="n">utils</span><span class="o">.</span><span class="n">export_dict_to_json</span><span class="p">(</span>
</span><span id="tailor-723"><a href="#tailor-723"><span class="linenos">723</span></a>                <span class="n">data</span><span class="o">=</span><span class="n">final_dict</span><span class="p">,</span>
</span><span id="tailor-724"><a href="#tailor-724"><span class="linenos">724</span></a>                <span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_json/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.json&quot;</span><span class="p">,</span>
</span><span id="tailor-725"><a href="#tailor-725"><span class="linenos">725</span></a>            <span class="p">)</span>
</span><span id="tailor-726"><a href="#tailor-726"><span class="linenos">726</span></a>
</span><span id="tailor-727"><a href="#tailor-727"><span class="linenos">727</span></a>            <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="tailor-728"><a href="#tailor-728"><span class="linenos">728</span></a>                <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;measurement_json&quot;</span>
</span><span id="tailor-729"><a href="#tailor-729"><span class="linenos">729</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_json/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.json&quot;</span>
</span><span id="tailor-730"><a href="#tailor-730"><span class="linenos">730</span></a>
</span><span id="tailor-731"><a href="#tailor-731"><span class="linenos">731</span></a>        <span class="c1"># Step 12: Save metadata as a CSV</span>
</span><span id="tailor-732"><a href="#tailor-732"><span class="linenos">732</span></a>        <span class="n">metadata</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/metadata.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="tailor-733"><a href="#tailor-733"><span class="linenos">733</span></a>
</span><span id="tailor-734"><a href="#tailor-734"><span class="linenos">734</span></a>        <span class="k">return</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">outputs</span>
</span></pre></div>


            <div class="docstring"><p>The <code><a href="#tailor">tailor</a></code> class acts as a central agent for the GarmentIQ pipeline,
orchestrating garment measurement from classification to landmark derivation.</p>

<p>It integrates functionalities from other modules (classification, segmentation, landmark)
to provide a smooth end-to-end process for automated garment measurement from images.</p>

<h6 id="attributes">Attributes:</h6>

<ul>
<li><strong>input_dir (str):</strong>  Directory containing input images.</li>
<li><strong>model_dir (str):</strong>  Directory where models are stored.</li>
<li><strong>output_dir (str):</strong>  Directory to save processed outputs.</li>
<li><strong>class_dict (dict):</strong>  Dictionary defining garment classes and their properties.</li>
<li><strong>do_derive (bool):</strong>  Flag to enable landmark derivation.</li>
<li><strong>do_refine (bool):</strong>  Flag to enable landmark refinement.</li>
<li><strong>classification_model_path (str):</strong>  Path to the classification model.</li>
<li><strong>classification_model_class (Type[nn.Module]):</strong>  Class definition for the classification model.</li>
<li><strong>classification_model_args (Dict):</strong>  Arguments for the classification model.</li>
<li><strong>segmentation_model_name (str):</strong>  Name or path for the segmentation model.</li>
<li><strong>segmentation_model_args (Dict):</strong>  Arguments for the segmentation model.</li>
<li><strong>landmark_detection_model_path (str):</strong>  Path to the landmark detection model.</li>
<li><strong>landmark_detection_model_class (Type[nn.Module]):</strong>  Class definition for the landmark detection model.</li>
<li><strong>landmark_detection_model_args (Dict):</strong>  Arguments for the landmark detection model.</li>
<li><strong>refinement_args (Optional[Dict]):</strong>  Arguments for landmark refinement.</li>
<li><strong>derivation_dict (Optional[Dict]):</strong>  Dictionary for landmark derivation rules.</li>
</ul>
</div>


                            <div id="tailor.__init__" class="classattr">
                                        <input id="tailor.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">tailor</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">input_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">model_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">class_dict</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">do_derive</span><span class="p">:</span> <span class="nb">bool</span>,</span><span class="param">	<span class="n">do_refine</span><span class="p">:</span> <span class="nb">bool</span>,</span><span class="param">	<span class="n">classification_model_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">classification_model_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">classification_model_args</span><span class="p">:</span> <span class="n">Dict</span>,</span><span class="param">	<span class="n">segmentation_model_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">segmentation_model_args</span><span class="p">:</span> <span class="n">Dict</span>,</span><span class="param">	<span class="n">landmark_detection_model_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">landmark_detection_model_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">Module</span><span class="p">]</span>,</span><span class="param">	<span class="n">landmark_detection_model_args</span><span class="p">:</span> <span class="n">Dict</span>,</span><span class="param">	<span class="n">refinement_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">derivation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="tailor.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tailor.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tailor.__init__-44"><a href="#tailor.__init__-44"><span class="linenos"> 44</span></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="tailor.__init__-45"><a href="#tailor.__init__-45"><span class="linenos"> 45</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="tailor.__init__-46"><a href="#tailor.__init__-46"><span class="linenos"> 46</span></a>        <span class="n">input_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor.__init__-47"><a href="#tailor.__init__-47"><span class="linenos"> 47</span></a>        <span class="n">model_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor.__init__-48"><a href="#tailor.__init__-48"><span class="linenos"> 48</span></a>        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor.__init__-49"><a href="#tailor.__init__-49"><span class="linenos"> 49</span></a>        <span class="n">class_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="tailor.__init__-50"><a href="#tailor.__init__-50"><span class="linenos"> 50</span></a>        <span class="n">do_derive</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="tailor.__init__-51"><a href="#tailor.__init__-51"><span class="linenos"> 51</span></a>        <span class="n">do_refine</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="tailor.__init__-52"><a href="#tailor.__init__-52"><span class="linenos"> 52</span></a>        <span class="n">classification_model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor.__init__-53"><a href="#tailor.__init__-53"><span class="linenos"> 53</span></a>        <span class="n">classification_model_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">],</span>
</span><span id="tailor.__init__-54"><a href="#tailor.__init__-54"><span class="linenos"> 54</span></a>        <span class="n">classification_model_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="tailor.__init__-55"><a href="#tailor.__init__-55"><span class="linenos"> 55</span></a>        <span class="n">segmentation_model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor.__init__-56"><a href="#tailor.__init__-56"><span class="linenos"> 56</span></a>        <span class="n">segmentation_model_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="tailor.__init__-57"><a href="#tailor.__init__-57"><span class="linenos"> 57</span></a>        <span class="n">landmark_detection_model_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor.__init__-58"><a href="#tailor.__init__-58"><span class="linenos"> 58</span></a>        <span class="n">landmark_detection_model_class</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">],</span>
</span><span id="tailor.__init__-59"><a href="#tailor.__init__-59"><span class="linenos"> 59</span></a>        <span class="n">landmark_detection_model_args</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
</span><span id="tailor.__init__-60"><a href="#tailor.__init__-60"><span class="linenos"> 60</span></a>        <span class="n">refinement_args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="tailor.__init__-61"><a href="#tailor.__init__-61"><span class="linenos"> 61</span></a>        <span class="n">derivation_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="tailor.__init__-62"><a href="#tailor.__init__-62"><span class="linenos"> 62</span></a>    <span class="p">):</span>
</span><span id="tailor.__init__-63"><a href="#tailor.__init__-63"><span class="linenos"> 63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor.__init__-64"><a href="#tailor.__init__-64"><span class="linenos"> 64</span></a><span class="sd">        Initializes the `tailor` agent with paths, model configurations, and processing flags.</span>
</span><span id="tailor.__init__-65"><a href="#tailor.__init__-65"><span class="linenos"> 65</span></a>
</span><span id="tailor.__init__-66"><a href="#tailor.__init__-66"><span class="linenos"> 66</span></a><span class="sd">        Args:</span>
</span><span id="tailor.__init__-67"><a href="#tailor.__init__-67"><span class="linenos"> 67</span></a><span class="sd">            input_dir (str): Path to the directory containing input images.</span>
</span><span id="tailor.__init__-68"><a href="#tailor.__init__-68"><span class="linenos"> 68</span></a><span class="sd">            model_dir (str): Path to the directory where all required models are stored.</span>
</span><span id="tailor.__init__-69"><a href="#tailor.__init__-69"><span class="linenos"> 69</span></a><span class="sd">            output_dir (str): Path to the directory where all processed outputs will be saved.</span>
</span><span id="tailor.__init__-70"><a href="#tailor.__init__-70"><span class="linenos"> 70</span></a><span class="sd">            class_dict (dict): A dictionary defining the garment classes, their predefined points,</span>
</span><span id="tailor.__init__-71"><a href="#tailor.__init__-71"><span class="linenos"> 71</span></a><span class="sd">                                index ranges, and instruction JSON file paths.</span>
</span><span id="tailor.__init__-72"><a href="#tailor.__init__-72"><span class="linenos"> 72</span></a><span class="sd">            do_derive (bool): If True, enables the landmark derivation step.</span>
</span><span id="tailor.__init__-73"><a href="#tailor.__init__-73"><span class="linenos"> 73</span></a><span class="sd">            do_refine (bool): If True, enables the landmark refinement step.</span>
</span><span id="tailor.__init__-74"><a href="#tailor.__init__-74"><span class="linenos"> 74</span></a><span class="sd">            classification_model_path (str): The filename or relative path to the classification model.</span>
</span><span id="tailor.__init__-75"><a href="#tailor.__init__-75"><span class="linenos"> 75</span></a><span class="sd">            classification_model_class (Type[nn.Module]): The Python class of the classification model.</span>
</span><span id="tailor.__init__-76"><a href="#tailor.__init__-76"><span class="linenos"> 76</span></a><span class="sd">            classification_model_args (Dict): A dictionary of arguments to initialize the classification model.</span>
</span><span id="tailor.__init__-77"><a href="#tailor.__init__-77"><span class="linenos"> 77</span></a><span class="sd">            segmentation_model_name (str): The name or path of the pretrained segmentation model.</span>
</span><span id="tailor.__init__-78"><a href="#tailor.__init__-78"><span class="linenos"> 78</span></a><span class="sd">            segmentation_model_args (Dict): A dictionary of arguments for the segmentation model.</span>
</span><span id="tailor.__init__-79"><a href="#tailor.__init__-79"><span class="linenos"> 79</span></a><span class="sd">            landmark_detection_model_path (str): The filename or relative path to the landmark detection model.</span>
</span><span id="tailor.__init__-80"><a href="#tailor.__init__-80"><span class="linenos"> 80</span></a><span class="sd">            landmark_detection_model_class (Type[nn.Module]): The Python class of the landmark detection model.</span>
</span><span id="tailor.__init__-81"><a href="#tailor.__init__-81"><span class="linenos"> 81</span></a><span class="sd">            landmark_detection_model_args (Dict): A dictionary of arguments for the landmark detection model.</span>
</span><span id="tailor.__init__-82"><a href="#tailor.__init__-82"><span class="linenos"> 82</span></a><span class="sd">            refinement_args (Optional[Dict]): Optional arguments for the refinement process,</span>
</span><span id="tailor.__init__-83"><a href="#tailor.__init__-83"><span class="linenos"> 83</span></a><span class="sd">                                              e.g., `window_size`, `ksize`, `sigmaX`. Defaults to None.</span>
</span><span id="tailor.__init__-84"><a href="#tailor.__init__-84"><span class="linenos"> 84</span></a><span class="sd">            derivation_dict (Optional[Dict]): A dictionary defining derivation rules for non-predefined landmarks.</span>
</span><span id="tailor.__init__-85"><a href="#tailor.__init__-85"><span class="linenos"> 85</span></a><span class="sd">                                               Required if `do_derive` is True.</span>
</span><span id="tailor.__init__-86"><a href="#tailor.__init__-86"><span class="linenos"> 86</span></a>
</span><span id="tailor.__init__-87"><a href="#tailor.__init__-87"><span class="linenos"> 87</span></a><span class="sd">        Raises:</span>
</span><span id="tailor.__init__-88"><a href="#tailor.__init__-88"><span class="linenos"> 88</span></a><span class="sd">            ValueError: If `do_derive` is True but `derivation_dict` is None.</span>
</span><span id="tailor.__init__-89"><a href="#tailor.__init__-89"><span class="linenos"> 89</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor.__init__-90"><a href="#tailor.__init__-90"><span class="linenos"> 90</span></a>        <span class="c1"># Directories</span>
</span><span id="tailor.__init__-91"><a href="#tailor.__init__-91"><span class="linenos"> 91</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span> <span class="o">=</span> <span class="n">input_dir</span>
</span><span id="tailor.__init__-92"><a href="#tailor.__init__-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span> <span class="o">=</span> <span class="n">model_dir</span>
</span><span id="tailor.__init__-93"><a href="#tailor.__init__-93"><span class="linenos"> 93</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">output_dir</span>
</span><span id="tailor.__init__-94"><a href="#tailor.__init__-94"><span class="linenos"> 94</span></a>
</span><span id="tailor.__init__-95"><a href="#tailor.__init__-95"><span class="linenos"> 95</span></a>        <span class="c1"># Classes</span>
</span><span id="tailor.__init__-96"><a href="#tailor.__init__-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">class_dict</span> <span class="o">=</span> <span class="n">class_dict</span>
</span><span id="tailor.__init__-97"><a href="#tailor.__init__-97"><span class="linenos"> 97</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">class_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="tailor.__init__-98"><a href="#tailor.__init__-98"><span class="linenos"> 98</span></a>
</span><span id="tailor.__init__-99"><a href="#tailor.__init__-99"><span class="linenos"> 99</span></a>        <span class="c1"># Derivation</span>
</span><span id="tailor.__init__-100"><a href="#tailor.__init__-100"><span class="linenos">100</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="o">=</span> <span class="n">do_derive</span>
</span><span id="tailor.__init__-101"><a href="#tailor.__init__-101"><span class="linenos">101</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="p">:</span>
</span><span id="tailor.__init__-102"><a href="#tailor.__init__-102"><span class="linenos">102</span></a>            <span class="k">if</span> <span class="n">derivation_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor.__init__-103"><a href="#tailor.__init__-103"><span class="linenos">103</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="tailor.__init__-104"><a href="#tailor.__init__-104"><span class="linenos">104</span></a>                    <span class="s2">&quot;`derivation_dict` must be provided if `do_derive=True`.&quot;</span>
</span><span id="tailor.__init__-105"><a href="#tailor.__init__-105"><span class="linenos">105</span></a>                <span class="p">)</span>
</span><span id="tailor.__init__-106"><a href="#tailor.__init__-106"><span class="linenos">106</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">derivation_dict</span> <span class="o">=</span> <span class="n">derivation_dict</span>
</span><span id="tailor.__init__-107"><a href="#tailor.__init__-107"><span class="linenos">107</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="tailor.__init__-108"><a href="#tailor.__init__-108"><span class="linenos">108</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">derivation_dict</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="tailor.__init__-109"><a href="#tailor.__init__-109"><span class="linenos">109</span></a>
</span><span id="tailor.__init__-110"><a href="#tailor.__init__-110"><span class="linenos">110</span></a>        <span class="c1"># Refinement setup</span>
</span><span id="tailor.__init__-111"><a href="#tailor.__init__-111"><span class="linenos">111</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span> <span class="o">=</span> <span class="n">do_refine</span>
</span><span id="tailor.__init__-112"><a href="#tailor.__init__-112"><span class="linenos">112</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span> <span class="o">=</span> <span class="n">do_refine</span>
</span><span id="tailor.__init__-113"><a href="#tailor.__init__-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor.__init__-114"><a href="#tailor.__init__-114"><span class="linenos">114</span></a>            <span class="k">if</span> <span class="n">refinement_args</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor.__init__-115"><a href="#tailor.__init__-115"><span class="linenos">115</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="tailor.__init__-116"><a href="#tailor.__init__-116"><span class="linenos">116</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span> <span class="o">=</span> <span class="n">refinement_args</span>
</span><span id="tailor.__init__-117"><a href="#tailor.__init__-117"><span class="linenos">117</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="tailor.__init__-118"><a href="#tailor.__init__-118"><span class="linenos">118</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="tailor.__init__-119"><a href="#tailor.__init__-119"><span class="linenos">119</span></a>
</span><span id="tailor.__init__-120"><a href="#tailor.__init__-120"><span class="linenos">120</span></a>        <span class="c1"># Classification model setup</span>
</span><span id="tailor.__init__-121"><a href="#tailor.__init__-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_path</span> <span class="o">=</span> <span class="n">classification_model_path</span>
</span><span id="tailor.__init__-122"><a href="#tailor.__init__-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span> <span class="o">=</span> <span class="n">classification_model_args</span>
</span><span id="tailor.__init__-123"><a href="#tailor.__init__-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_class</span> <span class="o">=</span> <span class="n">classification_model_class</span>
</span><span id="tailor.__init__-124"><a href="#tailor.__init__-124"><span class="linenos">124</span></a>        <span class="n">filtered_model_args</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="tailor.__init__-125"><a href="#tailor.__init__-125"><span class="linenos">125</span></a>            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
</span><span id="tailor.__init__-126"><a href="#tailor.__init__-126"><span class="linenos">126</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="tailor.__init__-127"><a href="#tailor.__init__-127"><span class="linenos">127</span></a>            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">,</span> <span class="s2">&quot;normalize_mean&quot;</span><span class="p">,</span> <span class="s2">&quot;normalize_std&quot;</span><span class="p">)</span>
</span><span id="tailor.__init__-128"><a href="#tailor.__init__-128"><span class="linenos">128</span></a>        <span class="p">}</span>
</span><span id="tailor.__init__-129"><a href="#tailor.__init__-129"><span class="linenos">129</span></a>
</span><span id="tailor.__init__-130"><a href="#tailor.__init__-130"><span class="linenos">130</span></a>        <span class="c1"># Load the model using the filtered arguments</span>
</span><span id="tailor.__init__-131"><a href="#tailor.__init__-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">classification_model</span> <span class="o">=</span> <span class="n">classification</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
</span><span id="tailor.__init__-132"><a href="#tailor.__init__-132"><span class="linenos">132</span></a>            <span class="n">model_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="tailor.__init__-133"><a href="#tailor.__init__-133"><span class="linenos">133</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_class</span><span class="p">,</span>
</span><span id="tailor.__init__-134"><a href="#tailor.__init__-134"><span class="linenos">134</span></a>            <span class="n">model_args</span><span class="o">=</span><span class="n">filtered_model_args</span><span class="p">,</span>
</span><span id="tailor.__init__-135"><a href="#tailor.__init__-135"><span class="linenos">135</span></a>        <span class="p">)</span>
</span><span id="tailor.__init__-136"><a href="#tailor.__init__-136"><span class="linenos">136</span></a>
</span><span id="tailor.__init__-137"><a href="#tailor.__init__-137"><span class="linenos">137</span></a>        <span class="c1"># Segmentation model setup</span>
</span><span id="tailor.__init__-138"><a href="#tailor.__init__-138"><span class="linenos">138</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_name</span> <span class="o">=</span> <span class="n">segmentation_model_name</span>
</span><span id="tailor.__init__-139"><a href="#tailor.__init__-139"><span class="linenos">139</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span> <span class="o">=</span> <span class="n">segmentation_model_args</span>
</span><span id="tailor.__init__-140"><a href="#tailor.__init__-140"><span class="linenos">140</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_has_bg_color</span> <span class="o">=</span> <span class="s2">&quot;background_color&quot;</span> <span class="ow">in</span> <span class="n">segmentation_model_args</span>
</span><span id="tailor.__init__-141"><a href="#tailor.__init__-141"><span class="linenos">141</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
</span><span id="tailor.__init__-142"><a href="#tailor.__init__-142"><span class="linenos">142</span></a>            <span class="n">pretrained_model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_name</span><span class="p">,</span>
</span><span id="tailor.__init__-143"><a href="#tailor.__init__-143"><span class="linenos">143</span></a>            <span class="n">pretrained_model_args</span><span class="o">=</span><span class="p">{</span>
</span><span id="tailor.__init__-144"><a href="#tailor.__init__-144"><span class="linenos">144</span></a>                <span class="s2">&quot;trust_remote_code&quot;</span><span class="p">:</span> <span class="n">segmentation_model_args</span><span class="p">[</span><span class="s2">&quot;trust_remote_code&quot;</span><span class="p">]</span>
</span><span id="tailor.__init__-145"><a href="#tailor.__init__-145"><span class="linenos">145</span></a>            <span class="p">},</span>
</span><span id="tailor.__init__-146"><a href="#tailor.__init__-146"><span class="linenos">146</span></a>            <span class="n">high_precision</span><span class="o">=</span><span class="n">segmentation_model_args</span><span class="p">[</span><span class="s2">&quot;high_precision&quot;</span><span class="p">],</span>
</span><span id="tailor.__init__-147"><a href="#tailor.__init__-147"><span class="linenos">147</span></a>        <span class="p">)</span>
</span><span id="tailor.__init__-148"><a href="#tailor.__init__-148"><span class="linenos">148</span></a>
</span><span id="tailor.__init__-149"><a href="#tailor.__init__-149"><span class="linenos">149</span></a>        <span class="c1"># Landmark detection model setup</span>
</span><span id="tailor.__init__-150"><a href="#tailor.__init__-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_path</span> <span class="o">=</span> <span class="n">landmark_detection_model_path</span>
</span><span id="tailor.__init__-151"><a href="#tailor.__init__-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_class</span> <span class="o">=</span> <span class="n">landmark_detection_model_class</span>
</span><span id="tailor.__init__-152"><a href="#tailor.__init__-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span> <span class="o">=</span> <span class="n">landmark_detection_model_args</span>
</span><span id="tailor.__init__-153"><a href="#tailor.__init__-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">detection</span><span class="o">.</span><span class="n">load_model</span><span class="p">(</span>
</span><span id="tailor.__init__-154"><a href="#tailor.__init__-154"><span class="linenos">154</span></a>            <span class="n">model_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="tailor.__init__-155"><a href="#tailor.__init__-155"><span class="linenos">155</span></a>            <span class="n">model_class</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_class</span><span class="p">,</span>
</span><span id="tailor.__init__-156"><a href="#tailor.__init__-156"><span class="linenos">156</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initializes the <code><a href="#tailor">tailor</a></code> agent with paths, model configurations, and processing flags.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>input_dir (str):</strong>  Path to the directory containing input images.</li>
<li><strong>model_dir (str):</strong>  Path to the directory where all required models are stored.</li>
<li><strong>output_dir (str):</strong>  Path to the directory where all processed outputs will be saved.</li>
<li><strong>class_dict (dict):</strong>  A dictionary defining the garment classes, their predefined points,
index ranges, and instruction JSON file paths.</li>
<li><strong>do_derive (bool):</strong>  If True, enables the landmark derivation step.</li>
<li><strong>do_refine (bool):</strong>  If True, enables the landmark refinement step.</li>
<li><strong>classification_model_path (str):</strong>  The filename or relative path to the classification model.</li>
<li><strong>classification_model_class (Type[nn.Module]):</strong>  The Python class of the classification model.</li>
<li><strong>classification_model_args (Dict):</strong>  A dictionary of arguments to initialize the classification model.</li>
<li><strong>segmentation_model_name (str):</strong>  The name or path of the pretrained segmentation model.</li>
<li><strong>segmentation_model_args (Dict):</strong>  A dictionary of arguments for the segmentation model.</li>
<li><strong>landmark_detection_model_path (str):</strong>  The filename or relative path to the landmark detection model.</li>
<li><strong>landmark_detection_model_class (Type[nn.Module]):</strong>  The Python class of the landmark detection model.</li>
<li><strong>landmark_detection_model_args (Dict):</strong>  A dictionary of arguments for the landmark detection model.</li>
<li><strong>refinement_args (Optional[Dict]):</strong>  Optional arguments for the refinement process,
e.g., <code>window_size</code>, <code>ksize</code>, <code>sigmaX</code>. Defaults to None.</li>
<li><strong>derivation_dict (Optional[Dict]):</strong>  A dictionary defining derivation rules for non-predefined landmarks.
Required if <code><a href="#tailor.do_derive">do_derive</a></code> is True.</li>
</ul>

<h6 id="raises">Raises:</h6>

<ul>
<li><strong>ValueError:</strong>  If <code><a href="#tailor.do_derive">do_derive</a></code> is True but <code>derivation_dict</code> is None.</li>
</ul>
</div>


                            </div>
                            <div id="tailor.input_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">input_dir</span>

        
    </div>
    <a class="headerlink" href="#tailor.input_dir"></a>
    
    

                            </div>
                            <div id="tailor.model_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">model_dir</span>

        
    </div>
    <a class="headerlink" href="#tailor.model_dir"></a>
    
    

                            </div>
                            <div id="tailor.output_dir" class="classattr">
                                <div class="attr variable">
            <span class="name">output_dir</span>

        
    </div>
    <a class="headerlink" href="#tailor.output_dir"></a>
    
    

                            </div>
                            <div id="tailor.class_dict" class="classattr">
                                <div class="attr variable">
            <span class="name">class_dict</span>

        
    </div>
    <a class="headerlink" href="#tailor.class_dict"></a>
    
    

                            </div>
                            <div id="tailor.classes" class="classattr">
                                <div class="attr variable">
            <span class="name">classes</span>

        
    </div>
    <a class="headerlink" href="#tailor.classes"></a>
    
    

                            </div>
                            <div id="tailor.do_derive" class="classattr">
                                <div class="attr variable">
            <span class="name">do_derive</span>

        
    </div>
    <a class="headerlink" href="#tailor.do_derive"></a>
    
    

                            </div>
                            <div id="tailor.do_refine" class="classattr">
                                <div class="attr variable">
            <span class="name">do_refine</span>

        
    </div>
    <a class="headerlink" href="#tailor.do_refine"></a>
    
    

                            </div>
                            <div id="tailor.classification_model_path" class="classattr">
                                <div class="attr variable">
            <span class="name">classification_model_path</span>

        
    </div>
    <a class="headerlink" href="#tailor.classification_model_path"></a>
    
    

                            </div>
                            <div id="tailor.classification_model_args" class="classattr">
                                <div class="attr variable">
            <span class="name">classification_model_args</span>

        
    </div>
    <a class="headerlink" href="#tailor.classification_model_args"></a>
    
    

                            </div>
                            <div id="tailor.classification_model_class" class="classattr">
                                <div class="attr variable">
            <span class="name">classification_model_class</span>

        
    </div>
    <a class="headerlink" href="#tailor.classification_model_class"></a>
    
    

                            </div>
                            <div id="tailor.classification_model" class="classattr">
                                <div class="attr variable">
            <span class="name">classification_model</span>

        
    </div>
    <a class="headerlink" href="#tailor.classification_model"></a>
    
    

                            </div>
                            <div id="tailor.segmentation_model_name" class="classattr">
                                <div class="attr variable">
            <span class="name">segmentation_model_name</span>

        
    </div>
    <a class="headerlink" href="#tailor.segmentation_model_name"></a>
    
    

                            </div>
                            <div id="tailor.segmentation_model_args" class="classattr">
                                <div class="attr variable">
            <span class="name">segmentation_model_args</span>

        
    </div>
    <a class="headerlink" href="#tailor.segmentation_model_args"></a>
    
    

                            </div>
                            <div id="tailor.segmentation_has_bg_color" class="classattr">
                                <div class="attr variable">
            <span class="name">segmentation_has_bg_color</span>

        
    </div>
    <a class="headerlink" href="#tailor.segmentation_has_bg_color"></a>
    
    

                            </div>
                            <div id="tailor.segmentation_model" class="classattr">
                                <div class="attr variable">
            <span class="name">segmentation_model</span>

        
    </div>
    <a class="headerlink" href="#tailor.segmentation_model"></a>
    
    

                            </div>
                            <div id="tailor.landmark_detection_model_path" class="classattr">
                                <div class="attr variable">
            <span class="name">landmark_detection_model_path</span>

        
    </div>
    <a class="headerlink" href="#tailor.landmark_detection_model_path"></a>
    
    

                            </div>
                            <div id="tailor.landmark_detection_model_class" class="classattr">
                                <div class="attr variable">
            <span class="name">landmark_detection_model_class</span>

        
    </div>
    <a class="headerlink" href="#tailor.landmark_detection_model_class"></a>
    
    

                            </div>
                            <div id="tailor.landmark_detection_model_args" class="classattr">
                                <div class="attr variable">
            <span class="name">landmark_detection_model_args</span>

        
    </div>
    <a class="headerlink" href="#tailor.landmark_detection_model_args"></a>
    
    

                            </div>
                            <div id="tailor.landmark_detection_model" class="classattr">
                                <div class="attr variable">
            <span class="name">landmark_detection_model</span>

        
    </div>
    <a class="headerlink" href="#tailor.landmark_detection_model"></a>
    
    

                            </div>
                            <div id="tailor.summary" class="classattr">
                                        <input id="tailor.summary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">summary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="tailor.summary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tailor.summary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tailor.summary-158"><a href="#tailor.summary-158"><span class="linenos">158</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="tailor.summary-159"><a href="#tailor.summary-159"><span class="linenos">159</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor.summary-160"><a href="#tailor.summary-160"><span class="linenos">160</span></a><span class="sd">        Prints a summary of the `tailor` agent&#39;s configuration, including directory paths,</span>
</span><span id="tailor.summary-161"><a href="#tailor.summary-161"><span class="linenos">161</span></a><span class="sd">        defined classes, processing options (refine, derive), and loaded models.</span>
</span><span id="tailor.summary-162"><a href="#tailor.summary-162"><span class="linenos">162</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor.summary-163"><a href="#tailor.summary-163"><span class="linenos">163</span></a>        <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
</span><span id="tailor.summary-164"><a href="#tailor.summary-164"><span class="linenos">164</span></a>        <span class="n">sep</span> <span class="o">=</span> <span class="s2">&quot;=&quot;</span> <span class="o">*</span> <span class="n">width</span>
</span><span id="tailor.summary-165"><a href="#tailor.summary-165"><span class="linenos">165</span></a>
</span><span id="tailor.summary-166"><a href="#tailor.summary-166"><span class="linenos">166</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="tailor.summary-167"><a href="#tailor.summary-167"><span class="linenos">167</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;TAILOR AGENT SUMMARY&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
</span><span id="tailor.summary-168"><a href="#tailor.summary-168"><span class="linenos">168</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span><span id="tailor.summary-169"><a href="#tailor.summary-169"><span class="linenos">169</span></a>
</span><span id="tailor.summary-170"><a href="#tailor.summary-170"><span class="linenos">170</span></a>        <span class="c1"># Directories</span>
</span><span id="tailor.summary-171"><a href="#tailor.summary-171"><span class="linenos">171</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DIRECTORY PATHS&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="tailor.summary-172"><a href="#tailor.summary-172"><span class="linenos">172</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Input directory:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-173"><a href="#tailor.summary-173"><span class="linenos">173</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Model directory:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-174"><a href="#tailor.summary-174"><span class="linenos">174</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Output directory:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-175"><a href="#tailor.summary-175"><span class="linenos">175</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="tailor.summary-176"><a href="#tailor.summary-176"><span class="linenos">176</span></a>
</span><span id="tailor.summary-177"><a href="#tailor.summary-177"><span class="linenos">177</span></a>        <span class="c1"># Classes</span>
</span><span id="tailor.summary-178"><a href="#tailor.summary-178"><span class="linenos">178</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CLASSES&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="tailor.summary-179"><a href="#tailor.summary-179"><span class="linenos">179</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Class Index&#39;</span><span class="si">:</span><span class="s2">&lt;11</span><span class="si">}</span><span class="s2"> | Class Name&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-180"><a href="#tailor.summary-180"><span class="linenos">180</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">11</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="mi">66</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-181"><a href="#tailor.summary-181"><span class="linenos">181</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">):</span>
</span><span id="tailor.summary-182"><a href="#tailor.summary-182"><span class="linenos">182</span></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">&lt;11</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="bp">cls</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-183"><a href="#tailor.summary-183"><span class="linenos">183</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="tailor.summary-184"><a href="#tailor.summary-184"><span class="linenos">184</span></a>
</span><span id="tailor.summary-185"><a href="#tailor.summary-185"><span class="linenos">185</span></a>        <span class="c1"># Flags</span>
</span><span id="tailor.summary-186"><a href="#tailor.summary-186"><span class="linenos">186</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OPTIONS&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="tailor.summary-187"><a href="#tailor.summary-187"><span class="linenos">187</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Do refine?:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-188"><a href="#tailor.summary-188"><span class="linenos">188</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Do derive?:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-189"><a href="#tailor.summary-189"><span class="linenos">189</span></a>        <span class="nb">print</span><span class="p">()</span>
</span><span id="tailor.summary-190"><a href="#tailor.summary-190"><span class="linenos">190</span></a>
</span><span id="tailor.summary-191"><a href="#tailor.summary-191"><span class="linenos">191</span></a>        <span class="c1"># Models</span>
</span><span id="tailor.summary-192"><a href="#tailor.summary-192"><span class="linenos">192</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MODELS&quot;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">))</span>
</span><span id="tailor.summary-193"><a href="#tailor.summary-193"><span class="linenos">193</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="tailor.summary-194"><a href="#tailor.summary-194"><span class="linenos">194</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Classification Model:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="tailor.summary-195"><a href="#tailor.summary-195"><span class="linenos">195</span></a>        <span class="p">)</span>
</span><span id="tailor.summary-196"><a href="#tailor.summary-196"><span class="linenos">196</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Segmentation Model:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-197"><a href="#tailor.summary-197"><span class="linenos">197</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;   Change BG color?:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_has_bg_color</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="tailor.summary-198"><a href="#tailor.summary-198"><span class="linenos">198</span></a>        <span class="nb">print</span><span class="p">(</span>
</span><span id="tailor.summary-199"><a href="#tailor.summary-199"><span class="linenos">199</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Landmark Detection Model:&#39;</span><span class="si">:</span><span class="s2">25</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_class</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="tailor.summary-200"><a href="#tailor.summary-200"><span class="linenos">200</span></a>        <span class="p">)</span>
</span><span id="tailor.summary-201"><a href="#tailor.summary-201"><span class="linenos">201</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Prints a summary of the <code><a href="#tailor">tailor</a></code> agent's configuration, including directory paths,
defined classes, processing options (refine, derive), and loaded models.</p>
</div>


                            </div>
                            <div id="tailor.classify" class="classattr">
                                        <input id="tailor.classify-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">classify</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">image</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="tailor.classify-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tailor.classify"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tailor.classify-203"><a href="#tailor.classify-203"><span class="linenos">203</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">classify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="tailor.classify-204"><a href="#tailor.classify-204"><span class="linenos">204</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor.classify-205"><a href="#tailor.classify-205"><span class="linenos">205</span></a><span class="sd">        Classifies a single garment image using the configured classification model.</span>
</span><span id="tailor.classify-206"><a href="#tailor.classify-206"><span class="linenos">206</span></a>
</span><span id="tailor.classify-207"><a href="#tailor.classify-207"><span class="linenos">207</span></a><span class="sd">        Args:</span>
</span><span id="tailor.classify-208"><a href="#tailor.classify-208"><span class="linenos">208</span></a><span class="sd">            image (str): The filename of the image to classify, located in `self.input_dir`.</span>
</span><span id="tailor.classify-209"><a href="#tailor.classify-209"><span class="linenos">209</span></a><span class="sd">            verbose (bool): If True, prints detailed classification output. Defaults to False.</span>
</span><span id="tailor.classify-210"><a href="#tailor.classify-210"><span class="linenos">210</span></a>
</span><span id="tailor.classify-211"><a href="#tailor.classify-211"><span class="linenos">211</span></a><span class="sd">        Returns:</span>
</span><span id="tailor.classify-212"><a href="#tailor.classify-212"><span class="linenos">212</span></a><span class="sd">            tuple:</span>
</span><span id="tailor.classify-213"><a href="#tailor.classify-213"><span class="linenos">213</span></a><span class="sd">                - label (str): The predicted class label of the garment.</span>
</span><span id="tailor.classify-214"><a href="#tailor.classify-214"><span class="linenos">214</span></a><span class="sd">                - probabilities (List[float]): A list of probabilities for each class.</span>
</span><span id="tailor.classify-215"><a href="#tailor.classify-215"><span class="linenos">215</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor.classify-216"><a href="#tailor.classify-216"><span class="linenos">216</span></a>        <span class="n">label</span><span class="p">,</span> <span class="n">probablities</span> <span class="o">=</span> <span class="n">classification</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span>
</span><span id="tailor.classify-217"><a href="#tailor.classify-217"><span class="linenos">217</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model</span><span class="p">,</span>
</span><span id="tailor.classify-218"><a href="#tailor.classify-218"><span class="linenos">218</span></a>            <span class="n">image_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="tailor.classify-219"><a href="#tailor.classify-219"><span class="linenos">219</span></a>            <span class="n">classes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span>
</span><span id="tailor.classify-220"><a href="#tailor.classify-220"><span class="linenos">220</span></a>            <span class="n">resize_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">),</span>
</span><span id="tailor.classify-221"><a href="#tailor.classify-221"><span class="linenos">221</span></a>            <span class="n">normalize_mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_mean&quot;</span><span class="p">),</span>
</span><span id="tailor.classify-222"><a href="#tailor.classify-222"><span class="linenos">222</span></a>            <span class="n">normalize_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">classification_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_std&quot;</span><span class="p">),</span>
</span><span id="tailor.classify-223"><a href="#tailor.classify-223"><span class="linenos">223</span></a>            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
</span><span id="tailor.classify-224"><a href="#tailor.classify-224"><span class="linenos">224</span></a>        <span class="p">)</span>
</span><span id="tailor.classify-225"><a href="#tailor.classify-225"><span class="linenos">225</span></a>        <span class="k">return</span> <span class="n">label</span><span class="p">,</span> <span class="n">probablities</span>
</span></pre></div>


            <div class="docstring"><p>Classifies a single garment image using the configured classification model.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>image (str):</strong>  The filename of the image to classify, located in <code>self.input_dir</code>.</li>
<li><strong>verbose (bool):</strong>  If True, prints detailed classification output. Defaults to False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple:
      - label (str): The predicted class label of the garment.
      - probabilities (List[float]): A list of probabilities for each class.</p>
</blockquote>
</div>


                            </div>
                            <div id="tailor.segment" class="classattr">
                                        <input id="tailor.segment-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">segment</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">image</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="tailor.segment-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tailor.segment"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tailor.segment-227"><a href="#tailor.segment-227"><span class="linenos">227</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="tailor.segment-228"><a href="#tailor.segment-228"><span class="linenos">228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor.segment-229"><a href="#tailor.segment-229"><span class="linenos">229</span></a><span class="sd">        Segments a single garment image to extract its mask and optionally modifies the background color.</span>
</span><span id="tailor.segment-230"><a href="#tailor.segment-230"><span class="linenos">230</span></a>
</span><span id="tailor.segment-231"><a href="#tailor.segment-231"><span class="linenos">231</span></a><span class="sd">        Args:</span>
</span><span id="tailor.segment-232"><a href="#tailor.segment-232"><span class="linenos">232</span></a><span class="sd">            image (str): The filename of the image to segment, located in `self.input_dir`.</span>
</span><span id="tailor.segment-233"><a href="#tailor.segment-233"><span class="linenos">233</span></a>
</span><span id="tailor.segment-234"><a href="#tailor.segment-234"><span class="linenos">234</span></a><span class="sd">        Returns:</span>
</span><span id="tailor.segment-235"><a href="#tailor.segment-235"><span class="linenos">235</span></a><span class="sd">            tuple:</span>
</span><span id="tailor.segment-236"><a href="#tailor.segment-236"><span class="linenos">236</span></a><span class="sd">                - original_img (np.ndarray): The original image with the mask overlaid.</span>
</span><span id="tailor.segment-237"><a href="#tailor.segment-237"><span class="linenos">237</span></a><span class="sd">                - mask (np.ndarray): The binary segmentation mask.</span>
</span><span id="tailor.segment-238"><a href="#tailor.segment-238"><span class="linenos">238</span></a><span class="sd">                - bg_modified_img (np.ndarray, optional): The image with the background color changed,</span>
</span><span id="tailor.segment-239"><a href="#tailor.segment-239"><span class="linenos">239</span></a><span class="sd">                                                         returned only if `background_color` is specified</span>
</span><span id="tailor.segment-240"><a href="#tailor.segment-240"><span class="linenos">240</span></a><span class="sd">                                                         in `segmentation_model_args`.</span>
</span><span id="tailor.segment-241"><a href="#tailor.segment-241"><span class="linenos">241</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor.segment-242"><a href="#tailor.segment-242"><span class="linenos">242</span></a>        <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span>
</span><span id="tailor.segment-243"><a href="#tailor.segment-243"><span class="linenos">243</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model</span><span class="p">,</span>
</span><span id="tailor.segment-244"><a href="#tailor.segment-244"><span class="linenos">244</span></a>            <span class="n">image_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="tailor.segment-245"><a href="#tailor.segment-245"><span class="linenos">245</span></a>            <span class="n">resize_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">),</span>
</span><span id="tailor.segment-246"><a href="#tailor.segment-246"><span class="linenos">246</span></a>            <span class="n">normalize_mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_mean&quot;</span><span class="p">),</span>
</span><span id="tailor.segment-247"><a href="#tailor.segment-247"><span class="linenos">247</span></a>            <span class="n">normalize_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_std&quot;</span><span class="p">),</span>
</span><span id="tailor.segment-248"><a href="#tailor.segment-248"><span class="linenos">248</span></a>            <span class="n">high_precision</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;high_precision&quot;</span><span class="p">),</span>
</span><span id="tailor.segment-249"><a href="#tailor.segment-249"><span class="linenos">249</span></a>        <span class="p">)</span>
</span><span id="tailor.segment-250"><a href="#tailor.segment-250"><span class="linenos">250</span></a>
</span><span id="tailor.segment-251"><a href="#tailor.segment-251"><span class="linenos">251</span></a>        <span class="n">background_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">)</span>
</span><span id="tailor.segment-252"><a href="#tailor.segment-252"><span class="linenos">252</span></a>
</span><span id="tailor.segment-253"><a href="#tailor.segment-253"><span class="linenos">253</span></a>        <span class="k">if</span> <span class="n">background_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor.segment-254"><a href="#tailor.segment-254"><span class="linenos">254</span></a>            <span class="k">return</span> <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span>
</span><span id="tailor.segment-255"><a href="#tailor.segment-255"><span class="linenos">255</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="tailor.segment-256"><a href="#tailor.segment-256"><span class="linenos">256</span></a>            <span class="n">bg_modified_img</span> <span class="o">=</span> <span class="n">segmentation</span><span class="o">.</span><span class="n">change_background_color</span><span class="p">(</span>
</span><span id="tailor.segment-257"><a href="#tailor.segment-257"><span class="linenos">257</span></a>                <span class="n">image_np</span><span class="o">=</span><span class="n">original_img</span><span class="p">,</span> <span class="n">mask_np</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="n">background_color</span>
</span><span id="tailor.segment-258"><a href="#tailor.segment-258"><span class="linenos">258</span></a>            <span class="p">)</span>
</span><span id="tailor.segment-259"><a href="#tailor.segment-259"><span class="linenos">259</span></a>            <span class="k">return</span> <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bg_modified_img</span>
</span></pre></div>


            <div class="docstring"><p>Segments a single garment image to extract its mask and optionally modifies the background color.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>image (str):</strong>  The filename of the image to segment, located in <code>self.input_dir</code>.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple:
      - original_img (np.ndarray): The original image with the mask overlaid.
      - mask (np.ndarray): The binary segmentation mask.
      - bg_modified_img (np.ndarray, optional): The image with the background color changed,
                                               returned only if <code>background_color</code> is specified
                                               in <code><a href="#tailor.segmentation_model_args">segmentation_model_args</a></code>.</p>
</blockquote>
</div>


                            </div>
                            <div id="tailor.detect" class="classattr">
                                        <input id="tailor.detect-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">detect</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="tailor.detect-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tailor.detect"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tailor.detect-261"><a href="#tailor.detect-261"><span class="linenos">261</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">detect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]):</span>
</span><span id="tailor.detect-262"><a href="#tailor.detect-262"><span class="linenos">262</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor.detect-263"><a href="#tailor.detect-263"><span class="linenos">263</span></a><span class="sd">        Detects predefined landmarks on a garment image based on its classified class.</span>
</span><span id="tailor.detect-264"><a href="#tailor.detect-264"><span class="linenos">264</span></a>
</span><span id="tailor.detect-265"><a href="#tailor.detect-265"><span class="linenos">265</span></a><span class="sd">        Args:</span>
</span><span id="tailor.detect-266"><a href="#tailor.detect-266"><span class="linenos">266</span></a><span class="sd">            class_name (str): The classified name of the garment.</span>
</span><span id="tailor.detect-267"><a href="#tailor.detect-267"><span class="linenos">267</span></a><span class="sd">            image (Union[str, np.ndarray]): The path to the image file or a NumPy array of the image.</span>
</span><span id="tailor.detect-268"><a href="#tailor.detect-268"><span class="linenos">268</span></a>
</span><span id="tailor.detect-269"><a href="#tailor.detect-269"><span class="linenos">269</span></a><span class="sd">        Returns:</span>
</span><span id="tailor.detect-270"><a href="#tailor.detect-270"><span class="linenos">270</span></a><span class="sd">            tuple:</span>
</span><span id="tailor.detect-271"><a href="#tailor.detect-271"><span class="linenos">271</span></a><span class="sd">                - coords (np.array): Detected landmark coordinates.</span>
</span><span id="tailor.detect-272"><a href="#tailor.detect-272"><span class="linenos">272</span></a><span class="sd">                - maxval (np.array): Confidence scores for detected landmarks.</span>
</span><span id="tailor.detect-273"><a href="#tailor.detect-273"><span class="linenos">273</span></a><span class="sd">                - detection_dict (dict): A dictionary containing detailed landmark detection data.</span>
</span><span id="tailor.detect-274"><a href="#tailor.detect-274"><span class="linenos">274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor.detect-275"><a href="#tailor.detect-275"><span class="linenos">275</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="tailor.detect-276"><a href="#tailor.detect-276"><span class="linenos">276</span></a>            <span class="n">image</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="tailor.detect-277"><a href="#tailor.detect-277"><span class="linenos">277</span></a>
</span><span id="tailor.detect-278"><a href="#tailor.detect-278"><span class="linenos">278</span></a>        <span class="n">coords</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">detection_dict</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
</span><span id="tailor.detect-279"><a href="#tailor.detect-279"><span class="linenos">279</span></a>            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
</span><span id="tailor.detect-280"><a href="#tailor.detect-280"><span class="linenos">280</span></a>            <span class="n">class_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_dict</span><span class="p">,</span>
</span><span id="tailor.detect-281"><a href="#tailor.detect-281"><span class="linenos">281</span></a>            <span class="n">image_path</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="tailor.detect-282"><a href="#tailor.detect-282"><span class="linenos">282</span></a>            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model</span><span class="p">,</span>
</span><span id="tailor.detect-283"><a href="#tailor.detect-283"><span class="linenos">283</span></a>            <span class="n">scale_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;scale_std&quot;</span><span class="p">),</span>
</span><span id="tailor.detect-284"><a href="#tailor.detect-284"><span class="linenos">284</span></a>            <span class="n">resize_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;resize_dim&quot;</span><span class="p">),</span>
</span><span id="tailor.detect-285"><a href="#tailor.detect-285"><span class="linenos">285</span></a>            <span class="n">normalize_mean</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_mean&quot;</span><span class="p">),</span>
</span><span id="tailor.detect-286"><a href="#tailor.detect-286"><span class="linenos">286</span></a>            <span class="n">normalize_std</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">landmark_detection_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;normalize_std&quot;</span><span class="p">),</span>
</span><span id="tailor.detect-287"><a href="#tailor.detect-287"><span class="linenos">287</span></a>        <span class="p">)</span>
</span><span id="tailor.detect-288"><a href="#tailor.detect-288"><span class="linenos">288</span></a>        <span class="k">return</span> <span class="n">coords</span><span class="p">,</span> <span class="n">maxval</span><span class="p">,</span> <span class="n">detection_dict</span>
</span></pre></div>


            <div class="docstring"><p>Detects predefined landmarks on a garment image based on its classified class.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>class_name (str):</strong>  The classified name of the garment.</li>
<li><strong>image (Union[str, np.ndarray]):</strong>  The path to the image file or a NumPy array of the image.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple:
      - coords (np.array): Detected landmark coordinates.
      - maxval (np.array): Confidence scores for detected landmarks.
      - detection_dict (dict): A dictionary containing detailed landmark detection data.</p>
</blockquote>
</div>


                            </div>
                            <div id="tailor.derive" class="classattr">
                                        <input id="tailor.derive-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">derive</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">detection_dict</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">derivation_dict</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">landmark_coords</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">array</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">np_mask</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">array</span><span class="o">&gt;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="tailor.derive-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tailor.derive"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tailor.derive-290"><a href="#tailor.derive-290"><span class="linenos">290</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">derive</span><span class="p">(</span>
</span><span id="tailor.derive-291"><a href="#tailor.derive-291"><span class="linenos">291</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="tailor.derive-292"><a href="#tailor.derive-292"><span class="linenos">292</span></a>        <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor.derive-293"><a href="#tailor.derive-293"><span class="linenos">293</span></a>        <span class="n">detection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="tailor.derive-294"><a href="#tailor.derive-294"><span class="linenos">294</span></a>        <span class="n">derivation_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="tailor.derive-295"><a href="#tailor.derive-295"><span class="linenos">295</span></a>        <span class="n">landmark_coords</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor.derive-296"><a href="#tailor.derive-296"><span class="linenos">296</span></a>        <span class="n">np_mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor.derive-297"><a href="#tailor.derive-297"><span class="linenos">297</span></a>    <span class="p">):</span>
</span><span id="tailor.derive-298"><a href="#tailor.derive-298"><span class="linenos">298</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor.derive-299"><a href="#tailor.derive-299"><span class="linenos">299</span></a><span class="sd">        Derives non-predefined landmark coordinates based on predefined landmarks and a mask.</span>
</span><span id="tailor.derive-300"><a href="#tailor.derive-300"><span class="linenos">300</span></a>
</span><span id="tailor.derive-301"><a href="#tailor.derive-301"><span class="linenos">301</span></a><span class="sd">        Args:</span>
</span><span id="tailor.derive-302"><a href="#tailor.derive-302"><span class="linenos">302</span></a><span class="sd">            class_name (str): The name of the garment class.</span>
</span><span id="tailor.derive-303"><a href="#tailor.derive-303"><span class="linenos">303</span></a><span class="sd">            detection_dict (dict): The dictionary containing detected landmarks.</span>
</span><span id="tailor.derive-304"><a href="#tailor.derive-304"><span class="linenos">304</span></a><span class="sd">            derivation_dict (dict): The dictionary defining derivation rules.</span>
</span><span id="tailor.derive-305"><a href="#tailor.derive-305"><span class="linenos">305</span></a><span class="sd">            landmark_coords (np.array): NumPy array of initial landmark coordinates.</span>
</span><span id="tailor.derive-306"><a href="#tailor.derive-306"><span class="linenos">306</span></a><span class="sd">            np_mask (np.array): NumPy array of the segmentation mask.</span>
</span><span id="tailor.derive-307"><a href="#tailor.derive-307"><span class="linenos">307</span></a>
</span><span id="tailor.derive-308"><a href="#tailor.derive-308"><span class="linenos">308</span></a><span class="sd">        Returns:</span>
</span><span id="tailor.derive-309"><a href="#tailor.derive-309"><span class="linenos">309</span></a><span class="sd">            tuple:</span>
</span><span id="tailor.derive-310"><a href="#tailor.derive-310"><span class="linenos">310</span></a><span class="sd">                - derived_coords (dict): A dictionary of the newly derived landmark coordinates.</span>
</span><span id="tailor.derive-311"><a href="#tailor.derive-311"><span class="linenos">311</span></a><span class="sd">                - updated_detection_dict (dict): The detection dictionary updated with derived landmarks.</span>
</span><span id="tailor.derive-312"><a href="#tailor.derive-312"><span class="linenos">312</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor.derive-313"><a href="#tailor.derive-313"><span class="linenos">313</span></a>        <span class="n">derived_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span>
</span><span id="tailor.derive-314"><a href="#tailor.derive-314"><span class="linenos">314</span></a>            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
</span><span id="tailor.derive-315"><a href="#tailor.derive-315"><span class="linenos">315</span></a>            <span class="n">detection_dict</span><span class="o">=</span><span class="n">detection_dict</span><span class="p">,</span>
</span><span id="tailor.derive-316"><a href="#tailor.derive-316"><span class="linenos">316</span></a>            <span class="n">derivation_dict</span><span class="o">=</span><span class="n">derivation_dict</span><span class="p">,</span>
</span><span id="tailor.derive-317"><a href="#tailor.derive-317"><span class="linenos">317</span></a>            <span class="n">landmark_coords</span><span class="o">=</span><span class="n">landmark_coords</span><span class="p">,</span>
</span><span id="tailor.derive-318"><a href="#tailor.derive-318"><span class="linenos">318</span></a>            <span class="n">np_mask</span><span class="o">=</span><span class="n">np_mask</span><span class="p">,</span>
</span><span id="tailor.derive-319"><a href="#tailor.derive-319"><span class="linenos">319</span></a>        <span class="p">)</span>
</span><span id="tailor.derive-320"><a href="#tailor.derive-320"><span class="linenos">320</span></a>        <span class="k">return</span> <span class="n">derived_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span>
</span></pre></div>


            <div class="docstring"><p>Derives non-predefined landmark coordinates based on predefined landmarks and a mask.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>class_name (str):</strong>  The name of the garment class.</li>
<li><strong>detection_dict (dict):</strong>  The dictionary containing detected landmarks.</li>
<li><strong>derivation_dict (dict):</strong>  The dictionary defining derivation rules.</li>
<li><strong>landmark_coords (np.array):</strong>  NumPy array of initial landmark coordinates.</li>
<li><strong>np_mask (np.array):</strong>  NumPy array of the segmentation mask.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple:
      - derived_coords (dict): A dictionary of the newly derived landmark coordinates.
      - updated_detection_dict (dict): The detection dictionary updated with derived landmarks.</p>
</blockquote>
</div>


                            </div>
                            <div id="tailor.refine" class="classattr">
                                        <input id="tailor.refine-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">refine</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">detection_np</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">array</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">detection_conf</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">array</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">detection_dict</span><span class="p">:</span> <span class="nb">dict</span>,</span><span class="param">	<span class="n">mask</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">built</span><span class="o">-</span><span class="ow">in</span> <span class="n">function</span> <span class="n">array</span><span class="o">&gt;</span>,</span><span class="param">	<span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>,</span><span class="param">	<span class="n">ksize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>,</span><span class="param">	<span class="n">sigmaX</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="tailor.refine-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tailor.refine"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tailor.refine-322"><a href="#tailor.refine-322"><span class="linenos">322</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">refine</span><span class="p">(</span>
</span><span id="tailor.refine-323"><a href="#tailor.refine-323"><span class="linenos">323</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="tailor.refine-324"><a href="#tailor.refine-324"><span class="linenos">324</span></a>        <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="tailor.refine-325"><a href="#tailor.refine-325"><span class="linenos">325</span></a>        <span class="n">detection_np</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor.refine-326"><a href="#tailor.refine-326"><span class="linenos">326</span></a>        <span class="n">detection_conf</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor.refine-327"><a href="#tailor.refine-327"><span class="linenos">327</span></a>        <span class="n">detection_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="tailor.refine-328"><a href="#tailor.refine-328"><span class="linenos">328</span></a>        <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
</span><span id="tailor.refine-329"><a href="#tailor.refine-329"><span class="linenos">329</span></a>        <span class="n">window_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="tailor.refine-330"><a href="#tailor.refine-330"><span class="linenos">330</span></a>        <span class="n">ksize</span><span class="p">:</span> <span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
</span><span id="tailor.refine-331"><a href="#tailor.refine-331"><span class="linenos">331</span></a>        <span class="n">sigmaX</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="tailor.refine-332"><a href="#tailor.refine-332"><span class="linenos">332</span></a>    <span class="p">):</span>
</span><span id="tailor.refine-333"><a href="#tailor.refine-333"><span class="linenos">333</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor.refine-334"><a href="#tailor.refine-334"><span class="linenos">334</span></a><span class="sd">        Refines detected landmark coordinates using a blurred segmentation mask.</span>
</span><span id="tailor.refine-335"><a href="#tailor.refine-335"><span class="linenos">335</span></a>
</span><span id="tailor.refine-336"><a href="#tailor.refine-336"><span class="linenos">336</span></a><span class="sd">        Args:</span>
</span><span id="tailor.refine-337"><a href="#tailor.refine-337"><span class="linenos">337</span></a><span class="sd">            class_name (str): The name of the garment class.</span>
</span><span id="tailor.refine-338"><a href="#tailor.refine-338"><span class="linenos">338</span></a><span class="sd">            detection_np (np.array): NumPy array of initial landmark predictions.</span>
</span><span id="tailor.refine-339"><a href="#tailor.refine-339"><span class="linenos">339</span></a><span class="sd">            detection_conf (np.array): NumPy array of confidence scores for each predicted landmark.</span>
</span><span id="tailor.refine-340"><a href="#tailor.refine-340"><span class="linenos">340</span></a><span class="sd">            detection_dict (dict): Dictionary containing landmark data for each class.</span>
</span><span id="tailor.refine-341"><a href="#tailor.refine-341"><span class="linenos">341</span></a><span class="sd">            mask (np.array): Grayscale mask image used to guide refinement.</span>
</span><span id="tailor.refine-342"><a href="#tailor.refine-342"><span class="linenos">342</span></a><span class="sd">            window_size (int, optional): Size of the window used in the refinement algorithm. Defaults to 5.</span>
</span><span id="tailor.refine-343"><a href="#tailor.refine-343"><span class="linenos">343</span></a><span class="sd">            ksize (tuple, optional): Kernel size for Gaussian blur. Must be odd integers. Defaults to (11, 11).</span>
</span><span id="tailor.refine-344"><a href="#tailor.refine-344"><span class="linenos">344</span></a><span class="sd">            sigmaX (float, optional): Gaussian kernel standard deviation in the X direction. Defaults to 0.0.</span>
</span><span id="tailor.refine-345"><a href="#tailor.refine-345"><span class="linenos">345</span></a>
</span><span id="tailor.refine-346"><a href="#tailor.refine-346"><span class="linenos">346</span></a><span class="sd">        Returns:</span>
</span><span id="tailor.refine-347"><a href="#tailor.refine-347"><span class="linenos">347</span></a><span class="sd">            tuple:</span>
</span><span id="tailor.refine-348"><a href="#tailor.refine-348"><span class="linenos">348</span></a><span class="sd">                - refined_detection_np (np.array): Array of the same shape as `detection_np` with refined coordinates.</span>
</span><span id="tailor.refine-349"><a href="#tailor.refine-349"><span class="linenos">349</span></a><span class="sd">                - detection_dict (dict): Updated detection dictionary with refined landmark coordinates.</span>
</span><span id="tailor.refine-350"><a href="#tailor.refine-350"><span class="linenos">350</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor.refine-351"><a href="#tailor.refine-351"><span class="linenos">351</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">:</span>
</span><span id="tailor.refine-352"><a href="#tailor.refine-352"><span class="linenos">352</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;window_size&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor.refine-353"><a href="#tailor.refine-353"><span class="linenos">353</span></a>                <span class="n">window_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">[</span><span class="s2">&quot;window_size&quot;</span><span class="p">]</span>
</span><span id="tailor.refine-354"><a href="#tailor.refine-354"><span class="linenos">354</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ksize&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor.refine-355"><a href="#tailor.refine-355"><span class="linenos">355</span></a>                <span class="n">ksize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">[</span><span class="s2">&quot;ksize&quot;</span><span class="p">]</span>
</span><span id="tailor.refine-356"><a href="#tailor.refine-356"><span class="linenos">356</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sigmaX&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="tailor.refine-357"><a href="#tailor.refine-357"><span class="linenos">357</span></a>                <span class="n">sigmaX</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refinement_args</span><span class="p">[</span><span class="s2">&quot;sigmaX&quot;</span><span class="p">]</span>
</span><span id="tailor.refine-358"><a href="#tailor.refine-358"><span class="linenos">358</span></a>
</span><span id="tailor.refine-359"><a href="#tailor.refine-359"><span class="linenos">359</span></a>        <span class="n">refined_detection_np</span><span class="p">,</span> <span class="n">refined_detection_dict</span> <span class="o">=</span> <span class="n">landmark</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span>
</span><span id="tailor.refine-360"><a href="#tailor.refine-360"><span class="linenos">360</span></a>            <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span>
</span><span id="tailor.refine-361"><a href="#tailor.refine-361"><span class="linenos">361</span></a>            <span class="n">detection_np</span><span class="o">=</span><span class="n">detection_np</span><span class="p">,</span>
</span><span id="tailor.refine-362"><a href="#tailor.refine-362"><span class="linenos">362</span></a>            <span class="n">detection_conf</span><span class="o">=</span><span class="n">detection_conf</span><span class="p">,</span>
</span><span id="tailor.refine-363"><a href="#tailor.refine-363"><span class="linenos">363</span></a>            <span class="n">detection_dict</span><span class="o">=</span><span class="n">detection_dict</span><span class="p">,</span>
</span><span id="tailor.refine-364"><a href="#tailor.refine-364"><span class="linenos">364</span></a>            <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span>
</span><span id="tailor.refine-365"><a href="#tailor.refine-365"><span class="linenos">365</span></a>            <span class="n">window_size</span><span class="o">=</span><span class="n">window_size</span><span class="p">,</span>
</span><span id="tailor.refine-366"><a href="#tailor.refine-366"><span class="linenos">366</span></a>            <span class="n">ksize</span><span class="o">=</span><span class="n">ksize</span><span class="p">,</span>
</span><span id="tailor.refine-367"><a href="#tailor.refine-367"><span class="linenos">367</span></a>            <span class="n">sigmaX</span><span class="o">=</span><span class="n">sigmaX</span><span class="p">,</span>
</span><span id="tailor.refine-368"><a href="#tailor.refine-368"><span class="linenos">368</span></a>        <span class="p">)</span>
</span><span id="tailor.refine-369"><a href="#tailor.refine-369"><span class="linenos">369</span></a>
</span><span id="tailor.refine-370"><a href="#tailor.refine-370"><span class="linenos">370</span></a>        <span class="k">return</span> <span class="n">refined_detection_np</span><span class="p">,</span> <span class="n">refined_detection_dict</span>
</span></pre></div>


            <div class="docstring"><p>Refines detected landmark coordinates using a blurred segmentation mask.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>class_name (str):</strong>  The name of the garment class.</li>
<li><strong>detection_np (np.array):</strong>  NumPy array of initial landmark predictions.</li>
<li><strong>detection_conf (np.array):</strong>  NumPy array of confidence scores for each predicted landmark.</li>
<li><strong>detection_dict (dict):</strong>  Dictionary containing landmark data for each class.</li>
<li><strong>mask (np.array):</strong>  Grayscale mask image used to guide refinement.</li>
<li><strong>window_size (int, optional):</strong>  Size of the window used in the refinement algorithm. Defaults to 5.</li>
<li><strong>ksize (tuple, optional):</strong>  Kernel size for Gaussian blur. Must be odd integers. Defaults to (11, 11).</li>
<li><strong>sigmaX (float, optional):</strong>  Gaussian kernel standard deviation in the X direction. Defaults to 0.0.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple:
      - refined_detection_np (np.array): Array of the same shape as <code>detection_np</code> with refined coordinates.
      - detection_dict (dict): Updated detection dictionary with refined landmark coordinates.</p>
</blockquote>
</div>


                            </div>
                            <div id="tailor.measure" class="classattr">
                                        <input id="tailor.measure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">measure</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">save_segmentation_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">save_measurement_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="tailor.measure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tailor.measure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tailor.measure-372"><a href="#tailor.measure-372"><span class="linenos">372</span></a>    <span class="k">def</span><span class="w"> </span><span class="nf">measure</span><span class="p">(</span>
</span><span id="tailor.measure-373"><a href="#tailor.measure-373"><span class="linenos">373</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="tailor.measure-374"><a href="#tailor.measure-374"><span class="linenos">374</span></a>        <span class="n">save_segmentation_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="tailor.measure-375"><a href="#tailor.measure-375"><span class="linenos">375</span></a>        <span class="n">save_measurement_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="tailor.measure-376"><a href="#tailor.measure-376"><span class="linenos">376</span></a>    <span class="p">):</span>
</span><span id="tailor.measure-377"><a href="#tailor.measure-377"><span class="linenos">377</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="tailor.measure-378"><a href="#tailor.measure-378"><span class="linenos">378</span></a><span class="sd">        Executes the full garment measurement pipeline for all images in the input directory.</span>
</span><span id="tailor.measure-379"><a href="#tailor.measure-379"><span class="linenos">379</span></a><span class="sd">    </span>
</span><span id="tailor.measure-380"><a href="#tailor.measure-380"><span class="linenos">380</span></a><span class="sd">        This method processes each image through a multi-stage pipeline that includes garment classification, </span>
</span><span id="tailor.measure-381"><a href="#tailor.measure-381"><span class="linenos">381</span></a><span class="sd">        segmentation, landmark detection, optional refinement, and measurement derivation. During classification, </span>
</span><span id="tailor.measure-382"><a href="#tailor.measure-382"><span class="linenos">382</span></a><span class="sd">        the system identifies the type of garment (e.g., shirt, dress, pants). Segmentation follows, producing </span>
</span><span id="tailor.measure-383"><a href="#tailor.measure-383"><span class="linenos">383</span></a><span class="sd">        binary or instance masks that separate the garment from the background. Landmark detection is then </span>
</span><span id="tailor.measure-384"><a href="#tailor.measure-384"><span class="linenos">384</span></a><span class="sd">        performed to locate anatomical or garment-specific keypoints such as shoulders or waist positions. If </span>
</span><span id="tailor.measure-385"><a href="#tailor.measure-385"><span class="linenos">385</span></a><span class="sd">        enabled, an optional refinement step applies post-processing or model-based corrections to improve the </span>
</span><span id="tailor.measure-386"><a href="#tailor.measure-386"><span class="linenos">386</span></a><span class="sd">        accuracy of detected keypoints. Finally, the system calculates key garment dimensions - such as chest width, </span>
</span><span id="tailor.measure-387"><a href="#tailor.measure-387"><span class="linenos">387</span></a><span class="sd">        waist width, and full length - based on the detected landmarks. In addition to this processing pipeline, </span>
</span><span id="tailor.measure-388"><a href="#tailor.measure-388"><span class="linenos">388</span></a><span class="sd">        the method also manages data and visual output exports. For each input image, a cleaned JSON file is </span>
</span><span id="tailor.measure-389"><a href="#tailor.measure-389"><span class="linenos">389</span></a><span class="sd">        generated containing the predicted garment class, landmark coordinates, and the resulting measurements. </span>
</span><span id="tailor.measure-390"><a href="#tailor.measure-390"><span class="linenos">390</span></a><span class="sd">        Optionally, visual outputs such as segmentation masks and images annotated with landmarks and measurements </span>
</span><span id="tailor.measure-391"><a href="#tailor.measure-391"><span class="linenos">391</span></a><span class="sd">        can be saved to assist in inspection or debugging.</span>
</span><span id="tailor.measure-392"><a href="#tailor.measure-392"><span class="linenos">392</span></a><span class="sd">    </span>
</span><span id="tailor.measure-393"><a href="#tailor.measure-393"><span class="linenos">393</span></a><span class="sd">        Args:</span>
</span><span id="tailor.measure-394"><a href="#tailor.measure-394"><span class="linenos">394</span></a><span class="sd">            save_segmentation_image (bool): If True, saves segmentation masks and background-modified images.</span>
</span><span id="tailor.measure-395"><a href="#tailor.measure-395"><span class="linenos">395</span></a><span class="sd">                                            Defaults to False.</span>
</span><span id="tailor.measure-396"><a href="#tailor.measure-396"><span class="linenos">396</span></a><span class="sd">            save_measurement_image (bool): If True, saves images overlaid with detected landmarks and measurements.</span>
</span><span id="tailor.measure-397"><a href="#tailor.measure-397"><span class="linenos">397</span></a><span class="sd">                                           Defaults to False.</span>
</span><span id="tailor.measure-398"><a href="#tailor.measure-398"><span class="linenos">398</span></a><span class="sd">    </span>
</span><span id="tailor.measure-399"><a href="#tailor.measure-399"><span class="linenos">399</span></a><span class="sd">        Returns:</span>
</span><span id="tailor.measure-400"><a href="#tailor.measure-400"><span class="linenos">400</span></a><span class="sd">            tuple:</span>
</span><span id="tailor.measure-401"><a href="#tailor.measure-401"><span class="linenos">401</span></a><span class="sd">                - metadata (pd.DataFrame): A DataFrame containing metadata for each processed image, such as:</span>
</span><span id="tailor.measure-402"><a href="#tailor.measure-402"><span class="linenos">402</span></a><span class="sd">                    - Original image path</span>
</span><span id="tailor.measure-403"><a href="#tailor.measure-403"><span class="linenos">403</span></a><span class="sd">                    - Paths to any saved segmentation or annotated images</span>
</span><span id="tailor.measure-404"><a href="#tailor.measure-404"><span class="linenos">404</span></a><span class="sd">                    - Class and measurement results</span>
</span><span id="tailor.measure-405"><a href="#tailor.measure-405"><span class="linenos">405</span></a><span class="sd">                - outputs (dict): A dictionary mapping image filenames to their detailed processing results, including:</span>
</span><span id="tailor.measure-406"><a href="#tailor.measure-406"><span class="linenos">406</span></a><span class="sd">                    - Predicted class</span>
</span><span id="tailor.measure-407"><a href="#tailor.measure-407"><span class="linenos">407</span></a><span class="sd">                    - Detected landmarks with coordinates and confidence scores</span>
</span><span id="tailor.measure-408"><a href="#tailor.measure-408"><span class="linenos">408</span></a><span class="sd">                    - Calculated measurements</span>
</span><span id="tailor.measure-409"><a href="#tailor.measure-409"><span class="linenos">409</span></a><span class="sd">                    - File paths to any saved images (if applicable)</span>
</span><span id="tailor.measure-410"><a href="#tailor.measure-410"><span class="linenos">410</span></a><span class="sd">    </span>
</span><span id="tailor.measure-411"><a href="#tailor.measure-411"><span class="linenos">411</span></a><span class="sd">        Example of exported JSON:</span>
</span><span id="tailor.measure-412"><a href="#tailor.measure-412"><span class="linenos">412</span></a><span class="sd">            ```</span>
</span><span id="tailor.measure-413"><a href="#tailor.measure-413"><span class="linenos">413</span></a><span class="sd">            {</span>
</span><span id="tailor.measure-414"><a href="#tailor.measure-414"><span class="linenos">414</span></a><span class="sd">                &quot;cloth_3.jpg&quot;: {</span>
</span><span id="tailor.measure-415"><a href="#tailor.measure-415"><span class="linenos">415</span></a><span class="sd">                    &quot;class&quot;: &quot;vest dress&quot;,</span>
</span><span id="tailor.measure-416"><a href="#tailor.measure-416"><span class="linenos">416</span></a><span class="sd">                    &quot;landmarks&quot;: {</span>
</span><span id="tailor.measure-417"><a href="#tailor.measure-417"><span class="linenos">417</span></a><span class="sd">                        &quot;10&quot;: {</span>
</span><span id="tailor.measure-418"><a href="#tailor.measure-418"><span class="linenos">418</span></a><span class="sd">                            &quot;conf&quot;: 0.7269417643547058,</span>
</span><span id="tailor.measure-419"><a href="#tailor.measure-419"><span class="linenos">419</span></a><span class="sd">                            &quot;x&quot;: 611.0,</span>
</span><span id="tailor.measure-420"><a href="#tailor.measure-420"><span class="linenos">420</span></a><span class="sd">                            &quot;y&quot;: 861.0</span>
</span><span id="tailor.measure-421"><a href="#tailor.measure-421"><span class="linenos">421</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-422"><a href="#tailor.measure-422"><span class="linenos">422</span></a><span class="sd">                        &quot;16&quot;: {</span>
</span><span id="tailor.measure-423"><a href="#tailor.measure-423"><span class="linenos">423</span></a><span class="sd">                            &quot;conf&quot;: 0.6769524812698364,</span>
</span><span id="tailor.measure-424"><a href="#tailor.measure-424"><span class="linenos">424</span></a><span class="sd">                            &quot;x&quot;: 1226.0,</span>
</span><span id="tailor.measure-425"><a href="#tailor.measure-425"><span class="linenos">425</span></a><span class="sd">                            &quot;y&quot;: 838.0</span>
</span><span id="tailor.measure-426"><a href="#tailor.measure-426"><span class="linenos">426</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-427"><a href="#tailor.measure-427"><span class="linenos">427</span></a><span class="sd">                        &quot;17&quot;: {</span>
</span><span id="tailor.measure-428"><a href="#tailor.measure-428"><span class="linenos">428</span></a><span class="sd">                            &quot;conf&quot;: 0.7472652196884155,</span>
</span><span id="tailor.measure-429"><a href="#tailor.measure-429"><span class="linenos">429</span></a><span class="sd">                            &quot;x&quot;: 1213.0,</span>
</span><span id="tailor.measure-430"><a href="#tailor.measure-430"><span class="linenos">430</span></a><span class="sd">                            &quot;y&quot;: 726.0</span>
</span><span id="tailor.measure-431"><a href="#tailor.measure-431"><span class="linenos">431</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-432"><a href="#tailor.measure-432"><span class="linenos">432</span></a><span class="sd">                        &quot;18&quot;: {</span>
</span><span id="tailor.measure-433"><a href="#tailor.measure-433"><span class="linenos">433</span></a><span class="sd">                            &quot;conf&quot;: 0.7360446453094482,</span>
</span><span id="tailor.measure-434"><a href="#tailor.measure-434"><span class="linenos">434</span></a><span class="sd">                            &quot;x&quot;: 1238.0,</span>
</span><span id="tailor.measure-435"><a href="#tailor.measure-435"><span class="linenos">435</span></a><span class="sd">                            &quot;y&quot;: 613.0</span>
</span><span id="tailor.measure-436"><a href="#tailor.measure-436"><span class="linenos">436</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-437"><a href="#tailor.measure-437"><span class="linenos">437</span></a><span class="sd">                        &quot;2&quot;: {</span>
</span><span id="tailor.measure-438"><a href="#tailor.measure-438"><span class="linenos">438</span></a><span class="sd">                            &quot;conf&quot;: 0.9256571531295776,</span>
</span><span id="tailor.measure-439"><a href="#tailor.measure-439"><span class="linenos">439</span></a><span class="sd">                            &quot;x&quot;: 703.0,</span>
</span><span id="tailor.measure-440"><a href="#tailor.measure-440"><span class="linenos">440</span></a><span class="sd">                            &quot;y&quot;: 264.0</span>
</span><span id="tailor.measure-441"><a href="#tailor.measure-441"><span class="linenos">441</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-442"><a href="#tailor.measure-442"><span class="linenos">442</span></a><span class="sd">                        &quot;20&quot;: {</span>
</span><span id="tailor.measure-443"><a href="#tailor.measure-443"><span class="linenos">443</span></a><span class="sd">                            &quot;x&quot;: 700.936,</span>
</span><span id="tailor.measure-444"><a href="#tailor.measure-444"><span class="linenos">444</span></a><span class="sd">                            &quot;y&quot;: 2070.0</span>
</span><span id="tailor.measure-445"><a href="#tailor.measure-445"><span class="linenos">445</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-446"><a href="#tailor.measure-446"><span class="linenos">446</span></a><span class="sd">                        &quot;8&quot;: {</span>
</span><span id="tailor.measure-447"><a href="#tailor.measure-447"><span class="linenos">447</span></a><span class="sd">                            &quot;conf&quot;: 0.7129100561141968,</span>
</span><span id="tailor.measure-448"><a href="#tailor.measure-448"><span class="linenos">448</span></a><span class="sd">                            &quot;x&quot;: 563.0,</span>
</span><span id="tailor.measure-449"><a href="#tailor.measure-449"><span class="linenos">449</span></a><span class="sd">                            &quot;y&quot;: 613.0</span>
</span><span id="tailor.measure-450"><a href="#tailor.measure-450"><span class="linenos">450</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-451"><a href="#tailor.measure-451"><span class="linenos">451</span></a><span class="sd">                        &quot;9&quot;: {</span>
</span><span id="tailor.measure-452"><a href="#tailor.measure-452"><span class="linenos">452</span></a><span class="sd">                            &quot;conf&quot;: 0.8203497529029846,</span>
</span><span id="tailor.measure-453"><a href="#tailor.measure-453"><span class="linenos">453</span></a><span class="sd">                            &quot;x&quot;: 598.0,</span>
</span><span id="tailor.measure-454"><a href="#tailor.measure-454"><span class="linenos">454</span></a><span class="sd">                            &quot;y&quot;: 726.0</span>
</span><span id="tailor.measure-455"><a href="#tailor.measure-455"><span class="linenos">455</span></a><span class="sd">                        }</span>
</span><span id="tailor.measure-456"><a href="#tailor.measure-456"><span class="linenos">456</span></a><span class="sd">                    },</span>
</span><span id="tailor.measure-457"><a href="#tailor.measure-457"><span class="linenos">457</span></a><span class="sd">                    &quot;measurements&quot;: {</span>
</span><span id="tailor.measure-458"><a href="#tailor.measure-458"><span class="linenos">458</span></a><span class="sd">                        &quot;chest&quot;: {</span>
</span><span id="tailor.measure-459"><a href="#tailor.measure-459"><span class="linenos">459</span></a><span class="sd">                            &quot;distance&quot;: 675.0,</span>
</span><span id="tailor.measure-460"><a href="#tailor.measure-460"><span class="linenos">460</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="tailor.measure-461"><a href="#tailor.measure-461"><span class="linenos">461</span></a><span class="sd">                                &quot;end&quot;: &quot;18&quot;,</span>
</span><span id="tailor.measure-462"><a href="#tailor.measure-462"><span class="linenos">462</span></a><span class="sd">                                &quot;start&quot;: &quot;8&quot;</span>
</span><span id="tailor.measure-463"><a href="#tailor.measure-463"><span class="linenos">463</span></a><span class="sd">                            }</span>
</span><span id="tailor.measure-464"><a href="#tailor.measure-464"><span class="linenos">464</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-465"><a href="#tailor.measure-465"><span class="linenos">465</span></a><span class="sd">                        &quot;full length&quot;: {</span>
</span><span id="tailor.measure-466"><a href="#tailor.measure-466"><span class="linenos">466</span></a><span class="sd">                            &quot;distance&quot;: 1806.0011794281863,</span>
</span><span id="tailor.measure-467"><a href="#tailor.measure-467"><span class="linenos">467</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="tailor.measure-468"><a href="#tailor.measure-468"><span class="linenos">468</span></a><span class="sd">                                &quot;end&quot;: &quot;20&quot;,</span>
</span><span id="tailor.measure-469"><a href="#tailor.measure-469"><span class="linenos">469</span></a><span class="sd">                                &quot;start&quot;: &quot;2&quot;</span>
</span><span id="tailor.measure-470"><a href="#tailor.measure-470"><span class="linenos">470</span></a><span class="sd">                            }</span>
</span><span id="tailor.measure-471"><a href="#tailor.measure-471"><span class="linenos">471</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-472"><a href="#tailor.measure-472"><span class="linenos">472</span></a><span class="sd">                        &quot;hips&quot;: {</span>
</span><span id="tailor.measure-473"><a href="#tailor.measure-473"><span class="linenos">473</span></a><span class="sd">                            &quot;distance&quot;: 615.4299310238331,</span>
</span><span id="tailor.measure-474"><a href="#tailor.measure-474"><span class="linenos">474</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="tailor.measure-475"><a href="#tailor.measure-475"><span class="linenos">475</span></a><span class="sd">                                &quot;end&quot;: &quot;16&quot;,</span>
</span><span id="tailor.measure-476"><a href="#tailor.measure-476"><span class="linenos">476</span></a><span class="sd">                                &quot;start&quot;: &quot;10&quot;</span>
</span><span id="tailor.measure-477"><a href="#tailor.measure-477"><span class="linenos">477</span></a><span class="sd">                            }</span>
</span><span id="tailor.measure-478"><a href="#tailor.measure-478"><span class="linenos">478</span></a><span class="sd">                        },</span>
</span><span id="tailor.measure-479"><a href="#tailor.measure-479"><span class="linenos">479</span></a><span class="sd">                        &quot;waist&quot;: {</span>
</span><span id="tailor.measure-480"><a href="#tailor.measure-480"><span class="linenos">480</span></a><span class="sd">                            &quot;distance&quot;: 615.0,</span>
</span><span id="tailor.measure-481"><a href="#tailor.measure-481"><span class="linenos">481</span></a><span class="sd">                            &quot;landmarks&quot;: {</span>
</span><span id="tailor.measure-482"><a href="#tailor.measure-482"><span class="linenos">482</span></a><span class="sd">                                &quot;end&quot;: &quot;17&quot;,</span>
</span><span id="tailor.measure-483"><a href="#tailor.measure-483"><span class="linenos">483</span></a><span class="sd">                                &quot;start&quot;: &quot;9&quot;</span>
</span><span id="tailor.measure-484"><a href="#tailor.measure-484"><span class="linenos">484</span></a><span class="sd">                            }</span>
</span><span id="tailor.measure-485"><a href="#tailor.measure-485"><span class="linenos">485</span></a><span class="sd">                        }</span>
</span><span id="tailor.measure-486"><a href="#tailor.measure-486"><span class="linenos">486</span></a><span class="sd">                    }</span>
</span><span id="tailor.measure-487"><a href="#tailor.measure-487"><span class="linenos">487</span></a><span class="sd">                }</span>
</span><span id="tailor.measure-488"><a href="#tailor.measure-488"><span class="linenos">488</span></a><span class="sd">            }</span>
</span><span id="tailor.measure-489"><a href="#tailor.measure-489"><span class="linenos">489</span></a><span class="sd">            ```</span>
</span><span id="tailor.measure-490"><a href="#tailor.measure-490"><span class="linenos">490</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="tailor.measure-491"><a href="#tailor.measure-491"><span class="linenos">491</span></a>        <span class="c1"># Some helper variables</span>
</span><span id="tailor.measure-492"><a href="#tailor.measure-492"><span class="linenos">492</span></a>        <span class="n">use_bg_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_model_args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;background_color&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="tailor.measure-493"><a href="#tailor.measure-493"><span class="linenos">493</span></a>        <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="tailor.measure-494"><a href="#tailor.measure-494"><span class="linenos">494</span></a>
</span><span id="tailor.measure-495"><a href="#tailor.measure-495"><span class="linenos">495</span></a>        <span class="c1"># Step 1: Create the output directory</span>
</span><span id="tailor.measure-496"><a href="#tailor.measure-496"><span class="linenos">496</span></a>        <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="tailor.measure-497"><a href="#tailor.measure-497"><span class="linenos">497</span></a>        <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_json&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="tailor.measure-498"><a href="#tailor.measure-498"><span class="linenos">498</span></a>
</span><span id="tailor.measure-499"><a href="#tailor.measure-499"><span class="linenos">499</span></a>        <span class="k">if</span> <span class="n">save_segmentation_image</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="tailor.measure-500"><a href="#tailor.measure-500"><span class="linenos">500</span></a>            <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span>
</span><span id="tailor.measure-501"><a href="#tailor.measure-501"><span class="linenos">501</span></a>        <span class="p">):</span>
</span><span id="tailor.measure-502"><a href="#tailor.measure-502"><span class="linenos">502</span></a>            <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mask_image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="tailor.measure-503"><a href="#tailor.measure-503"><span class="linenos">503</span></a>            <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor.measure-504"><a href="#tailor.measure-504"><span class="linenos">504</span></a>                <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bg_modified_image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="tailor.measure-505"><a href="#tailor.measure-505"><span class="linenos">505</span></a>                    <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="tailor.measure-506"><a href="#tailor.measure-506"><span class="linenos">506</span></a>                <span class="p">)</span>
</span><span id="tailor.measure-507"><a href="#tailor.measure-507"><span class="linenos">507</span></a>
</span><span id="tailor.measure-508"><a href="#tailor.measure-508"><span class="linenos">508</span></a>        <span class="k">if</span> <span class="n">save_measurement_image</span><span class="p">:</span>
</span><span id="tailor.measure-509"><a href="#tailor.measure-509"><span class="linenos">509</span></a>            <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_image&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span>
</span><span id="tailor.measure-510"><a href="#tailor.measure-510"><span class="linenos">510</span></a>                <span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span>
</span><span id="tailor.measure-511"><a href="#tailor.measure-511"><span class="linenos">511</span></a>            <span class="p">)</span>
</span><span id="tailor.measure-512"><a href="#tailor.measure-512"><span class="linenos">512</span></a>
</span><span id="tailor.measure-513"><a href="#tailor.measure-513"><span class="linenos">513</span></a>        <span class="c1"># Step 2: Collect image filenames from input_dir</span>
</span><span id="tailor.measure-514"><a href="#tailor.measure-514"><span class="linenos">514</span></a>        <span class="n">image_extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*.jpg&quot;</span><span class="p">,</span> <span class="s2">&quot;*.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;*.png&quot;</span><span class="p">,</span> <span class="s2">&quot;*.bmp&quot;</span><span class="p">,</span> <span class="s2">&quot;*.tiff&quot;</span><span class="p">]</span>
</span><span id="tailor.measure-515"><a href="#tailor.measure-515"><span class="linenos">515</span></a>        <span class="n">input_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="p">)</span>
</span><span id="tailor.measure-516"><a href="#tailor.measure-516"><span class="linenos">516</span></a>
</span><span id="tailor.measure-517"><a href="#tailor.measure-517"><span class="linenos">517</span></a>        <span class="n">image_files</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="tailor.measure-518"><a href="#tailor.measure-518"><span class="linenos">518</span></a>        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">image_extensions</span><span class="p">:</span>
</span><span id="tailor.measure-519"><a href="#tailor.measure-519"><span class="linenos">519</span></a>            <span class="n">image_files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">input_path</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span>
</span><span id="tailor.measure-520"><a href="#tailor.measure-520"><span class="linenos">520</span></a>
</span><span id="tailor.measure-521"><a href="#tailor.measure-521"><span class="linenos">521</span></a>        <span class="c1"># Step 3: Determine column structure</span>
</span><span id="tailor.measure-522"><a href="#tailor.measure-522"><span class="linenos">522</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="tailor.measure-523"><a href="#tailor.measure-523"><span class="linenos">523</span></a>            <span class="s2">&quot;filename&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-524"><a href="#tailor.measure-524"><span class="linenos">524</span></a>            <span class="s2">&quot;class&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-525"><a href="#tailor.measure-525"><span class="linenos">525</span></a>            <span class="s2">&quot;mask_image&quot;</span> <span class="k">if</span> <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="tailor.measure-526"><a href="#tailor.measure-526"><span class="linenos">526</span></a>            <span class="s2">&quot;bg_modified_image&quot;</span> <span class="k">if</span> <span class="n">use_bg_color</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="tailor.measure-527"><a href="#tailor.measure-527"><span class="linenos">527</span></a>            <span class="s2">&quot;measurement_image&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-528"><a href="#tailor.measure-528"><span class="linenos">528</span></a>            <span class="s2">&quot;measurement_json&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-529"><a href="#tailor.measure-529"><span class="linenos">529</span></a>        <span class="p">]</span>
</span><span id="tailor.measure-530"><a href="#tailor.measure-530"><span class="linenos">530</span></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="tailor.measure-531"><a href="#tailor.measure-531"><span class="linenos">531</span></a>
</span><span id="tailor.measure-532"><a href="#tailor.measure-532"><span class="linenos">532</span></a>        <span class="n">metadata</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span><span id="tailor.measure-533"><a href="#tailor.measure-533"><span class="linenos">533</span></a>        <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">image_files</span><span class="p">]</span>
</span><span id="tailor.measure-534"><a href="#tailor.measure-534"><span class="linenos">534</span></a>
</span><span id="tailor.measure-535"><a href="#tailor.measure-535"><span class="linenos">535</span></a>        <span class="c1"># Step 4: Print start message and information</span>
</span><span id="tailor.measure-536"><a href="#tailor.measure-536"><span class="linenos">536</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Start measuring </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> garment images ...&quot;</span><span class="p">)</span>
</span><span id="tailor.measure-537"><a href="#tailor.measure-537"><span class="linenos">537</span></a>
</span><span id="tailor.measure-538"><a href="#tailor.measure-538"><span class="linenos">538</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor.measure-539"><a href="#tailor.measure-539"><span class="linenos">539</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor.measure-540"><a href="#tailor.measure-540"><span class="linenos">540</span></a>                <span class="s2">&quot;There are 5 measurement steps: classification, segmentation, &quot;</span>
</span><span id="tailor.measure-541"><a href="#tailor.measure-541"><span class="linenos">541</span></a>                <span class="s2">&quot;landmark detection, landmark refinement, and landmark derivation.&quot;</span>
</span><span id="tailor.measure-542"><a href="#tailor.measure-542"><span class="linenos">542</span></a>            <span class="p">)</span>
</span><span id="tailor.measure-543"><a href="#tailor.measure-543"><span class="linenos">543</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="p">:</span>
</span><span id="tailor.measure-544"><a href="#tailor.measure-544"><span class="linenos">544</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor.measure-545"><a href="#tailor.measure-545"><span class="linenos">545</span></a>                <span class="s2">&quot;There are 4 measurement steps: classification, segmentation, &quot;</span>
</span><span id="tailor.measure-546"><a href="#tailor.measure-546"><span class="linenos">546</span></a>                <span class="s2">&quot;landmark detection, and landmark derivation.&quot;</span>
</span><span id="tailor.measure-547"><a href="#tailor.measure-547"><span class="linenos">547</span></a>            <span class="p">)</span>
</span><span id="tailor.measure-548"><a href="#tailor.measure-548"><span class="linenos">548</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor.measure-549"><a href="#tailor.measure-549"><span class="linenos">549</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor.measure-550"><a href="#tailor.measure-550"><span class="linenos">550</span></a>                <span class="s2">&quot;There are 4 measurement steps: classification, segmentation, &quot;</span>
</span><span id="tailor.measure-551"><a href="#tailor.measure-551"><span class="linenos">551</span></a>                <span class="s2">&quot;landmark detection, and landmark refinement.&quot;</span>
</span><span id="tailor.measure-552"><a href="#tailor.measure-552"><span class="linenos">552</span></a>            <span class="p">)</span>
</span><span id="tailor.measure-553"><a href="#tailor.measure-553"><span class="linenos">553</span></a>        <span class="k">elif</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor.measure-554"><a href="#tailor.measure-554"><span class="linenos">554</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor.measure-555"><a href="#tailor.measure-555"><span class="linenos">555</span></a>                <span class="s2">&quot;There are 3 measurement steps: classification, segmentation, &quot;</span>
</span><span id="tailor.measure-556"><a href="#tailor.measure-556"><span class="linenos">556</span></a>                <span class="s2">&quot;and landmark detection.&quot;</span>
</span><span id="tailor.measure-557"><a href="#tailor.measure-557"><span class="linenos">557</span></a>            <span class="p">)</span>
</span><span id="tailor.measure-558"><a href="#tailor.measure-558"><span class="linenos">558</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="tailor.measure-559"><a href="#tailor.measure-559"><span class="linenos">559</span></a>            <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="tailor.measure-560"><a href="#tailor.measure-560"><span class="linenos">560</span></a>                <span class="s2">&quot;There are 2 measurement steps: classification and landmark detection.&quot;</span>
</span><span id="tailor.measure-561"><a href="#tailor.measure-561"><span class="linenos">561</span></a>            <span class="p">)</span>
</span><span id="tailor.measure-562"><a href="#tailor.measure-562"><span class="linenos">562</span></a>
</span><span id="tailor.measure-563"><a href="#tailor.measure-563"><span class="linenos">563</span></a>        <span class="nb">print</span><span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">80</span><span class="p">))</span>
</span><span id="tailor.measure-564"><a href="#tailor.measure-564"><span class="linenos">564</span></a>
</span><span id="tailor.measure-565"><a href="#tailor.measure-565"><span class="linenos">565</span></a>        <span class="c1"># Step 5: Classification</span>
</span><span id="tailor.measure-566"><a href="#tailor.measure-566"><span class="linenos">566</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor.measure-567"><a href="#tailor.measure-567"><span class="linenos">567</span></a>            <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Classification&quot;</span>
</span><span id="tailor.measure-568"><a href="#tailor.measure-568"><span class="linenos">568</span></a>        <span class="p">):</span>
</span><span id="tailor.measure-569"><a href="#tailor.measure-569"><span class="linenos">569</span></a>            <span class="n">label</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">classify</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="tailor.measure-570"><a href="#tailor.measure-570"><span class="linenos">570</span></a>            <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>
</span><span id="tailor.measure-571"><a href="#tailor.measure-571"><span class="linenos">571</span></a>            <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="tailor.measure-572"><a href="#tailor.measure-572"><span class="linenos">572</span></a>
</span><span id="tailor.measure-573"><a href="#tailor.measure-573"><span class="linenos">573</span></a>        <span class="c1"># Step 6: Segmentation</span>
</span><span id="tailor.measure-574"><a href="#tailor.measure-574"><span class="linenos">574</span></a>        <span class="k">if</span> <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">):</span>
</span><span id="tailor.measure-575"><a href="#tailor.measure-575"><span class="linenos">575</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor.measure-576"><a href="#tailor.measure-576"><span class="linenos">576</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor.measure-577"><a href="#tailor.measure-577"><span class="linenos">577</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor.measure-578"><a href="#tailor.measure-578"><span class="linenos">578</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Segmentation&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-579"><a href="#tailor.measure-579"><span class="linenos">579</span></a>            <span class="p">):</span>
</span><span id="tailor.measure-580"><a href="#tailor.measure-580"><span class="linenos">580</span></a>                <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor.measure-581"><a href="#tailor.measure-581"><span class="linenos">581</span></a>                    <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">bg_modified_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
</span><span id="tailor.measure-582"><a href="#tailor.measure-582"><span class="linenos">582</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="tailor.measure-583"><a href="#tailor.measure-583"><span class="linenos">583</span></a>                        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="p">,</span>
</span><span id="tailor.measure-584"><a href="#tailor.measure-584"><span class="linenos">584</span></a>                        <span class="s2">&quot;bg_modified_image&quot;</span><span class="p">:</span> <span class="n">bg_modified_image</span><span class="p">,</span>
</span><span id="tailor.measure-585"><a href="#tailor.measure-585"><span class="linenos">585</span></a>                    <span class="p">}</span>
</span><span id="tailor.measure-586"><a href="#tailor.measure-586"><span class="linenos">586</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="tailor.measure-587"><a href="#tailor.measure-587"><span class="linenos">587</span></a>                    <span class="n">original_img</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">)</span>
</span><span id="tailor.measure-588"><a href="#tailor.measure-588"><span class="linenos">588</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="tailor.measure-589"><a href="#tailor.measure-589"><span class="linenos">589</span></a>                        <span class="s2">&quot;mask&quot;</span><span class="p">:</span> <span class="n">mask</span><span class="p">,</span>
</span><span id="tailor.measure-590"><a href="#tailor.measure-590"><span class="linenos">590</span></a>                    <span class="p">}</span>
</span><span id="tailor.measure-591"><a href="#tailor.measure-591"><span class="linenos">591</span></a>
</span><span id="tailor.measure-592"><a href="#tailor.measure-592"><span class="linenos">592</span></a>        <span class="c1"># Step 7: Landmark detection</span>
</span><span id="tailor.measure-593"><a href="#tailor.measure-593"><span class="linenos">593</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor.measure-594"><a href="#tailor.measure-594"><span class="linenos">594</span></a>            <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor.measure-595"><a href="#tailor.measure-595"><span class="linenos">595</span></a>            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor.measure-596"><a href="#tailor.measure-596"><span class="linenos">596</span></a>            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Landmark detection&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-597"><a href="#tailor.measure-597"><span class="linenos">597</span></a>        <span class="p">):</span>
</span><span id="tailor.measure-598"><a href="#tailor.measure-598"><span class="linenos">598</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor.measure-599"><a href="#tailor.measure-599"><span class="linenos">599</span></a>            <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor.measure-600"><a href="#tailor.measure-600"><span class="linenos">600</span></a>                <span class="n">coords</span><span class="p">,</span> <span class="n">maxvals</span><span class="p">,</span> <span class="n">detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
</span><span id="tailor.measure-601"><a href="#tailor.measure-601"><span class="linenos">601</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;bg_modified_image&quot;</span><span class="p">]</span>
</span><span id="tailor.measure-602"><a href="#tailor.measure-602"><span class="linenos">602</span></a>                <span class="p">)</span>
</span><span id="tailor.measure-603"><a href="#tailor.measure-603"><span class="linenos">603</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detection_dict</span>
</span><span id="tailor.measure-604"><a href="#tailor.measure-604"><span class="linenos">604</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor.measure-605"><a href="#tailor.measure-605"><span class="linenos">605</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="tailor.measure-606"><a href="#tailor.measure-606"><span class="linenos">606</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;maxvals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxvals</span>
</span><span id="tailor.measure-607"><a href="#tailor.measure-607"><span class="linenos">607</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="tailor.measure-608"><a href="#tailor.measure-608"><span class="linenos">608</span></a>                <span class="n">coords</span><span class="p">,</span> <span class="n">maxvals</span><span class="p">,</span> <span class="n">detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect</span><span class="p">(</span>
</span><span id="tailor.measure-609"><a href="#tailor.measure-609"><span class="linenos">609</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">image</span><span class="o">=</span><span class="n">image</span>
</span><span id="tailor.measure-610"><a href="#tailor.measure-610"><span class="linenos">610</span></a>                <span class="p">)</span>
</span><span id="tailor.measure-611"><a href="#tailor.measure-611"><span class="linenos">611</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">detection_dict</span>
</span><span id="tailor.measure-612"><a href="#tailor.measure-612"><span class="linenos">612</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor.measure-613"><a href="#tailor.measure-613"><span class="linenos">613</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span>
</span><span id="tailor.measure-614"><a href="#tailor.measure-614"><span class="linenos">614</span></a>                    <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;maxvals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxvals</span>
</span><span id="tailor.measure-615"><a href="#tailor.measure-615"><span class="linenos">615</span></a>
</span><span id="tailor.measure-616"><a href="#tailor.measure-616"><span class="linenos">616</span></a>        <span class="c1"># Step 8: Landmark refinement</span>
</span><span id="tailor.measure-617"><a href="#tailor.measure-617"><span class="linenos">617</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span><span class="p">:</span>
</span><span id="tailor.measure-618"><a href="#tailor.measure-618"><span class="linenos">618</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor.measure-619"><a href="#tailor.measure-619"><span class="linenos">619</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor.measure-620"><a href="#tailor.measure-620"><span class="linenos">620</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor.measure-621"><a href="#tailor.measure-621"><span class="linenos">621</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Landmark refinement&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-622"><a href="#tailor.measure-622"><span class="linenos">622</span></a>            <span class="p">):</span>
</span><span id="tailor.measure-623"><a href="#tailor.measure-623"><span class="linenos">623</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor.measure-624"><a href="#tailor.measure-624"><span class="linenos">624</span></a>                <span class="n">updated_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refine</span><span class="p">(</span>
</span><span id="tailor.measure-625"><a href="#tailor.measure-625"><span class="linenos">625</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="tailor.measure-626"><a href="#tailor.measure-626"><span class="linenos">626</span></a>                    <span class="n">detection_np</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">],</span>
</span><span id="tailor.measure-627"><a href="#tailor.measure-627"><span class="linenos">627</span></a>                    <span class="n">detection_conf</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;maxvals&quot;</span><span class="p">],</span>
</span><span id="tailor.measure-628"><a href="#tailor.measure-628"><span class="linenos">628</span></a>                    <span class="n">detection_dict</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">],</span>
</span><span id="tailor.measure-629"><a href="#tailor.measure-629"><span class="linenos">629</span></a>                    <span class="n">mask</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">],</span>
</span><span id="tailor.measure-630"><a href="#tailor.measure-630"><span class="linenos">630</span></a>                <span class="p">)</span>
</span><span id="tailor.measure-631"><a href="#tailor.measure-631"><span class="linenos">631</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_coords</span>
</span><span id="tailor.measure-632"><a href="#tailor.measure-632"><span class="linenos">632</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_detection_dict</span>
</span><span id="tailor.measure-633"><a href="#tailor.measure-633"><span class="linenos">633</span></a>
</span><span id="tailor.measure-634"><a href="#tailor.measure-634"><span class="linenos">634</span></a>        <span class="c1"># Step 9: Landmark derivation</span>
</span><span id="tailor.measure-635"><a href="#tailor.measure-635"><span class="linenos">635</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span><span class="p">:</span>
</span><span id="tailor.measure-636"><a href="#tailor.measure-636"><span class="linenos">636</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor.measure-637"><a href="#tailor.measure-637"><span class="linenos">637</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor.measure-638"><a href="#tailor.measure-638"><span class="linenos">638</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor.measure-639"><a href="#tailor.measure-639"><span class="linenos">639</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Landmark derivation&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-640"><a href="#tailor.measure-640"><span class="linenos">640</span></a>            <span class="p">):</span>
</span><span id="tailor.measure-641"><a href="#tailor.measure-641"><span class="linenos">641</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor.measure-642"><a href="#tailor.measure-642"><span class="linenos">642</span></a>                <span class="n">derived_coords</span><span class="p">,</span> <span class="n">updated_detection_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span>
</span><span id="tailor.measure-643"><a href="#tailor.measure-643"><span class="linenos">643</span></a>                    <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="tailor.measure-644"><a href="#tailor.measure-644"><span class="linenos">644</span></a>                    <span class="n">detection_dict</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">],</span>
</span><span id="tailor.measure-645"><a href="#tailor.measure-645"><span class="linenos">645</span></a>                    <span class="n">derivation_dict</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">derivation_dict</span><span class="p">,</span>
</span><span id="tailor.measure-646"><a href="#tailor.measure-646"><span class="linenos">646</span></a>                    <span class="n">landmark_coords</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;coords&quot;</span><span class="p">],</span>
</span><span id="tailor.measure-647"><a href="#tailor.measure-647"><span class="linenos">647</span></a>                    <span class="n">np_mask</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">],</span>
</span><span id="tailor.measure-648"><a href="#tailor.measure-648"><span class="linenos">648</span></a>                <span class="p">)</span>
</span><span id="tailor.measure-649"><a href="#tailor.measure-649"><span class="linenos">649</span></a>                <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_detection_dict</span>
</span><span id="tailor.measure-650"><a href="#tailor.measure-650"><span class="linenos">650</span></a>
</span><span id="tailor.measure-651"><a href="#tailor.measure-651"><span class="linenos">651</span></a>        <span class="c1"># Step 10: Save segmentation image</span>
</span><span id="tailor.measure-652"><a href="#tailor.measure-652"><span class="linenos">652</span></a>        <span class="k">if</span> <span class="n">save_segmentation_image</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="tailor.measure-653"><a href="#tailor.measure-653"><span class="linenos">653</span></a>            <span class="n">use_bg_color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_derive</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_refine</span>
</span><span id="tailor.measure-654"><a href="#tailor.measure-654"><span class="linenos">654</span></a>        <span class="p">):</span>
</span><span id="tailor.measure-655"><a href="#tailor.measure-655"><span class="linenos">655</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor.measure-656"><a href="#tailor.measure-656"><span class="linenos">656</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor.measure-657"><a href="#tailor.measure-657"><span class="linenos">657</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor.measure-658"><a href="#tailor.measure-658"><span class="linenos">658</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Save segmentation image&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-659"><a href="#tailor.measure-659"><span class="linenos">659</span></a>            <span class="p">):</span>
</span><span id="tailor.measure-660"><a href="#tailor.measure-660"><span class="linenos">660</span></a>                <span class="n">transformed_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor.measure-661"><a href="#tailor.measure-661"><span class="linenos">661</span></a>                <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;mask&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="tailor.measure-662"><a href="#tailor.measure-662"><span class="linenos">662</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mask_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_mask.png&quot;</span>
</span><span id="tailor.measure-663"><a href="#tailor.measure-663"><span class="linenos">663</span></a>                <span class="p">)</span>
</span><span id="tailor.measure-664"><a href="#tailor.measure-664"><span class="linenos">664</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="tailor.measure-665"><a href="#tailor.measure-665"><span class="linenos">665</span></a>                    <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;mask_image&quot;</span>
</span><span id="tailor.measure-666"><a href="#tailor.measure-666"><span class="linenos">666</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/mask_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_mask.png&quot;</span>
</span><span id="tailor.measure-667"><a href="#tailor.measure-667"><span class="linenos">667</span></a>                <span class="k">if</span> <span class="n">use_bg_color</span><span class="p">:</span>
</span><span id="tailor.measure-668"><a href="#tailor.measure-668"><span class="linenos">668</span></a>                    <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;bg_modified_image&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="tailor.measure-669"><a href="#tailor.measure-669"><span class="linenos">669</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bg_modified_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_bg_modified.png&quot;</span>
</span><span id="tailor.measure-670"><a href="#tailor.measure-670"><span class="linenos">670</span></a>                    <span class="p">)</span>
</span><span id="tailor.measure-671"><a href="#tailor.measure-671"><span class="linenos">671</span></a>                    <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="tailor.measure-672"><a href="#tailor.measure-672"><span class="linenos">672</span></a>                        <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;bg_modified_image&quot;</span>
</span><span id="tailor.measure-673"><a href="#tailor.measure-673"><span class="linenos">673</span></a>                    <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/bg_modified_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_bg_modified.png&quot;</span>
</span><span id="tailor.measure-674"><a href="#tailor.measure-674"><span class="linenos">674</span></a>
</span><span id="tailor.measure-675"><a href="#tailor.measure-675"><span class="linenos">675</span></a>        <span class="c1"># Step 10: Save measurement image</span>
</span><span id="tailor.measure-676"><a href="#tailor.measure-676"><span class="linenos">676</span></a>        <span class="k">if</span> <span class="n">save_measurement_image</span><span class="p">:</span>
</span><span id="tailor.measure-677"><a href="#tailor.measure-677"><span class="linenos">677</span></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor.measure-678"><a href="#tailor.measure-678"><span class="linenos">678</span></a>                <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor.measure-679"><a href="#tailor.measure-679"><span class="linenos">679</span></a>                <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor.measure-680"><a href="#tailor.measure-680"><span class="linenos">680</span></a>                <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Save measurement image&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-681"><a href="#tailor.measure-681"><span class="linenos">681</span></a>            <span class="p">):</span>
</span><span id="tailor.measure-682"><a href="#tailor.measure-682"><span class="linenos">682</span></a>                <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor.measure-683"><a href="#tailor.measure-683"><span class="linenos">683</span></a>                <span class="n">transformed_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor.measure-684"><a href="#tailor.measure-684"><span class="linenos">684</span></a>
</span><span id="tailor.measure-685"><a href="#tailor.measure-685"><span class="linenos">685</span></a>                <span class="n">image_to_save</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">input_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
</span><span id="tailor.measure-686"><a href="#tailor.measure-686"><span class="linenos">686</span></a>                <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image_to_save</span><span class="p">)</span>
</span><span id="tailor.measure-687"><a href="#tailor.measure-687"><span class="linenos">687</span></a>                <span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">load_default</span><span class="p">()</span>
</span><span id="tailor.measure-688"><a href="#tailor.measure-688"><span class="linenos">688</span></a>                <span class="n">landmarks</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">][</span><span class="n">label</span><span class="p">][</span><span class="s2">&quot;landmarks&quot;</span><span class="p">]</span>
</span><span id="tailor.measure-689"><a href="#tailor.measure-689"><span class="linenos">689</span></a>
</span><span id="tailor.measure-690"><a href="#tailor.measure-690"><span class="linenos">690</span></a>                <span class="k">for</span> <span class="n">lm_id</span><span class="p">,</span> <span class="n">lm_data</span> <span class="ow">in</span> <span class="n">landmarks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="tailor.measure-691"><a href="#tailor.measure-691"><span class="linenos">691</span></a>                    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">lm_data</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="n">lm_data</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>
</span><span id="tailor.measure-692"><a href="#tailor.measure-692"><span class="linenos">692</span></a>                    <span class="n">radius</span> <span class="o">=</span> <span class="mi">5</span>
</span><span id="tailor.measure-693"><a href="#tailor.measure-693"><span class="linenos">693</span></a>                    <span class="n">draw</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span>
</span><span id="tailor.measure-694"><a href="#tailor.measure-694"><span class="linenos">694</span></a>                        <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">radius</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">radius</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">radius</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;green&quot;</span>
</span><span id="tailor.measure-695"><a href="#tailor.measure-695"><span class="linenos">695</span></a>                    <span class="p">)</span>
</span><span id="tailor.measure-696"><a href="#tailor.measure-696"><span class="linenos">696</span></a>                    <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">8</span><span class="p">),</span> <span class="n">lm_id</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">)</span>
</span><span id="tailor.measure-697"><a href="#tailor.measure-697"><span class="linenos">697</span></a>
</span><span id="tailor.measure-698"><a href="#tailor.measure-698"><span class="linenos">698</span></a>                <span class="n">image_to_save</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
</span><span id="tailor.measure-699"><a href="#tailor.measure-699"><span class="linenos">699</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.png&quot;</span>
</span><span id="tailor.measure-700"><a href="#tailor.measure-700"><span class="linenos">700</span></a>                <span class="p">)</span>
</span><span id="tailor.measure-701"><a href="#tailor.measure-701"><span class="linenos">701</span></a>                <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="tailor.measure-702"><a href="#tailor.measure-702"><span class="linenos">702</span></a>                    <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;measurement_image&quot;</span>
</span><span id="tailor.measure-703"><a href="#tailor.measure-703"><span class="linenos">703</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_image/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.png&quot;</span>
</span><span id="tailor.measure-704"><a href="#tailor.measure-704"><span class="linenos">704</span></a>
</span><span id="tailor.measure-705"><a href="#tailor.measure-705"><span class="linenos">705</span></a>        <span class="c1"># Step 11: Save measurement json</span>
</span><span id="tailor.measure-706"><a href="#tailor.measure-706"><span class="linenos">706</span></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span>
</span><span id="tailor.measure-707"><a href="#tailor.measure-707"><span class="linenos">707</span></a>            <span class="nb">enumerate</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]),</span>
</span><span id="tailor.measure-708"><a href="#tailor.measure-708"><span class="linenos">708</span></a>            <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">metadata</span><span class="p">),</span>
</span><span id="tailor.measure-709"><a href="#tailor.measure-709"><span class="linenos">709</span></a>            <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Save measurement json&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-710"><a href="#tailor.measure-710"><span class="linenos">710</span></a>        <span class="p">):</span>
</span><span id="tailor.measure-711"><a href="#tailor.measure-711"><span class="linenos">711</span></a>            <span class="n">label</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">image</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor.measure-712"><a href="#tailor.measure-712"><span class="linenos">712</span></a>            <span class="n">transformed_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">image</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tailor.measure-713"><a href="#tailor.measure-713"><span class="linenos">713</span></a>
</span><span id="tailor.measure-714"><a href="#tailor.measure-714"><span class="linenos">714</span></a>            <span class="c1"># Clean the detection dictionary</span>
</span><span id="tailor.measure-715"><a href="#tailor.measure-715"><span class="linenos">715</span></a>            <span class="n">final_dict</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">clean_detection_dict</span><span class="p">(</span>
</span><span id="tailor.measure-716"><a href="#tailor.measure-716"><span class="linenos">716</span></a>                <span class="n">class_name</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
</span><span id="tailor.measure-717"><a href="#tailor.measure-717"><span class="linenos">717</span></a>                <span class="n">image_name</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
</span><span id="tailor.measure-718"><a href="#tailor.measure-718"><span class="linenos">718</span></a>                <span class="n">detection_dict</span><span class="o">=</span><span class="n">outputs</span><span class="p">[</span><span class="n">image</span><span class="p">][</span><span class="s2">&quot;detection_dict&quot;</span><span class="p">],</span>
</span><span id="tailor.measure-719"><a href="#tailor.measure-719"><span class="linenos">719</span></a>            <span class="p">)</span>
</span><span id="tailor.measure-720"><a href="#tailor.measure-720"><span class="linenos">720</span></a>
</span><span id="tailor.measure-721"><a href="#tailor.measure-721"><span class="linenos">721</span></a>            <span class="c1"># Export JSON</span>
</span><span id="tailor.measure-722"><a href="#tailor.measure-722"><span class="linenos">722</span></a>            <span class="n">utils</span><span class="o">.</span><span class="n">export_dict_to_json</span><span class="p">(</span>
</span><span id="tailor.measure-723"><a href="#tailor.measure-723"><span class="linenos">723</span></a>                <span class="n">data</span><span class="o">=</span><span class="n">final_dict</span><span class="p">,</span>
</span><span id="tailor.measure-724"><a href="#tailor.measure-724"><span class="linenos">724</span></a>                <span class="n">filename</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_json/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.json&quot;</span><span class="p">,</span>
</span><span id="tailor.measure-725"><a href="#tailor.measure-725"><span class="linenos">725</span></a>            <span class="p">)</span>
</span><span id="tailor.measure-726"><a href="#tailor.measure-726"><span class="linenos">726</span></a>
</span><span id="tailor.measure-727"><a href="#tailor.measure-727"><span class="linenos">727</span></a>            <span class="n">metadata</span><span class="o">.</span><span class="n">at</span><span class="p">[</span>
</span><span id="tailor.measure-728"><a href="#tailor.measure-728"><span class="linenos">728</span></a>                <span class="n">idx</span><span class="p">,</span> <span class="s2">&quot;measurement_json&quot;</span>
</span><span id="tailor.measure-729"><a href="#tailor.measure-729"><span class="linenos">729</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/measurement_json/</span><span class="si">{</span><span class="n">transformed_name</span><span class="si">}</span><span class="s2">_measurement.json&quot;</span>
</span><span id="tailor.measure-730"><a href="#tailor.measure-730"><span class="linenos">730</span></a>
</span><span id="tailor.measure-731"><a href="#tailor.measure-731"><span class="linenos">731</span></a>        <span class="c1"># Step 12: Save metadata as a CSV</span>
</span><span id="tailor.measure-732"><a href="#tailor.measure-732"><span class="linenos">732</span></a>        <span class="n">metadata</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/metadata.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="tailor.measure-733"><a href="#tailor.measure-733"><span class="linenos">733</span></a>
</span><span id="tailor.measure-734"><a href="#tailor.measure-734"><span class="linenos">734</span></a>        <span class="k">return</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">outputs</span>
</span></pre></div>


            <div class="docstring"><p>Executes the full garment measurement pipeline for all images in the input directory.</p>

<p>This method processes each image through a multi-stage pipeline that includes garment classification, 
segmentation, landmark detection, optional refinement, and measurement derivation. During classification, 
the system identifies the type of garment (e.g., shirt, dress, pants). Segmentation follows, producing 
binary or instance masks that separate the garment from the background. Landmark detection is then 
performed to locate anatomical or garment-specific keypoints such as shoulders or waist positions. If 
enabled, an optional refinement step applies post-processing or model-based corrections to improve the 
accuracy of detected keypoints. Finally, the system calculates key garment dimensions - such as chest width, 
waist width, and full length - based on the detected landmarks. In addition to this processing pipeline, 
the method also manages data and visual output exports. For each input image, a cleaned JSON file is 
generated containing the predicted garment class, landmark coordinates, and the resulting measurements. 
Optionally, visual outputs such as segmentation masks and images annotated with landmarks and measurements 
can be saved to assist in inspection or debugging.</p>

<h6 id="arguments">Arguments:</h6>

<ul>
<li><strong>save_segmentation_image (bool):</strong>  If True, saves segmentation masks and background-modified images.
Defaults to False.</li>
<li><strong>save_measurement_image (bool):</strong>  If True, saves images overlaid with detected landmarks and measurements.
Defaults to False.</li>
</ul>

<h6 id="returns">Returns:</h6>

<blockquote>
  <p>tuple:
      - metadata (pd.DataFrame): A DataFrame containing metadata for each processed image, such as:
          - Original image path
          - Paths to any saved segmentation or annotated images
          - Class and measurement results
      - outputs (dict): A dictionary mapping image filenames to their detailed processing results, including:
          - Predicted class
          - Detected landmarks with coordinates and confidence scores
          - Calculated measurements
          - File paths to any saved images (if applicable)</p>
</blockquote>

<h6 id="example-of-exported-json">Example of exported JSON:</h6>

<blockquote>
<pre><code>{
    "cloth_3.jpg": {
        "class": "vest dress",
        "landmarks": {
            "10": {
                "conf": 0.7269417643547058,
                "x": 611.0,
                "y": 861.0
            },
            "16": {
                "conf": 0.6769524812698364,
                "x": 1226.0,
                "y": 838.0
            },
            "17": {
                "conf": 0.7472652196884155,
                "x": 1213.0,
                "y": 726.0
            },
            "18": {
                "conf": 0.7360446453094482,
                "x": 1238.0,
                "y": 613.0
            },
            "2": {
                "conf": 0.9256571531295776,
                "x": 703.0,
                "y": 264.0
            },
            "20": {
                "x": 700.936,
                "y": 2070.0
            },
            "8": {
                "conf": 0.7129100561141968,
                "x": 563.0,
                "y": 613.0
            },
            "9": {
                "conf": 0.8203497529029846,
                "x": 598.0,
                "y": 726.0
            }
        },
        "measurements": {
            "chest": {
                "distance": 675.0,
                "landmarks": {
                    "end": "18",
                    "start": "8"
                }
            },
            "full length": {
                "distance": 1806.0011794281863,
                "landmarks": {
                    "end": "20",
                    "start": "2"
                }
            },
            "hips": {
                "distance": 615.4299310238331,
                "landmarks": {
                    "end": "16",
                    "start": "10"
                }
            },
            "waist": {
                "distance": 615.0,
                "landmarks": {
                    "end": "17",
                    "start": "9"
                }
            }
        }
    }
}
</code></pre>
</blockquote>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>